{
  "entityType" : "RULE_CHAIN",
  "entity" : {
    "additionalInfo" : {
      "description" : ""
    },
    "configuration" : null,
    "debugMode" : false,
    "externalId" : null,
    "firstRuleNodeId" : {
      "entityType" : "RULE_NODE",
      "id" : "67654bc0-b43a-11f0-9cd0-35be421ad23c"
    },
    "id" : {
      "entityType" : "RULE_CHAIN",
      "id" : "9e8cb6b0-a53f-11f0-9abe-2dfd6db9cae3"
    },
    "name" : "Process",
    "root" : false,
    "type" : "CORE"
  },
  "metaData" : {
    "connections" : [ {
      "fromIndex" : 1,
      "toIndex" : 5,
      "type" : "Success"
    }, {
      "fromIndex" : 2,
      "toIndex" : 1,
      "type" : "Failure"
    }, {
      "fromIndex" : 2,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 4,
      "toIndex" : 3,
      "type" : "Success"
    }, {
      "fromIndex" : 6,
      "toIndex" : 0,
      "type" : "Success"
    }, {
      "fromIndex" : 6,
      "toIndex" : 13,
      "type" : "Success"
    }, {
      "fromIndex" : 6,
      "toIndex" : 16,
      "type" : "Success"
    }, {
      "fromIndex" : 6,
      "toIndex" : 17,
      "type" : "Success"
    }, {
      "fromIndex" : 6,
      "toIndex" : 31,
      "type" : "Success"
    }, {
      "fromIndex" : 7,
      "toIndex" : 8,
      "type" : "Success"
    }, {
      "fromIndex" : 8,
      "toIndex" : 9,
      "type" : "Success"
    }, {
      "fromIndex" : 9,
      "toIndex" : 10,
      "type" : "Success"
    }, {
      "fromIndex" : 9,
      "toIndex" : 12,
      "type" : "Success"
    }, {
      "fromIndex" : 12,
      "toIndex" : 11,
      "type" : "Success"
    }, {
      "fromIndex" : 14,
      "toIndex" : 15,
      "type" : "Success"
    }, {
      "fromIndex" : 16,
      "toIndex" : 14,
      "type" : "Success"
    }, {
      "fromIndex" : 17,
      "toIndex" : 18,
      "type" : "Success"
    }, {
      "fromIndex" : 19,
      "toIndex" : 21,
      "type" : "Success"
    }, {
      "fromIndex" : 21,
      "toIndex" : 22,
      "type" : "Success"
    }, {
      "fromIndex" : 25,
      "toIndex" : 26,
      "type" : "Success"
    }, {
      "fromIndex" : 26,
      "toIndex" : 27,
      "type" : "Success"
    }, {
      "fromIndex" : 27,
      "toIndex" : 28,
      "type" : "Success"
    }, {
      "fromIndex" : 27,
      "toIndex" : 29,
      "type" : "Success"
    }, {
      "fromIndex" : 29,
      "toIndex" : 30,
      "type" : "Success"
    }, {
      "fromIndex" : 31,
      "toIndex" : 7,
      "type" : "1.0 - 1.8"
    }, {
      "fromIndex" : 31,
      "toIndex" : 25,
      "type" : "1.9"
    }, {
      "fromIndex" : 31,
      "toIndex" : 32,
      "type" : "1.0 - 1.8"
    }, {
      "fromIndex" : 32,
      "toIndex" : 33,
      "type" : "Success"
    }, {
      "fromIndex" : 33,
      "toIndex" : 34,
      "type" : "Success"
    } ],
    "firstNodeIndex" : 6,
    "nodes" : [ {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1184,
        "layoutY" : 137
      },
      "configuration" : {
        "version" : 0
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "fd846e50-a540-11f0-9abe-2dfd6db9cae3"
      },
      "name" : "Output",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.flow.TbRuleChainOutputNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 391,
        "layoutY" : 956
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "if(msg.evento === \"FIN_OPERACION\"){\n    var unidades_ensambladas_anterior = parseInt(metadata.unidades_ensambladas) || 0;\n    msg.unidades_ensambladas = unidades_ensambladas_anterior + 1;\n    \n    var tiempo_inicio = metadata.shared_tiempo_inicio;\n    var tiempo_final = metadata.shared_tiempo_final;\n    msg.tiempo_operacion = tiempo_final - tiempo_inicio;\n}\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1760044271632,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "fd846e51-a540-11f0-9abe-2dfd6db9cae3"
      },
      "name" : "Unidades Ensambladas",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 84,
        "layoutY" : 957
      },
      "configuration" : {
        "tellFailureIfAbsent" : true,
        "fetchTo" : "METADATA",
        "clientAttributeNames" : [ ],
        "sharedAttributeNames" : [ "tiempo_inicio", "tiempo_fin" ],
        "serverAttributeNames" : [ ],
        "latestTsKeyNames" : [ "unidades_ensambladas" ],
        "getLatestValueWithTs" : false
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1760044271632,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "67a0e3e0-a541-11f0-9abe-2dfd6db9cae3"
      },
      "name" : "Fetch Unidades ensambladas",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 537,
        "layoutY" : 1039
      },
      "configuration" : {
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        },
        "scope" : "SHARED_SCOPE",
        "notifyDevice" : false,
        "sendAttributesUpdatedNotification" : false,
        "updateAttributesOnlyOnValueChange" : false
      },
      "configurationVersion" : 3,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "3367caa0-a567-11f0-9abe-2dfd6db9cae3"
      },
      "name" : "Save Attributes",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 290,
        "layoutY" : 1035
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var newMsg = {};\n\nif(msg.evento === \"IDENTIFICACION\"){\n    newMsg.tiempo_inicio = metadata.ts;\n}\nif(msg.evento === \"IDENTIFICACION\"){\n    newMsg.tiempo_fin = metadata.ts;\n}\n\nreturn {msg: newMsg, metadata: metadata, msgType: 'POST_ATTRIBUTES_REQUEST'};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "3367f1b0-a567-11f0-9abe-2dfd6db9cae3"
      },
      "name" : "Prepare Attributes",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 708,
        "layoutY" : 954
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "// List of keys to convert\nvar keysToConvert = ['tiempo_total', 'tiempo_parada', 'tiempo_espera']; \n\nkeysToConvert.forEach(function(key) {\n    if (msg[key]) {\n        var timeStr = msg[key];\n        var parts = timeStr.split(\":\");\n\n        // Ensure valid 4-part format (D:H:M:S)\n        if (parts.length === 4) {\n            var days = parseInt(parts[0], 10);\n            var hours = parseInt(parts[1], 10);\n            var minutes = parseInt(parts[2], 10);\n            var seconds = parseInt(parts[3], 10);\n\n            var totalSeconds = (((days * 24 + hours) * 60 + minutes) * 60) + seconds;\n\n            msg[key] = totalSeconds;\n        } else {\n            // optional: log invalid format\n            // logger.warn(\"Invalid time format for key \" + key + \": \" + timeStr);\n        }\n    }\n});\n\nreturn { msg: msg, metadata: metadata, msgType: msgType };\n\n\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "0359ab50-a56a-11f0-9abe-2dfd6db9cae3"
      },
      "name" : "HH:MM:SS to seconds",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 263,
        "layoutY" : 154
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "\n\n if(msg.nombre_operario)  {\nmsg.string_nombre_operario = msg.nombre_operario.join(\", \"); //variable para nombre_operario\n\n}\n//********************************************************************************************************\n\nif (msg.evento==\"FIN_ESTACION\"){\n    \n    \n  if(msg.unidad_terminada){\n    var unidades_ensambladas;\n    unidades_ensambladas=1;\n    \n    msg.unidades_ensambladas=unidades_ensambladas;\n    \n\n    \n      if(msg.contador_levantamiento ==0){\n     \n          msg.unidades_ALAprimera=\"true\";\n          \n       }\n      else{\n          \n          msg.unidades_retrabajadas=\"true\";\n          \n      \n        }\n    }\n  else{\n    unidades_ensambladas=0;\n    msg.unidades_ensambladas=unidades_ensambladas;\n    }\n      \n  //unidades_ensambladas=unidades_ALAprimera+unidades_retrabajadas;\n  \n\n  msg.disponibilidad=(tiempoSegundos(msg.tiempo_activo))/(tiempoSegundos(msg.tiempo_estandar)); //usadao para estacion 1.9\n  msg.cantidad_teorica=10;\n  \n  msg.tiempo_total=tiempoSegundos(msg.tiempo_total);\n  msg.tiempo_activo=tiempoSegundos(msg.tiempo_activo);\n  msg.p_efectivo=(msg.tiempo_activo)/(msg.tiempo_total);\n      }\n\n//**********************************************************************************************************\nelse if(msg.evento==\"FIN_OPERACION\"){\n    \n    \n    //msg.tiempo_estado=tiempoSegundos(msg.tiempo_estado);\n    \n\n    \n}\n//**********************************************************************************************************\nelse if(msg.evento==\"FIN_PARADA\"){\n    \n        var categoria = null;\n    if (Array.isArray(msg.causa) && msg.causa.length > 0 && msg.causa[0].categoria) {\n        categoria = msg.causa[0].categoria;\n    }\n\n//------------------------------------------------------------------------\n    if( categoria==\"PROBLEMA DE ENSAMBLAJE\" ){\n        \n        msg.cont_PROBLEMA_DE_ENSAMBLAJE=1;         //contador de tipo de categoria\n        msg.tiempo_paradas_causa1=tiempoSegundos(msg.tiempo_estado); //tiempo en segundos, variable para sumar solo de esa causa.\n        \n        //msg.counter_parada_PROBLEMA_DE_ENSAMBLAJE=1;                  //VARIABLE PARA ACUMULAR CANTIDAD DE CAUSA 1 EN LINEA 1    \n        msg.time_parada=tiempoSegundos(msg.tiempo_estado);           //variable usada para acumular tiempo de todas las causas.\n    }\n    \n    else if(categoria==\"INSTRUCTIVO REQUIERE REVISION\"){\n        \n        msg.cont_INSTRUCTIVO_REQUIERE_REVISION=1;\n        msg.tiempo_paradas_causa2=tiempoSegundos(msg.tiempo_estado);\n        \n        //msg.counter_INSTRUCTIVO_REQUIERE_REVISION=1; \n        msg.time_parada=tiempoSegundos(msg.tiempo_estado);\n    }\n    \n    else if( categoria==\"LISTA DE ESPECIFICACIONES REQUIERE REVISION\" ){\n        \n        msg.cont_LISTA_DE_ESPECIFICACIONES_REQUIERE_REVISION=1;\n        msg.tiempo_paradas_causa3=tiempoSegundos(msg.tiempo_estado);\n        \n        //msg.counter_parada_LISTA_DE_ESPECIFICACIONES_REQUIERE_REVISION=1; \n        msg.time_parada=tiempoSegundos(msg.tiempo_estado);\n    }\n    \n    else if(categoria==\"PROBLEMA DE SUMINISTRO\"   ){\n        \n        msg.cont_PROBLEMA_DE_SUMINISTRO=1;\n        msg.tiempo_paradas_causa4=tiempoSegundos(msg.tiempo_estado);\n        \n        //msg.counter_parada_PROBLEMA_DE_SUMINISTRO=1; \n        msg.time_parada=tiempoSegundos(msg.tiempo_estado);\n    }\n    \n    else if( categoria==\"PROBLEMA DE PRUEBA\"   ){\n        \n        msg.cont_PROBLEMA_DE_PRUEBA=1;\n        msg.tiempo_paradas_causa5=tiempoSegundos(msg.tiempo_estado);\n        \n        //msg.counter_parada_PROBLEMA_DE_PRUEBA=1; \n        msg.time_parada=tiempoSegundos(msg.tiempo_estado);\n    }\n    \n    else if( categoria==\"ESPACIO NO DISPONIBLE PARA ABASTECIMIENTO\"   ){\n        \n        msg.cont_ESPACIO_NO_DISPONIBLE_PARA_ABASTECIMIENTO=1;\n        msg.tiempo_paradas_causa6=tiempoSegundos(msg.tiempo_estado);\n        \n        //msg.counter_parada_ESPACION_NO_DISPONIBLE_PARA_ABASTECIMIENTO=1; \n        msg.time_parada=tiempoSegundos(msg.tiempo_estado);\n    }\n    \n    else if( categoria==\"OTRO\" ){\n        \n        msg.cont_OTRO=1;\n        msg.tiempo_paradas_causa7=tiempoSegundos(msg.tiempo_estado);\n        \n        //msg.counter_parada_OTRO=1; \n        msg.time_parada=tiempoSegundos(msg.tiempo_estado);\n    }\n    else{\n        msg.z_status_evento_causa=\"sin causa null\";\n    }\n    \n    \n    \n   \n   msg.z_status_evento=\"FIN_PARADA\"; //variable para admin ver que parte del codigo se ejecuto.\n    \n}\n\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};\n\n// funciones $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$\n \n /*\n    function tiempoSegundos(timeArray){\n        //se calcula los segundos totales\n        var partes =timeArray.split(':').map(Number);\n         //if (partes.length !== 4) {\n         //throw new Error(\"El formato debe ser dd:hh:mm:ss\");\n    \n         //}\n  var dias=partes[0]*24*3600;\n  var horas=partes[1]*3600;\n  var minutos=partes[2]*60;\n  var segundos=partes[3];\n\n        \n    return dias+horas+minutos+segundos;\n\n}\n*/\n \n//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$\nfunction tiempoSegundos(timeArray) {\n    // Si no existe, devolver 0\n    if (timeArray === undefined || timeArray === null) {\n        return 0;\n    }\n\n    // Si no es string, intentar convertirlo a string\n    if (typeof timeArray !== \"string\") {\n        timeArray = String(timeArray);\n    }\n\n    // Verificar que contenga \":\"\n    if (timeArray.indexOf(\":\") === -1) {\n        return 0;\n    }\n\n    // Separar en partes\n    var partes = timeArray.split(\":\").map(function(x) { return parseInt(x, 10) || 0; });\n\n    // dd:hh:mm:ss\n    if (partes.length === 4) {\n        return (partes[0] * 24 * 3600) + (partes[1] * 3600) + (partes[2] * 60) + partes[3];\n    }\n\n    // hh:mm:ss\n    if (partes.length === 3) {\n        return (partes[0] * 3600) + (partes[1] * 60) + partes[2];\n    }\n\n    // Cualquier otro formato\n    return 0;\n}\n\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1762375670838,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "67654bc0-b43a-11f0-9cd0-35be421ad23c"
      },
      "name" : "evento",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 745,
        "layoutY" : 195
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "var outmsg={};\noutmsg.unidades_ALAprimera=msg.unidades_ALAprimera;\noutmsg.unidades_retrabajadas=msg.unidades_retrabajadas;\noutmsg.unidades_ensambladas=msg.unidades_ensambladas;\n\n//outmsg.c_unidades_ALAprimera=msg.c_unidades_ALAprimera;\n//outmsg.cont2=msg.cont2;\n\nreturn {msg: outmsg, metadata: metadata, msgType: 'POST_ATTRIBUTES_REQUEST'};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1762373737629,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f8ca88b0-b4f7-11f0-9cd0-35be421ad23c"
      },
      "name" : "convert atributos",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1012,
        "layoutY" : 192
      },
      "configuration" : {
        "tellFailureIfAbsent" : true,
        "fetchTo" : "DATA",
        "clientAttributeNames" : [ ],
        "sharedAttributeNames" : [ ],
        "serverAttributeNames" : [ ],
        "latestTsKeyNames" : [ "c_unidades_ALAprimera", "c_unidades_retrabajadas", "c_unidades_ensambladas" ],
        "getLatestValueWithTs" : false
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1761780164383,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7ce9d140-b4f9-11f0-9cd0-35be421ad23c"
      },
      "name" : "c_unidades",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1252,
        "layoutY" : 194
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "\nvar c=msg.c_unidades_ALAprimera+1;\nvar r=msg.c_unidades_retrabajadas+1;\nvar e=msg.c_unidades_ensambladas+1;\n\nif(msg.unidades_ALAprimera){\n  //var c=msg.c_unidades_ALAprimera+1;\n   msg.c_unidades_ALAprimera=c;\n   metadata.c_unidades_ALAprimera=c;\n   \n   msg.p_ALAprimera=(c/e).toFixed(2) ;\n   msg.p_retrabajadas=(1-(c/e)).toFixed(2) ;\n   metadata.p_ALAprimera=(c/e).toFixed(2) ;\n   \n   \n}\nif(msg.unidades_retrabajadas){\n   //var r=msg.c_unidades_retrabajadas+1;\n   msg.c_unidades_retrabajadas=r;\n   metadata.c_unidades_retrabajadas=r;\n   \n   msg.p_ALAprimera=(1-(r/e)).toFixed(2)  ;\n   msg.p_retrabajadas=(r/e).toFixed(2) ;\n   metadata.p_retrabajadas=(r/e).toFixed(2) ;\n}\n\nif(msg.unidades_ensambladas){\n    //var e=msg.c_unidades_ensambladas+1;\n    msg.c_unidades_ensambladas=e;\n    metadata.unidades_ensambladas=e;\n    \n    \n\n}\nreturn {msg: msg, metadata: metadata, msgType: msgType};\n\n//e=c+r",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1761783068063,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "c3aa8950-b506-11f0-9cd0-35be421ad23c"
      },
      "name" : "procesar",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1429,
        "layoutY" : 37
      },
      "configuration" : {
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        },
        "scope" : "SERVER_SCOPE",
        "notifyDevice" : false,
        "sendAttributesUpdatedNotification" : false,
        "updateAttributesOnlyOnValueChange" : true
      },
      "configurationVersion" : 3,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "03d2cde0-b50b-11f0-9cd0-35be421ad23c"
      },
      "name" : "save contadores atributos",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1551,
        "layoutY" : 102
      },
      "configuration" : {
        "defaultTTL" : 0,
        "useServerTs" : false,
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        }
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b23fade0-b50f-11f0-9cd0-35be421ad23c"
      },
      "name" : "save contadores telemetry",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1479,
        "layoutY" : 200
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "\n\nreturn {msg: msg, metadata: metadata, msgType: 'POST_TELEMETRY_REQUEST'};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1761778292057,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b23fd4f0-b50f-11f0-9cd0-35be421ad23c"
      },
      "name" : "convert telemetry",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 146,
        "layoutY" : 36
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var msgout={};\nif(metadata.deviceName == \"Estación 1.7\"){\n    msgout=msg;\n}\nelse{\n    msgout=0;\n}\nreturn {msg: msgout, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1762191599549,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "468f82e0-b7d6-11f0-9cd0-35be421ad23c"
      },
      "name" : "filtrar estacion 1.0 - 1.9",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 893,
        "layoutY" : 110
      },
      "configuration" : {
        "originatorSource" : "ENTITY",
        "entityType" : "DEVICE",
        "entityNamePattern" : "line1",
        "relationsQuery" : {
          "direction" : "FROM",
          "maxLevel" : 1,
          "filters" : [ {
            "relationType" : "Contains",
            "entityTypes" : [ ],
            "negate" : false
          } ],
          "fetchLastLevelOnly" : false
        }
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1762272432235,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "4e419250-b914-11f0-9cd0-35be421ad23c"
      },
      "name" : "para Linea1",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbChangeOriginatorNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1144,
        "layoutY" : 72
      },
      "configuration" : {
        "defaultTTL" : 0,
        "useServerTs" : false,
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        }
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1762269000707,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "4e419251-b914-11f0-9cd0-35be421ad23c"
      },
      "name" : "save linea 1",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 567,
        "layoutY" : 113
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var msgout={};\n//------------------------------------------------------------\n if(msg.nombre_operario)  {\nmsg.string_nombre_operario = msg.nombre_operario.join(\", \"); //variable para nombre_operario\n\n}\n//********************************************************************************************************\n\nif (msg.evento==\"FIN_ESTACION\"){\n    \n    \n  if(msg.unidad_terminada){\n    var unidades_ensambladas;\n    unidades_ensambladas=1;\n    \n    msgout.unidades_ensambladasL=unidades_ensambladas;\n    \n    \n      if(msg.contador_levantamiento ==0){\n     \n          msg.unidades_ALAprimera=\"true\";\n          \n       }\n      else{\n          \n          msg.unidades_retrabajadas=\"true\";\n          \n      \n        }\n        \n     if(msg.contador_inspeccion ==1){\n     \n          msgout.unidades_buenas=1;\n          \n       }\n      else if(msg.contador_inspeccion >=1){\n          \n          msgout.unidades_defecto=1;\n          \n      \n        }\n        \n        \n    switch (metadata.deviceName) {\n     case \"Estación 1.0\":\n        msgout.UE_10=1;\n        break;\n     case \"Estación 1.1\":\n        msgout.UE_11=1;\n        break;\n     case \"Estación 1.2\":\n        msgout.UE_12=1;\n        break;\n     case \"Estación 1.3\":\n        msgout.UE_13=1;\n        break;\n     case \"Estación 1.4\":\n        msgout.UE_14=1;\n        break;\n     case \"Estación 1.5\":\n        msgout.UE_15=1;\n        break;\n     case \"Estación 1.6\":\n        msgout.UE_16=1;\n        break;\n     case \"Estación 1.7\":\n        msgout.UE_17=1;\n        break;\n     case \"Estación 1.8\":\n        msgout.UE_18=1;\n        break;\n     case \"Estación 1.9\":\n        msgout.UE_19=1;\n        break;\n        \n     default:\n        msgout.alerta= \"no es dispositivo\";\n        break;\n   }\n  \n    }\n  else{\n    unidades_ensambladas=0;\n    msg.unidades_ensambladas=unidades_ensambladas;\n    }\n    \n    \n      \n  //unidades_ensambladas=unidades_ALAprimera+unidades_retrabajadas;\n  \n\n  \n\n  msg.tiempo_total=tiempoSegundos(msg.tiempo_total);\n  msg.tiempo_activo=tiempoSegundos(msg.tiempo_activo);\n  msg.p_efectivo=(msg.tiempo_activo)/(msg.tiempo_total);\n      }\n\n//**********************************************************************************************************\nelse if(msg.evento==\"FIN_OPERACION\"){\n    \n    \n    //msg.tiempo_estado=tiempoSegundos(msg.tiempo_estado);\n    \n\n    \n}\n//**********************************************************************************************************\nelse if(msg.evento==\"FIN_PARADA\"){\n    \n        switch (metadata.deviceName) {\n     case \"Estación 1.0\":\n        msgout.PARADAS_10=1;\n        break;\n     case \"Estación 1.1\":\n        msgout.PARADAS_11=1;\n        break;\n     case \"Estación 1.2\":\n        msgout.PARADAS_12=1;\n        break;\n     case \"Estación 1.3\":\n        msgout.PARADAS_13=1;\n        break;\n     case \"Estación 1.4\":\n        msgout.PARADAS_14=1;\n        break;\n     case \"Estación 1.5\":\n        msgout.PARADAS_15=1;\n        break;\n     case \"Estación 1.6\":\n        msgout.PARADAS_16=1;\n        break;\n     case \"Estación 1.7\":\n        msgout.PARADAS_17=1;\n        break;\n     case \"Estación 1.8\":\n        msgout.PARADAS_18=1;\n        break;\n     case \"Estación 1.9\":\n        msgout.PARADAS_19=1;\n        break;\n        \n     default:\n        msgout.alerta= \"DISPOSITIVO NO REGISTRADO\";\n        break;\n   }\n   //-------------------------------------------------------------------------------\n    \n        var categoria = null;\n    if (Array.isArray(msg.causa) && msg.causa.length > 0 && msg.causa[0].categoria) {\n        categoria = msg.causa[0].categoria;\n    }\n\n//------------------------------------------------------------------------\n    if( categoria==\"PROBLEMA DE ENSAMBLAJE\" ){\n        \n        msg.cont_PROBLEMA_DE_ENSAMBLAJE=1;         //contador de tipo de categoria\n        msg.tiempo_paradas_causa1=tiempoSegundos(msg.tiempo_estado); //tiempo en segundos, variable para sumar solo de esa causa.\n        \n        msgout.counter_parada_PROBLEMA_DE_ENSAMBLAJE=1;                                     //VARIABLE PARA ACUMULAR CANTIDAD DE CAUSA 1 EN LINEA 1    \n        msgout.time_parada_PROBLEMA_DE_ENSAMBLAJE=tiempoSegundos(msg.tiempo_estado);        //VARIABLE PARA ACUMULAR TIEMPO DE CAUSA 1 EN LINEA 1\n    }\n    \n    else if(categoria==\"INSTRUCTIVO REQUIERE REVISION\"){\n        \n        msg.cont_INSTRUCTIVO_REQUIERE_REVISION=1;\n        msg.tiempo_paradas_causa2=tiempoSegundos(msg.tiempo_estado);\n        \n        msgout.counter_parada_INSTRUCTIVO_REQUIERE_REVISION=1; \n        msgout.time_parada_INSTRUCTIVO_REQUIERE_REVISION=tiempoSegundos(msg.tiempo_estado);\n    }\n    \n    else if( categoria==\"LISTA DE ESPECIFICACIONES REQUIERE REVISION\" ){\n        \n        msg.cont_LISTA_DE_ESPECIFICACIONES_REQUIERE_REVISION=1;\n        msg.tiempo_paradas_causa3=tiempoSegundos(msg.tiempo_estado);\n        \n        msgout.counter_parada_LISTA_DE_ESPECIFICACIONES_REQUIERE_REVISION=1; \n        msgout.time_parada_LISTA_DE_ESPECIFICACIONES_REQUIERE_REVISION=tiempoSegundos(msg.tiempo_estado);\n    }\n    \n    else if(categoria==\"PROBLEMA DE SUMINISTRO\"   ){\n        \n        msg.cont_PROBLEMA_DE_SUMINISTRO=1;\n        msg.tiempo_paradas_causa4=tiempoSegundos(msg.tiempo_estado);\n        \n        msgout.counter_parada_PROBLEMA_DE_SUMINISTRO=1; \n        msgout.time_parada_PROBLEMA_DE_SUMINISTRO=tiempoSegundos(msg.tiempo_estado);\n    }\n    \n    else if( categoria==\"PROBLEMA DE PRUEBA\"   ){\n        \n        msg.cont_PROBLEMA_DE_PRUEBA=1;\n        msg.tiempo_paradas_causa5=tiempoSegundos(msg.tiempo_estado);\n        \n        msgout.counter_parada_PROBLEMA_DE_PRUEBA=1; \n        msgout.time_parada_PROBLEMA_DE_PRUEBA=tiempoSegundos(msg.tiempo_estado);\n    }\n    \n    else if( categoria==\"ESPACIO NO DISPONIBLE PARA ABASTECIMIENTO\"   ){\n        \n        msg.cont_ESPACIO_NO_DISPONIBLE_PARA_ABASTECIMIENTO=1;\n        msg.tiempo_paradas_causa6=tiempoSegundos(msg.tiempo_estado);\n        \n        msgout.counter_parada_ESPACION_NO_DISPONIBLE_PARA_ABASTECIMIENTO=1; \n        msgout.time_parada_ESPACIO_NO_DISPONIBLE_PARA_ABASTECIMIENTO=tiempoSegundos(msg.tiempo_estado);\n    }\n    \n    else if( categoria==\"OTRO\" ){\n        \n        msg.cont_OTRO=1;\n        msg.tiempo_paradas_causa7=tiempoSegundos(msg.tiempo_estado);\n        \n        msgout.counter_parada_OTRO=1; \n        msgout.time_parada_OTRO=tiempoSegundos(msg.tiempo_estado);\n    }\n    else{\n        msgout.z_status_evento_causa=\"sin causa null\";\n    }\n    \n    \n   msgout.tiempo_linea_parada=tiempoSegundos(msg.tiempo_estado);\n   \n   msg.z_status_evento=\"FIN_PARADA\"; //variable para admin ver que parte del codigo se ejecuto.\n    \n}\n\n\nreturn {msg: msgout, metadata: metadata, msgType: msgType};\n\n// funciones $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$\n \n /*\n    function tiempoSegundos(timeArray){\n        //se calcula los segundos totales\n        var partes =timeArray.split(':').map(Number);\n         //if (partes.length !== 4) {\n         //throw new Error(\"El formato debe ser dd:hh:mm:ss\");\n    \n         //}\n  var dias=partes[0]*24*3600;\n  var horas=partes[1]*3600;\n  var minutos=partes[2]*60;\n  var segundos=partes[3];\n\n        \n    return dias+horas+minutos+segundos;\n\n}\n*/\n \n//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$\nfunction tiempoSegundos(timeArray) {\n    // Si no existe, devolver 0\n    if (timeArray === undefined || timeArray === null) {\n        return 0;\n    }\n\n    // Si no es string, intentar convertirlo a string\n    if (typeof timeArray !== \"string\") {\n        timeArray = String(timeArray);\n    }\n\n    // Verificar que contenga \":\"\n    if (timeArray.indexOf(\":\") === -1) {\n        return 0;\n    }\n\n    // Separar en partes\n    var partes = timeArray.split(\":\").map(function(x) { return parseInt(x, 10) || 0; });\n\n    // dd:hh:mm:ss\n    if (partes.length === 4) {\n        return (partes[0] * 24 * 3600) + (partes[1] * 3600) + (partes[2] * 60) + partes[3];\n    }\n\n    // hh:mm:ss\n    if (partes.length === 3) {\n        return (partes[0] * 3600) + (partes[1] * 60) + partes[2];\n    }\n\n    // Cualquier otro formato\n    return 0;\n}\n\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1762272423995,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "49656c00-b993-11f0-9cd0-35be421ad23c"
      },
      "name" : "linea1 procesar",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 552,
        "layoutY" : 59
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var msgout={};\n\n switch (msg.evento) {\n     case \"INICIO_INACTIVIDAD\":\n        msgout.westado=\"EN INACTIVIDAD\";\n        break;\n     case \"INICIO_OPERACION\":\n        msgout.westado=\"EN OPERACIÓN\";\n        break;\n     case \"INICIO_PARADA\":\n        msgout.westado=\"EN PARADA\";\n        break;\n     case \"INICIO_INSPECCION\":\n        msgout.westado=\"EN INSPECCIÓN\";\n        break;\n     case \"INICIO_LEVANTAMIENTO\":\n        msgout.westado=\"EN LEVANTAMIENTO\";\n        break;\n\n     default:\n       // msgout.westado= msg.estado;\n        break;\n   }\n\nreturn {msg: msgout, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1762360329207,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "47d41200-ba61-11f0-9cd0-35be421ad23c"
      },
      "name" : "estado widget",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 823,
        "layoutY" : 56
      },
      "configuration" : {
        "defaultTTL" : 0,
        "useServerTs" : false,
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        }
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "5d70c130-ba61-11f0-9cd0-35be421ad23c"
      },
      "name" : "save westado",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 82,
        "layoutY" : 861
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "00ca99b0-ba6b-11f0-9cd0-35be421ad23c"
      },
      "name" : "Format",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1164,
        "layoutY" : 821
      },
      "configuration" : {
        "originatorSource" : "ENTITY",
        "entityType" : "DEVICE",
        "entityNamePattern" : "${nombre_operario}",
        "relationsQuery" : {
          "direction" : "FROM",
          "maxLevel" : 1,
          "filters" : [ {
            "relationType" : "Contains",
            "entityTypes" : [ ],
            "negate" : false
          } ],
          "fetchLastLevelOnly" : false
        }
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "00ca99b1-ba6b-11f0-9cd0-35be421ad23c"
      },
      "name" : "Redirigir a operario",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbChangeOriginatorNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 391,
        "layoutY" : 828
      },
      "configuration" : {
        "tellFailureIfAbsent" : true,
        "fetchTo" : "METADATA",
        "clientAttributeNames" : [ ],
        "sharedAttributeNames" : [ ],
        "serverAttributeNames" : [ ],
        "latestTsKeyNames" : [ "nombre_operario" ],
        "getLatestValueWithTs" : false
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "00ca99b2-ba6b-11f0-9cd0-35be421ad23c"
      },
      "name" : "Jalar nombre de operario",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 662,
        "layoutY" : 838
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "475d28c0-ba6b-11f0-9cd0-35be421ad23c"
      },
      "name" : "Format",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 923,
        "layoutY" : 832
      },
      "configuration" : {
        "version" : 0
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "475d4fd0-ba6b-11f0-9cd0-35be421ad23c"
      },
      "name" : "Separar por operarios",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbSplitArrayMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1404,
        "layoutY" : 835
      },
      "configuration" : {
        "defaultTTL" : 0,
        "useServerTs" : false,
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        }
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "475d4fd1-ba6b-11f0-9cd0-35be421ad23c"
      },
      "name" : "save",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 745,
        "layoutY" : 243
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var outmsg={};\noutmsg.unidades_ALAprimera=msg.unidades_ALAprimera;\noutmsg.unidades_retrabajadas=msg.unidades_retrabajadas;\noutmsg.unidades_ensambladas=msg.unidades_ensambladas;\n\noutmsg.disponibilidad=msg.disponibilidad;\noutmsg.cantidad_teorica=msg.cantidad_teorica;\n\nreturn {msg: outmsg, metadata: metadata, msgType: 'POST_ATTRIBUTES_REQUEST'};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1762373737629,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "6af44e50-ba6e-11f0-9cd0-35be421ad23c"
      },
      "name" : "convert atributos 1.9",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1015,
        "layoutY" : 249
      },
      "configuration" : {
        "tellFailureIfAbsent" : true,
        "fetchTo" : "DATA",
        "clientAttributeNames" : [ ],
        "sharedAttributeNames" : [ ],
        "serverAttributeNames" : [ ],
        "latestTsKeyNames" : [ "c_unidades_ALAprimera", "c_unidades_retrabajadas", "c_unidades_ensambladas" ],
        "getLatestValueWithTs" : false
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "0ead13e0-ba71-11f0-9cd0-35be421ad23c"
      },
      "name" : "c_unidades 1.9",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1261,
        "layoutY" : 249
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "\nvar c=msg.c_unidades_ALAprimera+1;\nvar r=msg.c_unidades_retrabajadas+1;\nvar e=msg.c_unidades_ensambladas+1;\n\n\nif(msg.unidades_ensambladas){\n    //var e=msg.c_unidades_ensambladas+1;\n    msg.c_unidades_ensambladas=e;\n    metadata.unidades_ensambladas=e;\n    \n    msg.OEE=(msg.disponibilidad)*(c)*100/(msg.cantidad_teorica);\n    msg.Complemento_OEE=(100-((msg.disponibilidad)*(c)*100/(msg.cantidad_teorica)));\n    \n    \n\nif(msg.unidades_ALAprimera){\n  //var c=msg.c_unidades_ALAprimera+1;\n   msg.c_unidades_ALAprimera=c;\n   metadata.c_unidades_ALAprimera=c;\n   \n   msg.p_ALAprimera=(c/e).toFixed(2) ;\n   msg.p_retrabajadas=(1-(c/e)).toFixed(2) ;\n   metadata.p_ALAprimera=(c/e).toFixed(2) ;\n   \n   \n}\nif(msg.unidades_retrabajadas){\n   //var r=msg.c_unidades_retrabajadas+1;\n   msg.c_unidades_retrabajadas=r;\n   metadata.c_unidades_retrabajadas=r;\n   \n   msg.p_ALAprimera=(1-(r/e)).toFixed(2)  ;\n   msg.p_retrabajadas=(r/e).toFixed(2) ;\n   metadata.p_retrabajadas=(r/e).toFixed(2) ;\n}\n\n\n    \n    \n\n}\nreturn {msg: msg, metadata: metadata, msgType: msgType};\n\n//e=c+r",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "0ead3af0-ba71-11f0-9cd0-35be421ad23c"
      },
      "name" : "procesar 1.9",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1498,
        "layoutY" : 251
      },
      "configuration" : {
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        },
        "scope" : "SERVER_SCOPE",
        "notifyDevice" : false,
        "sendAttributesUpdatedNotification" : false,
        "updateAttributesOnlyOnValueChange" : true
      },
      "configurationVersion" : 3,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "0ead3af1-ba71-11f0-9cd0-35be421ad23c"
      },
      "name" : "save contadores atributos 1.9",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1328,
        "layoutY" : 320
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "\n\nreturn {msg: msg, metadata: metadata, msgType: 'POST_TELEMETRY_REQUEST'};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "0ead3af2-ba71-11f0-9cd0-35be421ad23c"
      },
      "name" : "convert telemetry 1.9",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1553,
        "layoutY" : 312
      },
      "configuration" : {
        "defaultTTL" : 0,
        "useServerTs" : false,
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        }
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "0ead3af3-ba71-11f0-9cd0-35be421ad23c"
      },
      "name" : "save contadores telemetry 1.9",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 487,
        "layoutY" : 189
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "function nextRelation(metadata, msg) {\n    return ['one','nine'];\n}\nif(msgType === 'POST_TELEMETRY_REQUEST') {\n    return ['two'];\n}\nreturn nextRelation(metadata, msg);",
        "tbelScript" : "function nextRelation(metadata, msg) {\n    if(metadata.deviceName != \"Estación 1.9\") {\n        return ['1.0 - 1.8'];\n    }\n    else {\n        return ['1.9'];\n    }\n}\n\nreturn nextRelation(metadata, msg);"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1762373737629,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "400e9390-ba81-11f0-9cd0-35be421ad23c"
      },
      "name" : "sdssds",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsSwitchNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 736,
        "layoutY" : 296
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var msgout={};\nif(metadata.deviceName == \"Estación 1.0\"){\n    msgout=msg;\n}\n\nreturn {msg: msgout, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7c832fe0-ba8e-11f0-9cd0-35be421ad23c"
      },
      "name" : "filtrar estacion 1.0",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1008,
        "layoutY" : 298
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var msgout={};\nif(msg.evento==\"INICIO_ESTACION\"){\n    \n    msgout.unidades_planificadas=msg.unidades_planificadas;\n    \n\n    \n\n    \n}\nreturn {msg: msgout, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1762380202308,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "11be4fe0-ba8f-11f0-9cd0-35be421ad23c"
      },
      "name" : "filtrar INICIO_ESTACION EBENTO",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1265,
        "layoutY" : 389
      },
      "configuration" : {
        "defaultTTL" : 0,
        "useServerTs" : false,
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        }
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "a46afcd0-ba8f-11f0-9cd0-35be421ad23c"
      },
      "name" : "unidades_planificadas",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    } ],
    "ruleChainConnections" : null
  },
  "relations" : [ {
    "additionalInfo" : null,
    "from" : {
      "entityType" : "RULE_CHAIN",
      "id" : "67a610a0-8f1f-11f0-a61c-01e0c85fd5dd"
    },
    "to" : {
      "entityType" : "RULE_CHAIN",
      "id" : "9e8cb6b0-a53f-11f0-9abe-2dfd6db9cae3"
    },
    "type" : "Uses",
    "typeGroup" : "COMMON",
    "version" : 112926
  } ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}