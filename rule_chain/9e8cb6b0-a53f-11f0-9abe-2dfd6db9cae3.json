{
  "entityType" : "RULE_CHAIN",
  "entity" : {
    "additionalInfo" : {
      "description" : ""
    },
    "configuration" : null,
    "debugMode" : false,
    "externalId" : null,
    "firstRuleNodeId" : {
      "entityType" : "RULE_NODE",
      "id" : "67654bc0-b43a-11f0-9cd0-35be421ad23c"
    },
    "id" : {
      "entityType" : "RULE_CHAIN",
      "id" : "9e8cb6b0-a53f-11f0-9abe-2dfd6db9cae3"
    },
    "name" : "Process",
    "root" : false,
    "type" : "CORE"
  },
  "metaData" : {
    "connections" : [ {
      "fromIndex" : 1,
      "toIndex" : 5,
      "type" : "Success"
    }, {
      "fromIndex" : 2,
      "toIndex" : 1,
      "type" : "Failure"
    }, {
      "fromIndex" : 2,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 4,
      "toIndex" : 3,
      "type" : "Success"
    }, {
      "fromIndex" : 6,
      "toIndex" : 0,
      "type" : "Success"
    }, {
      "fromIndex" : 6,
      "toIndex" : 15,
      "type" : "Success"
    }, {
      "fromIndex" : 6,
      "toIndex" : 16,
      "type" : "Success"
    }, {
      "fromIndex" : 6,
      "toIndex" : 27,
      "type" : "Success"
    }, {
      "fromIndex" : 6,
      "toIndex" : 31,
      "type" : "Success"
    }, {
      "fromIndex" : 6,
      "toIndex" : 34,
      "type" : "Success"
    }, {
      "fromIndex" : 7,
      "toIndex" : 8,
      "type" : "Success"
    }, {
      "fromIndex" : 8,
      "toIndex" : 9,
      "type" : "Success"
    }, {
      "fromIndex" : 9,
      "toIndex" : 10,
      "type" : "Success"
    }, {
      "fromIndex" : 9,
      "toIndex" : 12,
      "type" : "Success"
    }, {
      "fromIndex" : 12,
      "toIndex" : 11,
      "type" : "Success"
    }, {
      "fromIndex" : 13,
      "toIndex" : 14,
      "type" : "Success"
    }, {
      "fromIndex" : 15,
      "toIndex" : 13,
      "type" : "Success"
    }, {
      "fromIndex" : 16,
      "toIndex" : 17,
      "type" : "Success"
    }, {
      "fromIndex" : 18,
      "toIndex" : 20,
      "type" : "Success"
    }, {
      "fromIndex" : 19,
      "toIndex" : 32,
      "type" : "Success"
    }, {
      "fromIndex" : 21,
      "toIndex" : 22,
      "type" : "Success"
    }, {
      "fromIndex" : 22,
      "toIndex" : 23,
      "type" : "Success"
    }, {
      "fromIndex" : 23,
      "toIndex" : 24,
      "type" : "Success"
    }, {
      "fromIndex" : 23,
      "toIndex" : 25,
      "type" : "Success"
    }, {
      "fromIndex" : 25,
      "toIndex" : 26,
      "type" : "Success"
    }, {
      "fromIndex" : 27,
      "toIndex" : 7,
      "type" : "1.0 - 1.8"
    }, {
      "fromIndex" : 27,
      "toIndex" : 21,
      "type" : "1.9"
    }, {
      "fromIndex" : 27,
      "toIndex" : 28,
      "type" : "1.0 - 1.8"
    }, {
      "fromIndex" : 28,
      "toIndex" : 29,
      "type" : "Success"
    }, {
      "fromIndex" : 29,
      "toIndex" : 30,
      "type" : "Success"
    }, {
      "fromIndex" : 31,
      "toIndex" : 19,
      "type" : "Success"
    }, {
      "fromIndex" : 32,
      "toIndex" : 18,
      "type" : "Success"
    }, {
      "fromIndex" : 33,
      "toIndex" : 47,
      "type" : "Success"
    }, {
      "fromIndex" : 34,
      "toIndex" : 35,
      "type" : "True"
    }, {
      "fromIndex" : 35,
      "toIndex" : 36,
      "type" : "Success"
    }, {
      "fromIndex" : 36,
      "toIndex" : 42,
      "type" : "Success"
    }, {
      "fromIndex" : 36,
      "toIndex" : 45,
      "type" : "Success"
    }, {
      "fromIndex" : 37,
      "toIndex" : 41,
      "type" : "Success"
    }, {
      "fromIndex" : 38,
      "toIndex" : 39,
      "type" : "Success"
    }, {
      "fromIndex" : 39,
      "toIndex" : 40,
      "type" : "Success"
    }, {
      "fromIndex" : 41,
      "toIndex" : 38,
      "type" : "True"
    }, {
      "fromIndex" : 45,
      "toIndex" : 33,
      "type" : "Success"
    }, {
      "fromIndex" : 45,
      "toIndex" : 46,
      "type" : "Success"
    }, {
      "fromIndex" : 47,
      "toIndex" : 48,
      "type" : "True"
    }, {
      "fromIndex" : 48,
      "toIndex" : 49,
      "type" : "Success"
    } ],
    "firstNodeIndex" : 6,
    "nodes" : [ {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1126,
        "layoutY" : 143
      },
      "configuration" : {
        "version" : 0
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "fd846e50-a540-11f0-9abe-2dfd6db9cae3"
      },
      "name" : "Output",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.flow.TbRuleChainOutputNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 391,
        "layoutY" : 956
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "if(msg.evento === \"FIN_OPERACION\"){\n    var unidades_ensambladas_anterior = parseInt(metadata.unidades_ensambladas) || 0;\n    msg.unidades_ensambladas = unidades_ensambladas_anterior + 1;\n    \n    var tiempo_inicio = metadata.shared_tiempo_inicio;\n    var tiempo_final = metadata.shared_tiempo_final;\n    msg.tiempo_operacion = tiempo_final - tiempo_inicio;\n}\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1760044271632,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "fd846e51-a540-11f0-9abe-2dfd6db9cae3"
      },
      "name" : "Unidades Ensambladas",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 84,
        "layoutY" : 957
      },
      "configuration" : {
        "tellFailureIfAbsent" : true,
        "fetchTo" : "METADATA",
        "clientAttributeNames" : [ ],
        "sharedAttributeNames" : [ "tiempo_inicio", "tiempo_fin" ],
        "serverAttributeNames" : [ ],
        "latestTsKeyNames" : [ "unidades_ensambladas" ],
        "getLatestValueWithTs" : false
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1760044271632,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "67a0e3e0-a541-11f0-9abe-2dfd6db9cae3"
      },
      "name" : "Fetch Unidades ensambladas",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 537,
        "layoutY" : 1039
      },
      "configuration" : {
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        },
        "scope" : "SHARED_SCOPE",
        "notifyDevice" : false,
        "sendAttributesUpdatedNotification" : false,
        "updateAttributesOnlyOnValueChange" : false
      },
      "configurationVersion" : 3,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "3367caa0-a567-11f0-9abe-2dfd6db9cae3"
      },
      "name" : "Save Attributes",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 290,
        "layoutY" : 1035
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var newMsg = {};\n\nif(msg.evento === \"IDENTIFICACION\"){\n    newMsg.tiempo_inicio = metadata.ts;\n}\nif(msg.evento === \"IDENTIFICACION\"){\n    newMsg.tiempo_fin = metadata.ts;\n}\n\nreturn {msg: newMsg, metadata: metadata, msgType: 'POST_ATTRIBUTES_REQUEST'};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "3367f1b0-a567-11f0-9abe-2dfd6db9cae3"
      },
      "name" : "Prepare Attributes",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 708,
        "layoutY" : 954
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "// List of keys to convert\nvar keysToConvert = ['tiempo_total', 'tiempo_parada', 'tiempo_espera']; \n\nkeysToConvert.forEach(function(key) {\n    if (msg[key]) {\n        var timeStr = msg[key];\n        var parts = timeStr.split(\":\");\n\n        // Ensure valid 4-part format (D:H:M:S)\n        if (parts.length === 4) {\n            var days = parseInt(parts[0], 10);\n            var hours = parseInt(parts[1], 10);\n            var minutes = parseInt(parts[2], 10);\n            var seconds = parseInt(parts[3], 10);\n\n            var totalSeconds = (((days * 24 + hours) * 60 + minutes) * 60) + seconds;\n\n            msg[key] = totalSeconds;\n        } else {\n            // optional: log invalid format\n            // logger.warn(\"Invalid time format for key \" + key + \": \" + timeStr);\n        }\n    }\n});\n\nreturn { msg: msg, metadata: metadata, msgType: msgType };\n\n\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "0359ab50-a56a-11f0-9abe-2dfd6db9cae3"
      },
      "name" : "HH:MM:SS to seconds",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 263,
        "layoutY" : 154
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "\n\n if(msg.nombre_operario)  {\nmsg.string_nombre_operario = msg.nombre_operario.join(\", \"); //variable para nombre_operario\n\n}\n//********************************************************************************************************\n\nif (msg.evento==\"FIN_ESTACION\"){\n    \n    \n  if(msg.unidad_terminada){\n    var unidades_ensambladas;\n    unidades_ensambladas=1;\n    \n    msg.unidades_ensambladas=unidades_ensambladas;\n    \n\n    \n      if(msg.contador_levantamiento ==0){\n     \n          msg.unidades_ALAprimera=\"true\";\n          \n       }\n      else{\n          \n          msg.unidades_retrabajadas=\"true\";\n          \n      \n        }\n    }\n  else{\n    unidades_ensambladas=0;\n    msg.unidades_ensambladas=unidades_ensambladas;\n    }\n      \n  //unidades_ensambladas=unidades_ALAprimera+unidades_retrabajadas;\n  \n\n  msg.disponibilidad=(tiempoSegundos(msg.tiempo_activo))/(tiempoSegundos(msg.tiempo_estandar)); //usadado para estacion 1.9\n  msg.cantidad_teorica=msg.produccion_teorica;\n  \n  \n  msg.pe_operario=(msg.tiempo_estandar)/(msg.tiempo_total); //eficiencia operario\n  \n  msg.tiempo_total=tiempoSegundos(msg.tiempo_total);\n  msg.tiempo_activo=tiempoSegundos(msg.tiempo_activo);\n  msg.p_efectivo=(msg.tiempo_activo)/(msg.tiempo_total);\n      }\n\n//**********************************************************************************************************\nelse if(msg.evento==\"FIN_OPERACION\"){\n    \n    \n    //msg.tiempo_estado=tiempoSegundos(msg.tiempo_estado);\n    \n\n    \n}\n//**********************************************************************************************************\nelse if(msg.evento==\"FIN_PARADA\"){\n    \n        var categoria = null;\n    if (Array.isArray(msg.causa) && msg.causa.length > 0 && msg.causa[0].categoria) {\n        categoria = msg.causa[0].categoria;\n    }\n\n//------------------------------------------------------------------------\n    if( categoria==\"PROBLEMA DE ENSAMBLAJE\" ){\n        \n        msg.cont_PROBLEMA_DE_ENSAMBLAJE=1;         //contador de tipo de categoria\n        msg.tiempo_paradas_causa1=tiempoSegundos(msg.tiempo_estado); //tiempo en segundos, variable para sumar solo de esa causa.\n        \n        //msg.counter_parada_PROBLEMA_DE_ENSAMBLAJE=1;                  //VARIABLE PARA ACUMULAR CANTIDAD DE CAUSA 1 EN LINEA 1    \n        msg.time_parada=tiempoSegundos(msg.tiempo_estado);           //variable usada para acumular tiempo de todas las causas.\n    }\n    \n    else if(categoria==\"INSTRUCTIVO REQUIERE REVISION\"){\n        \n        msg.cont_INSTRUCTIVO_REQUIERE_REVISION=1;\n        msg.tiempo_paradas_causa2=tiempoSegundos(msg.tiempo_estado);\n        \n        //msg.counter_INSTRUCTIVO_REQUIERE_REVISION=1; \n        msg.time_parada=tiempoSegundos(msg.tiempo_estado);\n    }\n    \n    else if( categoria==\"LISTA DE ESPECIFICACIONES REQUIERE REVISION\" ){\n        \n        msg.cont_LISTA_DE_ESPECIFICACIONES_REQUIERE_REVISION=1;\n        msg.tiempo_paradas_causa3=tiempoSegundos(msg.tiempo_estado);\n        \n        //msg.counter_parada_LISTA_DE_ESPECIFICACIONES_REQUIERE_REVISION=1; \n        msg.time_parada=tiempoSegundos(msg.tiempo_estado);\n    }\n    \n    else if(categoria==\"PROBLEMA DE SUMINISTRO\"   ){\n        \n        msg.cont_PROBLEMA_DE_SUMINISTRO=1;\n        msg.tiempo_paradas_causa4=tiempoSegundos(msg.tiempo_estado);\n        \n        //msg.counter_parada_PROBLEMA_DE_SUMINISTRO=1; \n        msg.time_parada=tiempoSegundos(msg.tiempo_estado);\n    }\n    \n    else if( categoria==\"PROBLEMA DE PRUEBA\"   ){\n        \n        msg.cont_PROBLEMA_DE_PRUEBA=1;\n        msg.tiempo_paradas_causa5=tiempoSegundos(msg.tiempo_estado);\n        \n        //msg.counter_parada_PROBLEMA_DE_PRUEBA=1; \n        msg.time_parada=tiempoSegundos(msg.tiempo_estado);\n    }\n    \n    else if( categoria==\"ESPACIO NO DISPONIBLE PARA ABASTECIMIENTO\"   ){\n        \n        msg.cont_ESPACIO_NO_DISPONIBLE_PARA_ABASTECIMIENTO=1;\n        msg.tiempo_paradas_causa6=tiempoSegundos(msg.tiempo_estado);\n        \n        //msg.counter_parada_ESPACION_NO_DISPONIBLE_PARA_ABASTECIMIENTO=1; \n        msg.time_parada=tiempoSegundos(msg.tiempo_estado);\n    }\n    \n    else if( categoria==\"OTRO\" ){\n        \n        msg.cont_OTRO=1;\n        msg.tiempo_paradas_causa7=tiempoSegundos(msg.tiempo_estado);\n        \n        //msg.counter_parada_OTRO=1; \n        msg.time_parada=tiempoSegundos(msg.tiempo_estado);\n    }\n    else{\n        msg.z_status_evento_causa=\"sin causa null\";\n    }\n    \n    \n    \n   \n   msg.z_status_evento=\"FIN_PARADA\"; //variable para admin ver que parte del codigo se ejecuto.\n    \n}\n\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};\n\n// funciones $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$\n \n /*\n    function tiempoSegundos(timeArray){\n        //se calcula los segundos totales\n        var partes =timeArray.split(':').map(Number);\n         //if (partes.length !== 4) {\n         //throw new Error(\"El formato debe ser dd:hh:mm:ss\");\n    \n         //}\n  var dias=partes[0]*24*3600;\n  var horas=partes[1]*3600;\n  var minutos=partes[2]*60;\n  var segundos=partes[3];\n\n        \n    return dias+horas+minutos+segundos;\n\n}\n*/\n \n//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$\nfunction tiempoSegundos(timeArray) {\n    // Si no existe, devolver 0\n    if (timeArray === undefined || timeArray === null) {\n        return 0;\n    }\n\n    // Si no es string, intentar convertirlo a string\n    if (typeof timeArray !== \"string\") {\n        timeArray = String(timeArray);\n    }\n\n    // Verificar que contenga \":\"\n    if (timeArray.indexOf(\":\") === -1) {\n        return 0;\n    }\n\n    // Separar en partes\n    var partes = timeArray.split(\":\").map(function(x) { return parseInt(x, 10) || 0; });\n\n    // dd:hh:mm:ss\n    if (partes.length === 4) {\n        return (partes[0] * 24 * 3600) + (partes[1] * 3600) + (partes[2] * 60) + partes[3];\n    }\n\n    // hh:mm:ss\n    if (partes.length === 3) {\n        return (partes[0] * 3600) + (partes[1] * 60) + partes[2];\n    }\n\n    // Cualquier otro formato\n    return 0;\n}\n\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "67654bc0-b43a-11f0-9cd0-35be421ad23c"
      },
      "name" : "evento",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 745,
        "layoutY" : 195
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "var outmsg={};\noutmsg.unidades_ALAprimera=msg.unidades_ALAprimera;\noutmsg.unidades_retrabajadas=msg.unidades_retrabajadas;\noutmsg.unidades_ensambladas=msg.unidades_ensambladas;\n\n//outmsg.c_unidades_ALAprimera=msg.c_unidades_ALAprimera;\n//outmsg.cont2=msg.cont2;\n\nreturn {msg: outmsg, metadata: metadata, msgType: 'POST_ATTRIBUTES_REQUEST'};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "f8ca88b0-b4f7-11f0-9cd0-35be421ad23c"
      },
      "name" : "convert atributos",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 958,
        "layoutY" : 192
      },
      "configuration" : {
        "tellFailureIfAbsent" : true,
        "fetchTo" : "DATA",
        "clientAttributeNames" : [ ],
        "sharedAttributeNames" : [ ],
        "serverAttributeNames" : [ ],
        "latestTsKeyNames" : [ "c_unidades_ALAprimera", "c_unidades_retrabajadas", "c_unidades_ensambladas" ],
        "getLatestValueWithTs" : false
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7ce9d140-b4f9-11f0-9cd0-35be421ad23c"
      },
      "name" : "c_unidades",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1173,
        "layoutY" : 191
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "\nvar c=msg.c_unidades_ALAprimera+1;\nvar r=msg.c_unidades_retrabajadas+1;\nvar e=msg.c_unidades_ensambladas+1;\n\nif(msg.unidades_ALAprimera){\n  //var c=msg.c_unidades_ALAprimera+1;\n   msg.c_unidades_ALAprimera=c;\n   metadata.c_unidades_ALAprimera=c;\n   \n   msg.p_ALAprimera=(c/e).toFixed(2) ;\n   msg.p_retrabajadas=(1-(c/e)).toFixed(2) ;\n   metadata.p_ALAprimera=(c/e).toFixed(2) ;\n   \n   \n}\nif(msg.unidades_retrabajadas){\n   //var r=msg.c_unidades_retrabajadas+1;\n   msg.c_unidades_retrabajadas=r;\n   metadata.c_unidades_retrabajadas=r;\n   \n   msg.p_ALAprimera=(1-(r/e)).toFixed(2)  ;\n   msg.p_retrabajadas=(r/e).toFixed(2) ;\n   metadata.p_retrabajadas=(r/e).toFixed(2) ;\n}\n\nif(msg.unidades_ensambladas){\n    //var e=msg.c_unidades_ensambladas+1;\n    msg.c_unidades_ensambladas=e;\n    metadata.unidades_ensambladas=e;\n    \n    \n\n}\nreturn {msg: msg, metadata: metadata, msgType: msgType};\n\n//e=c+r",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "c3aa8950-b506-11f0-9cd0-35be421ad23c"
      },
      "name" : "procesar",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1440,
        "layoutY" : 59
      },
      "configuration" : {
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        },
        "scope" : "SERVER_SCOPE",
        "notifyDevice" : false,
        "sendAttributesUpdatedNotification" : false,
        "updateAttributesOnlyOnValueChange" : true
      },
      "configurationVersion" : 3,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "03d2cde0-b50b-11f0-9cd0-35be421ad23c"
      },
      "name" : "save contadores atributos",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1439,
        "layoutY" : 124
      },
      "configuration" : {
        "defaultTTL" : 0,
        "useServerTs" : false,
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        }
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b23fade0-b50f-11f0-9cd0-35be421ad23c"
      },
      "name" : "save contadores telemetry",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1416,
        "layoutY" : 195
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "\n\nreturn {msg: msg, metadata: metadata, msgType: 'POST_TELEMETRY_REQUEST'};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b23fd4f0-b50f-11f0-9cd0-35be421ad23c"
      },
      "name" : "convert telemetry",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 893,
        "layoutY" : 110
      },
      "configuration" : {
        "originatorSource" : "ENTITY",
        "entityType" : "DEVICE",
        "entityNamePattern" : "line1",
        "relationsQuery" : {
          "direction" : "FROM",
          "maxLevel" : 1,
          "filters" : [ {
            "relationType" : "Contains",
            "entityTypes" : [ ],
            "negate" : false
          } ],
          "fetchLastLevelOnly" : false
        }
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "4e419250-b914-11f0-9cd0-35be421ad23c"
      },
      "name" : "para Linea1",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbChangeOriginatorNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1144,
        "layoutY" : 72
      },
      "configuration" : {
        "defaultTTL" : 0,
        "useServerTs" : false,
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        }
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "4e419251-b914-11f0-9cd0-35be421ad23c"
      },
      "name" : "save linea 1",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 567,
        "layoutY" : 113
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var msgout={};\n//------------------------------------------------------------\n if(msg.nombre_operario)  {\nmsg.string_nombre_operario = msg.nombre_operario.join(\", \"); //variable para nombre_operario\n\n}\n//********************************************************************************************************\n\nif (msg.evento==\"FIN_ESTACION\"){\n    \n    \n  if(msg.unidad_terminada){\n    var unidades_ensambladas;\n    unidades_ensambladas=1;\n    \n    msgout.unidades_ensambladasL=unidades_ensambladas;\n    \n    \n      if(msg.contador_levantamiento ==0){\n     \n          msg.unidades_ALAprimera=\"true\";\n          \n       }\n      else{\n          \n          msg.unidades_retrabajadas=\"true\";\n          \n      \n        }\n        \n     if(msg.contador_inspeccion ==1){\n     \n          msgout.unidades_buenas=1;\n          \n       }\n      else if(msg.contador_inspeccion >=1){\n          \n          msgout.unidades_defecto=1;\n          \n      \n        }\n        \n        \n    switch (metadata.deviceName) {\n     case \"Estación 1.0\":\n        msgout.UE_10=1;\n        break;\n     case \"Estación 1.1\":\n        msgout.UE_11=1;\n        break;\n     case \"Estación 1.2\":\n        msgout.UE_12=1;\n        break;\n     case \"Estación 1.3\":\n        msgout.UE_13=1;\n        break;\n     case \"Estación 1.4\":\n        msgout.UE_14=1;\n        break;\n     case \"Estación 1.5\":\n        msgout.UE_15=1;\n        break;\n     case \"Estación 1.6\":\n        msgout.UE_16=1;\n        break;\n     case \"Estación 1.7\":\n        msgout.UE_17=1;\n        break;\n     case \"Estación 1.8\":\n        msgout.UE_18=1;\n        break;\n     case \"Estación 1.9\":\n        msgout.UE_19=1;\n        break;\n        \n     default:\n        msgout.alerta= \"no es dispositivo\";\n        break;\n   }\n  \n    }\n  else{\n    unidades_ensambladas=0;\n    msg.unidades_ensambladas=unidades_ensambladas;\n    }\n    \n    \n      \n  //unidades_ensambladas=unidades_ALAprimera+unidades_retrabajadas;\n  \n\n  \n\n  msg.tiempo_total=tiempoSegundos(msg.tiempo_total);\n  msg.tiempo_activo=tiempoSegundos(msg.tiempo_activo);\n  msg.p_efectivo=(msg.tiempo_activo)/(msg.tiempo_total);\n      }\n\n//**********************************************************************************************************\nelse if(msg.evento==\"FIN_OPERACION\"){\n    \n    \n    //msg.tiempo_estado=tiempoSegundos(msg.tiempo_estado);\n    \n\n    \n}\n//**********************************************************************************************************\nelse if(msg.evento==\"FIN_PARADA\"){\n    \n        switch (metadata.deviceName) {\n     case \"Estación 1.0\":\n        msgout.PARADAS_10=1;\n        break;\n     case \"Estación 1.1\":\n        msgout.PARADAS_11=1;\n        break;\n     case \"Estación 1.2\":\n        msgout.PARADAS_12=1;\n        break;\n     case \"Estación 1.3\":\n        msgout.PARADAS_13=1;\n        break;\n     case \"Estación 1.4\":\n        msgout.PARADAS_14=1;\n        break;\n     case \"Estación 1.5\":\n        msgout.PARADAS_15=1;\n        break;\n     case \"Estación 1.6\":\n        msgout.PARADAS_16=1;\n        break;\n     case \"Estación 1.7\":\n        msgout.PARADAS_17=1;\n        break;\n     case \"Estación 1.8\":\n        msgout.PARADAS_18=1;\n        break;\n     case \"Estación 1.9\":\n        msgout.PARADAS_19=1;\n        break;\n        \n     default:\n        msgout.alerta= \"DISPOSITIVO NO REGISTRADO\";\n        break;\n   }\n   //-------------------------------------------------------------------------------\n    \n        var categoria = null;\n    if (Array.isArray(msg.causa) && msg.causa.length > 0 && msg.causa[0].categoria) {\n        categoria = msg.causa[0].categoria;\n    }\n\n//------------------------------------------------------------------------\n    if( categoria==\"PROBLEMA DE ENSAMBLAJE\" ){\n        \n        msg.cont_PROBLEMA_DE_ENSAMBLAJE=1;         //contador de tipo de categoria\n        msg.tiempo_paradas_causa1=tiempoSegundos(msg.tiempo_estado); //tiempo en segundos, variable para sumar solo de esa causa.\n        \n        msgout.counter_parada_PROBLEMA_DE_ENSAMBLAJE=1;                                     //VARIABLE PARA ACUMULAR CANTIDAD DE CAUSA 1 EN LINEA 1    \n        msgout.time_parada_PROBLEMA_DE_ENSAMBLAJE=tiempoSegundos(msg.tiempo_estado);        //VARIABLE PARA ACUMULAR TIEMPO DE CAUSA 1 EN LINEA 1\n    }\n    \n    else if(categoria==\"INSTRUCTIVO REQUIERE REVISION\"){\n        \n        msg.cont_INSTRUCTIVO_REQUIERE_REVISION=1;\n        msg.tiempo_paradas_causa2=tiempoSegundos(msg.tiempo_estado);\n        \n        msgout.counter_parada_INSTRUCTIVO_REQUIERE_REVISION=1; \n        msgout.time_parada_INSTRUCTIVO_REQUIERE_REVISION=tiempoSegundos(msg.tiempo_estado);\n    }\n    \n    else if( categoria==\"LISTA DE ESPECIFICACIONES REQUIERE REVISION\" ){\n        \n        msg.cont_LISTA_DE_ESPECIFICACIONES_REQUIERE_REVISION=1;\n        msg.tiempo_paradas_causa3=tiempoSegundos(msg.tiempo_estado);\n        \n        msgout.counter_parada_LISTA_DE_ESPECIFICACIONES_REQUIERE_REVISION=1; \n        msgout.time_parada_LISTA_DE_ESPECIFICACIONES_REQUIERE_REVISION=tiempoSegundos(msg.tiempo_estado);\n    }\n    \n    else if(categoria==\"PROBLEMA DE SUMINISTRO\"   ){\n        \n        msg.cont_PROBLEMA_DE_SUMINISTRO=1;\n        msg.tiempo_paradas_causa4=tiempoSegundos(msg.tiempo_estado);\n        \n        msgout.counter_parada_PROBLEMA_DE_SUMINISTRO=1; \n        msgout.time_parada_PROBLEMA_DE_SUMINISTRO=tiempoSegundos(msg.tiempo_estado);\n    }\n    \n    else if( categoria==\"PROBLEMA DE PRUEBA\"   ){\n        \n        msg.cont_PROBLEMA_DE_PRUEBA=1;\n        msg.tiempo_paradas_causa5=tiempoSegundos(msg.tiempo_estado);\n        \n        msgout.counter_parada_PROBLEMA_DE_PRUEBA=1; \n        msgout.time_parada_PROBLEMA_DE_PRUEBA=tiempoSegundos(msg.tiempo_estado);\n    }\n    \n    else if( categoria==\"ESPACIO NO DISPONIBLE PARA ABASTECIMIENTO\"   ){\n        \n        msg.cont_ESPACIO_NO_DISPONIBLE_PARA_ABASTECIMIENTO=1;\n        msg.tiempo_paradas_causa6=tiempoSegundos(msg.tiempo_estado);\n        \n        msgout.counter_parada_ESPACION_NO_DISPONIBLE_PARA_ABASTECIMIENTO=1; \n        msgout.time_parada_ESPACIO_NO_DISPONIBLE_PARA_ABASTECIMIENTO=tiempoSegundos(msg.tiempo_estado);\n    }\n    \n    else if( categoria==\"OTRO\" ){\n        \n        msg.cont_OTRO=1;\n        msg.tiempo_paradas_causa7=tiempoSegundos(msg.tiempo_estado);\n        \n        msgout.counter_parada_OTRO=1; \n        msgout.time_parada_OTRO=tiempoSegundos(msg.tiempo_estado);\n    }\n    else{\n        msgout.z_status_evento_causa=\"sin causa null\";\n    }\n    \n    \n   msgout.tiempo_linea_parada=tiempoSegundos(msg.tiempo_estado);\n   \n   msg.z_status_evento=\"FIN_PARADA\"; //variable para admin ver que parte del codigo se ejecuto.\n    \n}\n\n\nreturn {msg: msgout, metadata: metadata, msgType: msgType};\n\n// funciones $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$\n \n /*\n    function tiempoSegundos(timeArray){\n        //se calcula los segundos totales\n        var partes =timeArray.split(':').map(Number);\n         //if (partes.length !== 4) {\n         //throw new Error(\"El formato debe ser dd:hh:mm:ss\");\n    \n         //}\n  var dias=partes[0]*24*3600;\n  var horas=partes[1]*3600;\n  var minutos=partes[2]*60;\n  var segundos=partes[3];\n\n        \n    return dias+horas+minutos+segundos;\n\n}\n*/\n \n//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$\nfunction tiempoSegundos(timeArray) {\n    // Si no existe, devolver 0\n    if (timeArray === undefined || timeArray === null) {\n        return 0;\n    }\n\n    // Si no es string, intentar convertirlo a string\n    if (typeof timeArray !== \"string\") {\n        timeArray = String(timeArray);\n    }\n\n    // Verificar que contenga \":\"\n    if (timeArray.indexOf(\":\") === -1) {\n        return 0;\n    }\n\n    // Separar en partes\n    var partes = timeArray.split(\":\").map(function(x) { return parseInt(x, 10) || 0; });\n\n    // dd:hh:mm:ss\n    if (partes.length === 4) {\n        return (partes[0] * 24 * 3600) + (partes[1] * 3600) + (partes[2] * 60) + partes[3];\n    }\n\n    // hh:mm:ss\n    if (partes.length === 3) {\n        return (partes[0] * 3600) + (partes[1] * 60) + partes[2];\n    }\n\n    // Cualquier otro formato\n    return 0;\n}\n\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "49656c00-b993-11f0-9cd0-35be421ad23c"
      },
      "name" : "linea1 procesar",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 570,
        "layoutY" : 62
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var msgout={};\n\n switch (msg.evento) {\n     case \"INICIO_INACTIVIDAD\":\n        msgout.westado=\"EN INACTIVIDAD\";\n        break;\n     case \"INICIO_OPERACION\":\n        msgout.westado=\"EN OPERACIÓN\";\n        break;\n     case \"INICIO_PARADA\":\n        msgout.westado=\"EN PARADA\";\n        break;\n     case \"INICIO_INSPECCION\":\n        msgout.westado=\"EN INSPECCIÓN\";\n        break;\n     case \"INICIO_LEVANTAMIENTO\":\n        msgout.westado=\"EN LEVANTAMIENTO\";\n        break;\n\n     default:\n       // msgout.westado= msg.estado;\n        break;\n   }\n\nreturn {msg: msgout, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "47d41200-ba61-11f0-9cd0-35be421ad23c"
      },
      "name" : "estado widget",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 851,
        "layoutY" : 53
      },
      "configuration" : {
        "defaultTTL" : 0,
        "useServerTs" : false,
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        }
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "5d70c130-ba61-11f0-9cd0-35be421ad23c"
      },
      "name" : "save westado",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1182,
        "layoutY" : 447
      },
      "configuration" : {
        "originatorSource" : "ENTITY",
        "entityType" : "DEVICE",
        "entityNamePattern" : "$[nombre_operario]",
        "relationsQuery" : {
          "direction" : "FROM",
          "maxLevel" : 1,
          "filters" : [ {
            "relationType" : "Contains",
            "entityTypes" : [ ],
            "negate" : false
          } ],
          "fetchLastLevelOnly" : false
        }
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "00ca99b1-ba6b-11f0-9cd0-35be421ad23c"
      },
      "name" : "Redirigir a operario",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbChangeOriginatorNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 706,
        "layoutY" : 360
      },
      "configuration" : {
        "version" : 0
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "475d4fd0-ba6b-11f0-9cd0-35be421ad23c"
      },
      "name" : "Separar por operarios",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbSplitArrayMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1457,
        "layoutY" : 456
      },
      "configuration" : {
        "defaultTTL" : 0,
        "useServerTs" : false,
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        }
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "475d4fd1-ba6b-11f0-9cd0-35be421ad23c"
      },
      "name" : "save",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 745,
        "layoutY" : 243
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var outmsg={};\noutmsg.unidades_ALAprimera=msg.unidades_ALAprimera;\noutmsg.unidades_retrabajadas=msg.unidades_retrabajadas;\noutmsg.unidades_ensambladas=msg.unidades_ensambladas;\n\noutmsg.disponibilidad=msg.disponibilidad;\noutmsg.cantidad_teorica=msg.cantidad_teorica;\n\nreturn {msg: outmsg, metadata: metadata, msgType: 'POST_ATTRIBUTES_REQUEST'};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "6af44e50-ba6e-11f0-9cd0-35be421ad23c"
      },
      "name" : "convert atributos 1.9",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 957,
        "layoutY" : 245
      },
      "configuration" : {
        "tellFailureIfAbsent" : true,
        "fetchTo" : "DATA",
        "clientAttributeNames" : [ ],
        "sharedAttributeNames" : [ ],
        "serverAttributeNames" : [ ],
        "latestTsKeyNames" : [ "c_unidades_ALAprimera", "c_unidades_retrabajadas", "c_unidades_ensambladas" ],
        "getLatestValueWithTs" : false
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "0ead13e0-ba71-11f0-9cd0-35be421ad23c"
      },
      "name" : "c_unidades 1.9",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1177,
        "layoutY" : 246
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "\nvar c=msg.c_unidades_ALAprimera+1;\nvar r=msg.c_unidades_retrabajadas+1;\nvar e=msg.c_unidades_ensambladas+1;\n\n\nif(msg.unidades_ensambladas){\n    //var e=msg.c_unidades_ensambladas+1;\n    msg.c_unidades_ensambladas=e;\n    metadata.unidades_ensambladas=e;\n    \n    msg.OEE=(msg.disponibilidad)*(c)*100/(msg.cantidad_teorica);\n    msg.Complemento_OEE=(100-((msg.disponibilidad)*(c)*100/(msg.cantidad_teorica)));\n    \n    \n\nif(msg.unidades_ALAprimera){\n  //var c=msg.c_unidades_ALAprimera+1;\n   msg.c_unidades_ALAprimera=c;\n   metadata.c_unidades_ALAprimera=c;\n   \n   msg.p_ALAprimera=(c/e).toFixed(2) ;\n   msg.p_retrabajadas=(1-(c/e)).toFixed(2) ;\n   metadata.p_ALAprimera=(c/e).toFixed(2) ;\n   \n   \n}\nif(msg.unidades_retrabajadas){\n   //var r=msg.c_unidades_retrabajadas+1;\n   msg.c_unidades_retrabajadas=r;\n   metadata.c_unidades_retrabajadas=r;\n   \n   msg.p_ALAprimera=(1-(r/e)).toFixed(2)  ;\n   msg.p_retrabajadas=(r/e).toFixed(2) ;\n   metadata.p_retrabajadas=(r/e).toFixed(2) ;\n}\n\n\n    \n    \n\n}\nreturn {msg: msg, metadata: metadata, msgType: msgType};\n\n//e=c+r",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "0ead3af0-ba71-11f0-9cd0-35be421ad23c"
      },
      "name" : "procesar 1.9",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1412,
        "layoutY" : 250
      },
      "configuration" : {
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        },
        "scope" : "SERVER_SCOPE",
        "notifyDevice" : false,
        "sendAttributesUpdatedNotification" : false,
        "updateAttributesOnlyOnValueChange" : true
      },
      "configurationVersion" : 3,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "0ead3af1-ba71-11f0-9cd0-35be421ad23c"
      },
      "name" : "save contadores atributos 1.9",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1251,
        "layoutY" : 308
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "\n\nreturn {msg: msg, metadata: metadata, msgType: 'POST_TELEMETRY_REQUEST'};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "0ead3af2-ba71-11f0-9cd0-35be421ad23c"
      },
      "name" : "convert telemetry 1.9",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1464,
        "layoutY" : 311
      },
      "configuration" : {
        "defaultTTL" : 0,
        "useServerTs" : false,
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        }
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "0ead3af3-ba71-11f0-9cd0-35be421ad23c"
      },
      "name" : "save contadores telemetry 1.9",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 487,
        "layoutY" : 189
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "function nextRelation(metadata, msg) {\n    return ['one','nine'];\n}\nif(msgType === 'POST_TELEMETRY_REQUEST') {\n    return ['two'];\n}\nreturn nextRelation(metadata, msg);",
        "tbelScript" : "function nextRelation(metadata, msg) {\n    if(metadata.deviceName != \"Estación 1.9\") {\n        return ['1.0 - 1.8'];\n    }\n    else {\n        return ['1.9'];\n    }\n}\n\nreturn nextRelation(metadata, msg);"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "400e9390-ba81-11f0-9cd0-35be421ad23c"
      },
      "name" : "FILTRO",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsSwitchNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 736,
        "layoutY" : 296
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var msgout={};\nif(metadata.deviceName == \"Estación 1.0\"){\n    msgout=msg;\n}\n\nreturn {msg: msgout, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7c832fe0-ba8e-11f0-9cd0-35be421ad23c"
      },
      "name" : "filtrar estacion 1.0",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1008,
        "layoutY" : 298
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var msgout={};\nif(msg.evento==\"INICIO_ESTACION\"){\n    \n    msgout.unidades_planificadas=msg.unidades_planificadas;\n    \n\n    \n\n    \n}\nreturn {msg: msgout, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "11be4fe0-ba8f-11f0-9cd0-35be421ad23c"
      },
      "name" : "filtrar INICIO_ESTACION EBENTO",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1265,
        "layoutY" : 389
      },
      "configuration" : {
        "defaultTTL" : 0,
        "useServerTs" : false,
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        }
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "a46afcd0-ba8f-11f0-9cd0-35be421ad23c"
      },
      "name" : "unidades_planificadas",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 503,
        "layoutY" : 280
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var msgout = [];\r\n\r\nif (msg.evento === \"FIN_ESTACION\") {\r\n    if (Array.isArray(msg.nombre_operario)) {\r\n        for (var i = 0; i < msg.nombre_operario.length; i++) {\r\n            msgout.push({\r\n                p_operario: msg.p_operario,  // número decimal o entero\r\n                nombre_operario: msg.nombre_operario[i]\r\n            });\r\n        }\r\n    }\r\n    // evolvemos el array directamente\r\n    return { msg: msgout, metadata: metadata, msgType: msgType };\r\n}\r\n\r\nelse {\r\n    // Si no es FIN_ESTACION, devolvemos un array vacío\r\n   \r\n    return { msg: msgout, metadata: metadata, msgType: msgType };\r\n}\r\n\r\n\r\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "50904890-bc1a-11f0-9cd0-35be421ad23c"
      },
      "name" : "Eficiencia operariog",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 964,
        "layoutY" : 370
      },
      "configuration" : {
        "direction" : "FROM",
        "entityType" : "DEVICE",
        "entityNamePattern" : "$[nombre_operario]",
        "entityTypePattern" : null,
        "relationType" : "Contains",
        "createEntityIfNotExists" : false,
        "removeCurrentRelations" : false,
        "changeOriginatorToRelatedEntity" : false
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "549f85e0-bc33-11f0-9cd0-35be421ad23c"
      },
      "name" : "adggh",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbCreateRelationNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 465,
        "layoutY" : 441
      },
      "configuration" : {
        "latestTsKeyNames" : [ "$[nombre_variable]" ],
        "aggregation" : "NONE",
        "fetchMode" : "ALL",
        "orderBy" : "ASC",
        "limit" : 1000,
        "useMetadataIntervalPatterns" : false,
        "startIntervalPattern" : "",
        "endIntervalPattern" : "",
        "startInterval" : 1,
        "startIntervalTimeUnit" : "DAYS",
        "endInterval" : 1,
        "endIntervalTimeUnit" : "MILLISECONDS"
      },
      "configurationVersion" : 2,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1762984499367,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "4a9ee980-be8d-11f0-9cd0-35be421ad23c"
      },
      "name" : "vsx",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 34,
        "layoutY" : 256
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return msg.temperature > 20;",
        "tbelScript" : "return msg.evento==\"FIN_ESTACION\";\n\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "1766f570-bfd8-11f0-9cd0-35be421ad23c"
      },
      "name" : "FIN_ESTACION",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 268,
        "layoutY" : 260
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var msgout={};\n//msgout.evento=msg.evento;\nmsgout.device=metadata.deviceName;\nmsgout.TIMESTAMP=msg.TIMESTAMP;\nmsgout.serie=msg.serie;\nmsgout.tiempo_serie=msg.tiempo_serie;\n\nreturn {msg: msgout, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b6360f50-bfd9-11f0-9cd0-35be421ad23c"
      },
      "name" : "FIN_ESTACION",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 33,
        "layoutY" : 356
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var serie = msg.serie;\n//var dispositivo = msg.device;\n//var key = \"serie_\" + serie + \"_dispositivo_\" + dispositivo;\nvar key = \"serie_\" + serie;\nvar value = msg.tiempo_serie;\n\nvar msgout = {};\nmsgout[key] = value;\nmsgout[\"serie\"]=serie;\nmsgout.nombre_variable =  key;\n\n\n\nreturn {msg: msgout, metadata: metadata, msgType: msgType};\n\n\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1762988596008,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "339c6640-bfe1-11f0-9cd0-35be421ad23c"
      },
      "name" : "sese",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 947,
        "layoutY" : 756
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var msgout = {};\r\nvar serie = msg.serie;\r\n\r\n// Leer los tiempos directamente del mensaje\r\nvar ts1 = parseFloat(msg[\"serie_\" + serie + \"_dispositivo_Estación 1.1\"]) || 0;\r\nvar ts2 = parseFloat(msg[\"serie_\" + serie + \"_dispositivo_Estación 1.9\"]) || 0;\r\n\r\n// Sumar tiempos\r\nvar tiempo_total_serie = ts1 + ts2;\r\n\r\n// Verificar si ambos datos están disponibles\r\nif (ts1 && ts2) {\r\n    msgout.serie = serie;\r\n    msgout.tiempo_total_serie = tiempo_total_serie;\r\n    msgout.estado = \"completo\";\r\n} else {\r\n    msgout.estado = \"incompleto\";\r\n    msgout.tiempo_total_serie = tiempo_total_serie;\r\n    msgout.serie = serie;\r\n}\r\n\r\n// Devolver el nuevo mensaje\r\nreturn { msg: msgout, metadata: metadata, msgType: msgType };\r\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1762980768601,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "3c0880f0-bfed-11f0-9cd0-35be421ad23c"
      },
      "name" : "cvnmp",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1343,
        "layoutY" : 728
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: 'POST_TELEMETRY_REQUEST'};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "946388e0-bff1-11f0-9cd0-35be421ad23c"
      },
      "name" : "mlejej",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1343,
        "layoutY" : 634
      },
      "configuration" : {
        "originatorSource" : "ENTITY",
        "entityType" : "DEVICE",
        "entityNamePattern" : "line1",
        "relationsQuery" : {
          "direction" : "FROM",
          "maxLevel" : 1,
          "filters" : [ {
            "relationType" : "Contains",
            "entityTypes" : [ ],
            "negate" : false
          } ],
          "fetchLastLevelOnly" : false
        }
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "bc731e90-bff1-11f0-9cd0-35be421ad23c"
      },
      "name" : "para Linea11",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbChangeOriginatorNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1364,
        "layoutY" : 545
      },
      "configuration" : {
        "defaultTTL" : 0,
        "useServerTs" : false,
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        }
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "bc731e91-bff1-11f0-9cd0-35be421ad23c"
      },
      "name" : "save linea 11",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1351,
        "layoutY" : 820
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return msg.temperature > 20;",
        "tbelScript" : "return msg.estado == \"completo\";\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1762982530267,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "fd93c9b0-bff1-11f0-9cd0-35be421ad23c"
      },
      "name" : "estatus",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 0,
        "layoutY" : 467
      },
      "configuration" : {
        "defaultTTL" : 0,
        "useServerTs" : false,
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        }
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1762976352276,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "a712b410-bffc-11f0-9cd0-35be421ad23c"
      },
      "name" : "mnbbh",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 724,
        "layoutY" : 877
      },
      "configuration" : {
        "latestTsKeyNames" : [ "$[nombre_variable]" ],
        "aggregation" : "NONE",
        "fetchMode" : "ALL",
        "orderBy" : "ASC",
        "limit" : 1000,
        "useMetadataIntervalPatterns" : false,
        "startIntervalPattern" : "",
        "endIntervalPattern" : "",
        "startInterval" : 1,
        "startIntervalTimeUnit" : "DAYS",
        "endInterval" : 1,
        "endIntervalTimeUnit" : "MILLISECONDS"
      },
      "configurationVersion" : 2,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1762983289319,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "521c7570-c00d-11f0-9cd0-35be421ad23c"
      },
      "name" : "vsx",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 456,
        "layoutY" : 881
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var serie = msg.serie;\nvar dispositivo = msg.device;\nvar key = \"serie_\" + serie + \"_dispositivo_\" + dispositivo;\nvar value = msg.tiempo_serie;\n\nvar msgout = {};\nmsgout[key] = value;\nmsgout[\"serie\"]=serie;\nmsgout.nombre_variable =  key;\n\n\n\nreturn {msg: msgout, metadata: metadata, msgType: msgType};\n\n\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1762983544776,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ea601a80-c00d-11f0-9cd0-35be421ad23c"
      },
      "name" : "sese",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 283,
        "layoutY" : 364
      },
      "configuration" : {
        "originatorSource" : "ENTITY",
        "entityType" : "DEVICE",
        "entityNamePattern" : "Estación 1.9",
        "relationsQuery" : {
          "direction" : "FROM",
          "maxLevel" : 1,
          "filters" : [ {
            "relationType" : "Contains",
            "entityTypes" : [ ],
            "negate" : false
          } ],
          "fetchLastLevelOnly" : false
        }
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1762988576725,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b338ec60-c00f-11f0-9cd0-35be421ad23c"
      },
      "name" : "para estacion 9",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbChangeOriginatorNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 230,
        "layoutY" : 474
      },
      "configuration" : {
        "defaultTTL" : 0,
        "useServerTs" : false,
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        }
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "d1b0c230-c00f-11f0-9cd0-35be421ad23c"
      },
      "name" : "save estacion 1.9",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 730,
        "layoutY" : 449
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return msg.temperature > 20;",
        "tbelScript" : "return metadata.deviceName==\"Estación 1.9\";\n\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1762988544439,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "9e145df0-c010-11f0-9cd0-35be421ad23c"
      },
      "name" : "metadata.device",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 406,
        "layoutY" : 585
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var msgout={};\n\nvar clave = msg.nombre_variable; // \"serie_abcd_dispositivo_Estación 1.7\"\nvar total = 0;\n\n\n\nif (metadata[clave]) {\n    try {\n        var historial = JSON.parse(metadata[clave]);\n        historial.forEach(function(item) {\n            total += parseFloat(item.value) || 0;\n        });\n    } catch(e) {\n        // Si no es JSON válido, intentar sumar directamente\n        total += parseFloat(metadata[clave]) || 0;\n    }\n}\n\n\n\n/*\nif (msg[clave]) {\n    total += parseFloat(msg[clave]) || 0;\n}\n*/\n\n//  Guardar resultado\nmsgout.tiempo_serie_total = total;\nmsgout.estado = \"sumado\";\nmsgout.serie_tiempo=msg.serie;\n\n\nreturn {msg: msgout, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1762988846621,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "5ab00ef0-c011-11f0-9cd0-35be421ad23c"
      },
      "name" : "aeae",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 721,
        "layoutY" : 595
      },
      "configuration" : {
        "defaultTTL" : 0,
        "useServerTs" : false,
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        }
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "2cd88510-c01c-11f0-9cd0-35be421ad23c"
      },
      "name" : "serie_tiempo",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    } ],
    "ruleChainConnections" : null
  },
  "relations" : [ {
    "additionalInfo" : null,
    "from" : {
      "entityType" : "RULE_CHAIN",
      "id" : "67a610a0-8f1f-11f0-a61c-01e0c85fd5dd"
    },
    "to" : {
      "entityType" : "RULE_CHAIN",
      "id" : "9e8cb6b0-a53f-11f0-9abe-2dfd6db9cae3"
    },
    "type" : "Uses",
    "typeGroup" : "COMMON",
    "version" : 141223
  } ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}