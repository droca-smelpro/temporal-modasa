{
  "entityType" : "RULE_CHAIN",
  "entity" : {
    "additionalInfo" : {
      "description" : ""
    },
    "configuration" : null,
    "debugMode" : false,
    "externalId" : null,
    "firstRuleNodeId" : {
      "entityType" : "RULE_NODE",
      "id" : "67654bc0-b43a-11f0-9cd0-35be421ad23c"
    },
    "id" : {
      "entityType" : "RULE_CHAIN",
      "id" : "9e8cb6b0-a53f-11f0-9abe-2dfd6db9cae3"
    },
    "name" : "Process",
    "root" : false,
    "type" : "CORE"
  },
  "metaData" : {
    "connections" : [ {
      "fromIndex" : 1,
      "toIndex" : 5,
      "type" : "Success"
    }, {
      "fromIndex" : 2,
      "toIndex" : 1,
      "type" : "Failure"
    }, {
      "fromIndex" : 2,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 4,
      "toIndex" : 3,
      "type" : "Success"
    }, {
      "fromIndex" : 6,
      "toIndex" : 0,
      "type" : "Success"
    }, {
      "fromIndex" : 6,
      "toIndex" : 9,
      "type" : "Success"
    }, {
      "fromIndex" : 6,
      "toIndex" : 10,
      "type" : "Success"
    }, {
      "fromIndex" : 6,
      "toIndex" : 14,
      "type" : "Success"
    }, {
      "fromIndex" : 6,
      "toIndex" : 19,
      "type" : "Success"
    }, {
      "fromIndex" : 6,
      "toIndex" : 21,
      "type" : "Success"
    }, {
      "fromIndex" : 7,
      "toIndex" : 8,
      "type" : "Success"
    }, {
      "fromIndex" : 9,
      "toIndex" : 7,
      "type" : "Success"
    }, {
      "fromIndex" : 10,
      "toIndex" : 11,
      "type" : "Success"
    }, {
      "fromIndex" : 12,
      "toIndex" : 22,
      "type" : "Success"
    }, {
      "fromIndex" : 12,
      "toIndex" : 25,
      "type" : "Success"
    }, {
      "fromIndex" : 13,
      "toIndex" : 23,
      "type" : "Success"
    }, {
      "fromIndex" : 14,
      "toIndex" : 17,
      "type" : "True"
    }, {
      "fromIndex" : 14,
      "toIndex" : 18,
      "type" : "True"
    }, {
      "fromIndex" : 15,
      "toIndex" : 16,
      "type" : "fin_estacion"
    }, {
      "fromIndex" : 19,
      "toIndex" : 12,
      "type" : "1.0"
    }, {
      "fromIndex" : 21,
      "toIndex" : 20,
      "type" : "1.9"
    }, {
      "fromIndex" : 22,
      "toIndex" : 13,
      "type" : "True"
    }, {
      "fromIndex" : 23,
      "toIndex" : 24,
      "type" : "Success"
    }, {
      "fromIndex" : 25,
      "toIndex" : 26,
      "type" : "True"
    }, {
      "fromIndex" : 26,
      "toIndex" : 23,
      "type" : "Success"
    } ],
    "firstNodeIndex" : 6,
    "nodes" : [ {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 845,
        "layoutY" : 253
      },
      "configuration" : {
        "version" : 0
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764532065589,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "fd846e50-a540-11f0-9abe-2dfd6db9cae3"
      },
      "name" : "save",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.flow.TbRuleChainOutputNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 382,
        "layoutY" : 1070
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "if(msg.evento === \"FIN_OPERACION\"){\n    var unidades_ensambladas_anterior = parseInt(metadata.unidades_ensambladas) || 0;\n    msg.unidades_ensambladas = unidades_ensambladas_anterior + 1;\n    \n    var tiempo_inicio = metadata.shared_tiempo_inicio;\n    var tiempo_final = metadata.shared_tiempo_final;\n    msg.tiempo_operacion = tiempo_final - tiempo_inicio;\n}\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1760044271632,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "fd846e51-a540-11f0-9abe-2dfd6db9cae3"
      },
      "name" : "Unidades Ensambladas",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 37,
        "layoutY" : 1068
      },
      "configuration" : {
        "tellFailureIfAbsent" : true,
        "fetchTo" : "METADATA",
        "clientAttributeNames" : [ ],
        "sharedAttributeNames" : [ "tiempo_inicio", "tiempo_fin" ],
        "serverAttributeNames" : [ ],
        "latestTsKeyNames" : [ "unidades_ensambladas" ],
        "getLatestValueWithTs" : false
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1760044271632,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "67a0e3e0-a541-11f0-9abe-2dfd6db9cae3"
      },
      "name" : "Fetch Unidades ensambladas",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 329,
        "layoutY" : 1120
      },
      "configuration" : {
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        },
        "scope" : "SHARED_SCOPE",
        "notifyDevice" : false,
        "sendAttributesUpdatedNotification" : false,
        "updateAttributesOnlyOnValueChange" : false
      },
      "configurationVersion" : 3,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "3367caa0-a567-11f0-9abe-2dfd6db9cae3"
      },
      "name" : "Save Attributes",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 50,
        "layoutY" : 1127
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var newMsg = {};\n\nif(msg.evento === \"IDENTIFICACION\"){\n    newMsg.tiempo_inicio = metadata.ts;\n}\nif(msg.evento === \"IDENTIFICACION\"){\n    newMsg.tiempo_fin = metadata.ts;\n}\n\nreturn {msg: newMsg, metadata: metadata, msgType: 'POST_ATTRIBUTES_REQUEST'};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "3367f1b0-a567-11f0-9abe-2dfd6db9cae3"
      },
      "name" : "Prepare Attributes",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 681,
        "layoutY" : 1071
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "// List of keys to convert\nvar keysToConvert = ['tiempo_total', 'tiempo_parada', 'tiempo_espera']; \n\nkeysToConvert.forEach(function(key) {\n    if (msg[key]) {\n        var timeStr = msg[key];\n        var parts = timeStr.split(\":\");\n\n        // Ensure valid 4-part format (D:H:M:S)\n        if (parts.length === 4) {\n            var days = parseInt(parts[0], 10);\n            var hours = parseInt(parts[1], 10);\n            var minutes = parseInt(parts[2], 10);\n            var seconds = parseInt(parts[3], 10);\n\n            var totalSeconds = (((days * 24 + hours) * 60 + minutes) * 60) + seconds;\n\n            msg[key] = totalSeconds;\n        } else {\n            // optional: log invalid format\n            // logger.warn(\"Invalid time format for key \" + key + \": \" + timeStr);\n        }\n    }\n});\n\nreturn { msg: msg, metadata: metadata, msgType: msgType };\n\n\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "0359ab50-a56a-11f0-9abe-2dfd6db9cae3"
      },
      "name" : "HH:MM:SS to seconds",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 263,
        "layoutY" : 154
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "\n\n if(msg.nombre_operario)  {\nmsg.string_nombre_operario = msg.nombre_operario.join(\", \"); //variable para nombre_operario\n\n}\n//********************************************************************************************************\n\nif (msg.evento==\"FIN_ESTACION\"){\n    \n    \n  if(msg.unidad_terminada==\"Y\" || msg.unidad_terminada == true){\n\n    \n    msg.unidades_ensambladas=1;\n    \n\n    \n      if(msg.contador_levantamiento ==0){\n     \n          msg.unidades_ALAprimera=1;\n          msg.unidades_retrabajadas=0;\n          \n       }\n      else{\n          \n          msg.unidades_retrabajadas=1;\n          msg.unidades_ALAprimera=0;\n          \n      \n        }\n    }\n  else{\n     msg.unidades_ensambladas=0;\n    }\n      \n\n  \n\n\n  //msg.disponibilidad=((tiempoSegundos(msg.tiempo_activo))/(tiempoSegundos(msg.tiempo_estandar))); //usadado para estacion 1.9\n  \n  //msg.cantidad_teorica=msg.produccion_teorica;\n  \n\n  /*\n  \n  msg.tiempo_total=tiempoSegundos(msg.tiempo_total);\n  msg.tiempo_activo=tiempoSegundos(msg.tiempo_activo);\n  msg.p_efectivo=((msg.tiempo_activo)*100)/(msg.tiempo_total);\n  \n  msg.tiempo_estandar=tiempoSegundos(msg.tiempo_estandar);\n  msg.p_operario=(msg.tiempo_estandar)/(msg.tiempo_total); //eficiencia operario\n  */\n  \n  \n  msg.tiempo_total =tiempoMinutos(msg.tiempo_total);\n  msg.tiempo_activo=tiempoMinutos(msg.tiempo_activo);\n  msg.p_efectivo=(((msg.tiempo_activo)*100)/(msg.tiempo_total)).toFixed(2);  /// 0 -100\n  \n  msg.tiempo_estandar=tiempoMinutos(msg.tiempo_estandar);\n\n  \n  \n  \n  \n      }\n\n//**********************************************************************************************************\nelse if(msg.evento==\"FIN_OPERACION\"){\n    \n    \n    //msg.tiempo_estado=tiempoSegundos(msg.tiempo_estado);\n    \n\n    \n}\n//**********************************************************************************************************\nelse if(msg.evento==\"FIN_PARADA\"){\n    \n\nmsg.time_parada=(tiempoMinutos(msg.tiempo_estado)).toFixed(2);\n\n\nmsg.paradas={\"causa1\": msg.CAUSA_1, \"causa2\": msg.CAUSA_2, \"causa3\": msg.CAUSA_3, \"causa4\": msg.CAUSA_4, \"causa5\": msg.CAUSA_5 , \"tiempo_parada\": msg.time_parada};\n    \n\n    \n}\n\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};\n\n// funciones $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$\n \n\n \n//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$\nfunction tiempoSegundos(timeArray) {\n    // Si no existe, devolver 0\n    if (timeArray === undefined || timeArray === null) {\n        return 0;\n    }\n\n    // Si no es string, intentar convertirlo a string\n    if (typeof timeArray !== \"string\") {\n        timeArray = String(timeArray);\n    }\n\n    // Verificar que contenga \":\"\n    if (timeArray.indexOf(\":\") === -1) {\n        return 0;\n    }\n\n    // Separar en partes\n    var partes = timeArray.split(\":\").map(function(x) { return parseInt(x, 10) || 0; });\n\n    // dd:hh:mm:ss\n    if (partes.length === 4) {\n        return (partes[0] * 24 * 3600) + (partes[1] * 3600) + (partes[2] * 60) + partes[3];\n        //return (partes[0] * 24 * 60) + (partes[1] * 60) + (partes[2]) + ((partes[3])/60);\n    }\n\n    // hh:mm:ss\n    if (partes.length === 3) {\n        return (partes[0] * 3600) + (partes[1] * 60) + partes[2];\n        //return (partes[0] * 60) + (partes[1]) + ((partes[2])/60);\n    }\n\n    // Cualquier otro formato\n    return 0;\n}\n\n//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$\nfunction tiempoMinutos(timeArray) {\n    // Si no existe, devolver 0\n    if (timeArray === undefined || timeArray === null) {\n        return 0;\n    }\n\n    // Si no es string, intentar convertirlo a string\n    if (typeof timeArray !== \"string\") {\n        timeArray = String(timeArray);\n    }\n\n    // Verificar que contenga \":\"\n    if (timeArray.indexOf(\":\") === -1) {\n        return 0;\n    }\n\n    // Separar en partes\n    var partes = timeArray.split(\":\").map(function(x) { return parseInt(x, 10) || 0; });\n\n    // dd:hh:mm:ss\n    if (partes.length === 4) {\n       // return (partes[0] * 24 * 3600) + (partes[1] * 3600) + (partes[2] * 60) + partes[3];\n        return (partes[0] * 24 * 60) + (partes[1] * 60) + (partes[2]) + ((partes[3])/60);\n    }\n\n    // hh:mm:ss\n    if (partes.length === 3) {\n        //return (partes[0] * 3600) + (partes[1] * 60) + partes[2];\n        return (partes[0] * 60) + (partes[1]) + ((partes[2])/60);\n    }\n\n    // Cualquier otro formato\n    return 0;\n}\n\n\n\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764960647526,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "67654bc0-b43a-11f0-9cd0-35be421ad23c"
      },
      "name" : "evento",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1028,
        "layoutY" : 119
      },
      "configuration" : {
        "originatorSource" : "ENTITY",
        "entityType" : "DEVICE",
        "entityNamePattern" : "Linea 1",
        "relationsQuery" : {
          "direction" : "FROM",
          "maxLevel" : 1,
          "filters" : [ {
            "relationType" : "Contains",
            "entityTypes" : [ ],
            "negate" : false
          } ],
          "fetchLastLevelOnly" : false
        }
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764622991285,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "4e419250-b914-11f0-9cd0-35be421ad23c"
      },
      "name" : "para Linea1",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbChangeOriginatorNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1322,
        "layoutY" : 115
      },
      "configuration" : {
        "defaultTTL" : 0,
        "useServerTs" : false,
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        }
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "4e419251-b914-11f0-9cd0-35be421ad23c"
      },
      "name" : "save linea 1",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 781,
        "layoutY" : 136
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var msgout={};\n//------------------------------------------------------------\n if(msg.nombre_operario)  {\nmsg.string_nombre_operario = msg.nombre_operario.join(\", \"); //variable para nombre_operario\n\n}\n//********************************************************************************************************\n\nif (msg.evento==\"FIN_ESTACION\"){\n    \n    \n  if(msg.unidad_terminada==\"Y\" || msg.unidad_terminada== true){\n\n    \n    \n      if(msg.contador_levantamiento ==0){\n          \n          if(metadata.deviceName == \"Estación 1.9\"){\n              msgout.unidades_ALAprimeraL=1;\n              msgout.unidades_retrabajadasL=0;\n              \n          }\n          else{\n              \n          }\n     \n          \n          \n       }\n      else{\n          \n        if(metadata.deviceName == \"Estación 1.9\"){\n              msgout.unidades_ALAprimeraL=0;\n              msgout.unidades_retrabajadasL=1;\n              \n          }\n          else{\n              \n          }\n          \n          \n      \n        }\n        \n     if(msg.contador_inspeccion ==1){\n     \n          msgout.unidades_buenas=1;\n          \n       }\n      else if(msg.contador_inspeccion >=1){\n          \n          msgout.unidades_defecto=1;\n          \n      \n        }\n        \n        \n    switch (metadata.deviceName) {\n     case \"Estación 1.0\":\n        msgout.UE_10=1;   //unidades ensambladas en estacion 1.0\n        break;\n     case \"Estación 1.1\":\n        msgout.UE_11=1;   //unidades ensambladas en estacion 1.1\n        break;\n     case \"Estación 1.2\":\n        msgout.UE_12=1;   //unidades ensambladas en estacion 1.2\n        break;\n     case \"Estación 1.3\":\n        msgout.UE_13=1;   //unidades ensambladas en estacion 1.3\n        break;\n     case \"Estación 1.4\":\n        msgout.UE_14=1;   //unidades ensambladas en estacion 1.4\n        break;\n     case \"Estación 1.5\":\n        msgout.UE_15=1;    //unidades ensambladas en estacion 1.5\n        break;\n     case \"Estación 1.6\":\n        msgout.UE_16=1;    //unidades ensambladas en estacion 1.6\n        break;\n     case \"Estación 1.7\":\n        msgout.UE_17=1;   //unidades ensambladas en estacion 1.7\n        break;\n     case \"Estación 1.8\":\n        msgout.UE_18=1;   //unidades ensambladas en estacion 1.8\n        break;\n     case \"Estación 1.9\":\n        msgout.UE_19=1;    //unidades ensambladas en estacion 1.9\n        msgout.unidades_ensambladasL=1;\n        break;\n        \n     default:\n        msgout.alerta= \"no es dispositivo\";\n        break;\n   }\n  \n    }\n  else{\n\n    }\n  \n  msgout.tiempo_activoL=(msg.tiempo_activo).toFixed(2);\n  msgout.tiempo_estandarL=msg.tiempo_estandar.toFixed(2);\n  \n  \n      }\n\n//**********************************************************************************************************\nelse if(msg.evento==\"FIN_OPERACION\"){\n    \n    \n    //msg.tiempo_estado=tiempoSegundos(msg.tiempo_estado);\n    \n\n    \n}\n//**********************************************************************************************************\nelse if(msg.evento==\"FIN_PARADA\"){\n    \n        switch (metadata.deviceName) {\n     case \"Estación 1.0\":\n        msgout.PARADAS_10=1;  // cantidad de parada en estacion 1.0\n        break;\n     case \"Estación 1.1\":\n        msgout.PARADAS_11=1;  // cantidad de parada en estacion 1.1\n        break;\n     case \"Estación 1.2\":\n        msgout.PARADAS_12=1;  // cantidad de parada en estacion 1.2\n        break;\n     case \"Estación 1.3\":\n        msgout.PARADAS_13=1;   // cantidad de parada en estacion 1.3\n        break;\n     case \"Estación 1.4\":\n        msgout.PARADAS_14=1;  // cantidad de parada en estacion 1.4\n        break;\n     case \"Estación 1.5\":\n        msgout.PARADAS_15=1;  // cantidad de parada en estacion 1.5\n        break;\n     case \"Estación 1.6\":\n        msgout.PARADAS_16=1;  // cantidad de parada en estacion 1.6\n        break;\n     case \"Estación 1.7\":\n        msgout.PARADAS_17=1;  // cantidad de parada en estacion 1.7\n        break;\n     case \"Estación 1.8\":\n        msgout.PARADAS_18=1;   // cantidad de parada en estacion 1.8\n        break;\n     case \"Estación 1.9\":\n        msgout.PARADAS_19=1;   // cantidad de parada en estacion 1.9\n        break;\n        \n     default:\n        msgout.alerta= \"DISPOSITIVO NO REGISTRADO\";\n        break;\n   }\n   \n   //---------------------------------------------------------------------------------\n   \n   msgout.paradas=msg.paradas; // objeto con las causas y tiempo de paradas\n   \n   msgout.tiempo_linea_parada=tiempoMinutos(msg.tiempo_estado);\n\n    \n}\n\n\nreturn {msg: msgout, metadata: metadata, msgType: msgType};\n\n// funciones $$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$\n\n \n//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$\nfunction tiempoSegundos(timeArray) {\n    // Si no existe, devolver 0\n    if (timeArray === undefined || timeArray === null) {\n        return 0;\n    }\n\n    // Si no es string, intentar convertirlo a string\n    if (typeof timeArray !== \"string\") {\n        timeArray = String(timeArray);\n    }\n\n    // Verificar que contenga \":\"\n    if (timeArray.indexOf(\":\") === -1) {\n        return 0;\n    }\n\n    // Separar en partes\n    var partes = timeArray.split(\":\").map(function(x) { return parseInt(x, 10) || 0; });\n\n    // dd:hh:mm:ss\n    if (partes.length === 4) {\n        return (partes[0] * 24 * 3600) + (partes[1] * 3600) + (partes[2] * 60) + partes[3];\n    }\n\n    // hh:mm:ss\n    if (partes.length === 3) {\n        return (partes[0] * 3600) + (partes[1] * 60) + partes[2];\n    }\n\n    // Cualquier otro formato\n    return 0;\n}\n\n//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$\nfunction tiempoMinutos(timeArray) {\n    // Si no existe, devolver 0\n    if (timeArray === undefined || timeArray === null) {\n        return 0;\n    }\n\n    // Si no es string, intentar convertirlo a string\n    if (typeof timeArray !== \"string\") {\n        timeArray = String(timeArray);\n    }\n\n    // Verificar que contenga \":\"\n    if (timeArray.indexOf(\":\") === -1) {\n        return 0;\n    }\n\n    // Separar en partes\n    var partes = timeArray.split(\":\").map(function(x) { return parseInt(x, 10) || 0; });\n\n    // dd:hh:mm:ss\n    if (partes.length === 4) {\n       // return (partes[0] * 24 * 3600) + (partes[1] * 3600) + (partes[2] * 60) + partes[3];\n        return (partes[0] * 24 * 60) + (partes[1] * 60) + (partes[2]) + ((partes[3])/60);\n    }\n\n    // hh:mm:ss\n    if (partes.length === 3) {\n        //return (partes[0] * 3600) + (partes[1] * 60) + partes[2];\n        return (partes[0] * 60) + (partes[1]) + ((partes[2])/60);\n    }\n\n    // Cualquier otro formato\n    return 0;\n}",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764960653357,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "49656c00-b993-11f0-9cd0-35be421ad23c"
      },
      "name" : "linea1 procesar",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 705,
        "layoutY" : 22
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var msgout={};\n\n switch (msg.evento) {\n     case \"INICIO_INACTIVIDAD\":\n        msgout.westado=\"EN INACTIVIDAD\";\n        break;\n     case \"INICIO_OPERACION\":\n        msgout.westado=\"EN OPERACIÓN\";\n        break;\n     case \"INICIO_PARADA\":\n        msgout.westado=\"EN PARADA\";\n        break;\n     case \"INICIO_INSPECCION\":\n        msgout.westado=\"EN INSPECCIÓN\";\n        break;\n     case \"INICIO_LEVANTAMIENTO\":\n        msgout.westado=\"EN LEVANTAMIENTO\";\n        break;\n\n     default:\n       // msgout.westado= msg.estado;\n        break;\n   }\n\nreturn {msg: msgout, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764625048165,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "47d41200-ba61-11f0-9cd0-35be421ad23c"
      },
      "name" : "estado widget",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1061,
        "layoutY" : 15
      },
      "configuration" : {
        "defaultTTL" : 0,
        "useServerTs" : false,
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        }
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "5d70c130-ba61-11f0-9cd0-35be421ad23c"
      },
      "name" : "save westado",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 576,
        "layoutY" : 524
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var msgout={};\nif(metadata.deviceName == \"Estación 1.0\"){\n    msgout=msg;\n}\n\nreturn {msg: msgout, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764532779688,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7c832fe0-ba8e-11f0-9cd0-35be421ad23c"
      },
      "name" : "filtrar estacion 1.0",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1087,
        "layoutY" : 521
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var msgout={};\n\n    msgout.unidades_planificadasL=msg.unidades_planificadas;\n    \nreturn {msg: msgout, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764860358797,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "11be4fe0-ba8f-11f0-9cd0-35be421ad23c"
      },
      "name" : "unidades_planificadas",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 83,
        "layoutY" : 639
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return msg.temperature > 20;",
        "tbelScript" : "return msg.evento==\"FIN_ESTACION\";\n\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764699418933,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "1766f570-bfd8-11f0-9cd0-35be421ad23c"
      },
      "name" : "FIN_ESTACION ?",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 63,
        "layoutY" : 19
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "function nextRelation(metadata, msg) {\n    return ['one','nine'];\n}\nif(msgType === 'POST_TELEMETRY_REQUEST') {\n    return ['two'];\n}\nreturn nextRelation(metadata, msg);",
        "tbelScript" : "function nextRelation(metadata, msg) {\n    if(msg.evento == \"FIN_ESTACION\") {\n        return ['fin_estacion'];\n    }\n    else {\n        return ['no'];\n    }\n}\n\nreturn nextRelation(metadata, msg);"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1763671018614,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "5cfdefe0-c64e-11f0-9cd0-35be421ad23c"
      },
      "name" : "FILTRO fin estacion",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsSwitchNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 341,
        "layoutY" : 17
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764101588671,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "859ea200-c64e-11f0-9cd0-35be421ad23c"
      },
      "name" : "degug_fin_estacion",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 367,
        "layoutY" : 606
      },
      "configuration" : {
        "version" : 0
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "80ac6730-ce16-11f0-b9be-a7eb49293647"
      },
      "name" : "Calcular eficiencia operario",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.flow.TbRuleChainOutputNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 363,
        "layoutY" : 693
      },
      "configuration" : {
        "version" : 0
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "100172c0-ce19-11f0-b9be-a7eb49293647"
      },
      "name" : "Calcular tiempo serie",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.flow.TbRuleChainOutputNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 493,
        "layoutY" : 303
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "function nextRelation(metadata, msg) {\n    if(metadata.deviceName == \"Estación 1.9\") {\n        return ['1.9'];\n    }\n    else if(metadata.deviceName == \"Estación 1.0\") {\n        return ['1.0'];\n    }\n    else if(metadata.deviceName == \"simulador1\") {\n        return ['simulador'];\n    }\n    else {\n        return ['1.1 - 1.8'];\n    }\n}\n\nreturn nextRelation(metadata, msg);",
        "tbelScript" : "function nextRelation(metadata, msg) {\n    return ['one','nine'];\n}\nif(msgType == 'POST_TELEMETRY_REQUEST') {\n    return ['two'];\n}\nreturn nextRelation(metadata, msg);"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764626765790,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "ab390e00-ce1a-11f0-b9be-a7eb49293647"
      },
      "name" : "FILTRO Estaciones",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsSwitchNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 60,
        "layoutY" : 353
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "function nextRelation(metadata, msg) {\n    return ['one','nine'];\n}\nif(msgType === 'POST_TELEMETRY_REQUEST') {\n    return ['two'];\n}\nreturn nextRelation(metadata, msg);",
        "tbelScript" : "function nextRelation(metadata, msg) {\n    if(msg.evento == \"FIN_ESTACION\") {\n        return ['fin_estacion'];\n    }\n    else if(msg.evento == \"FIN_PARADA\") {\n        return ['fin_parada'];\n    }\n    else {\n        return ['no'];\n    }\n}\n\nreturn nextRelation(metadata, msg);"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764960660377,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "de8ffb60-cef6-11f0-b9be-a7eb49293647"
      },
      "name" : "debug eventos",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsSwitchNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 177,
        "layoutY" : 256
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "function nextRelation(metadata, msg) {\n    if(metadata.deviceName == \"Estación 1.2\") {\n        return ['1.2'];\n    }\n    else if(metadata.deviceName == \"Estación 1.0\") {\n        return ['1.0'];\n    }\n        else if(metadata.deviceName == \"Estación 1.9\") {\n        return ['1.9'];\n    }\n    else if(metadata.deviceName == \"simulador1\") {\n        return ['simulador'];\n    }\n    else {\n        return ['otros'];\n    }\n}\n\nreturn nextRelation(metadata, msg);",
        "tbelScript" : "function nextRelation(metadata, msg) {\n    return ['one','nine'];\n}\nif(msgType == 'POST_TELEMETRY_REQUEST') {\n    return ['two'];\n}\nreturn nextRelation(metadata, msg);"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "a1cc3f80-cfab-11f0-b9be-a7eb49293647"
      },
      "name" : "debug Estaciones",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsSwitchNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 844,
        "layoutY" : 519
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return msg.temperature > 20;",
        "tbelScript" : "return msg.evento==\"ESCANEO_SERIES\";\n\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "8b5825c0-d0a0-11f0-b9be-a7eb49293647"
      },
      "name" : "ESCANEO_SERIES ?",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1350,
        "layoutY" : 521
      },
      "configuration" : {
        "originatorSource" : "ENTITY",
        "entityType" : "DEVICE",
        "entityNamePattern" : "Linea 1",
        "relationsQuery" : {
          "direction" : "FROM",
          "maxLevel" : 1,
          "filters" : [ {
            "relationType" : "Contains",
            "entityTypes" : [ ],
            "negate" : false
          } ],
          "fetchLastLevelOnly" : false
        }
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "bec4dc90-d0a1-11f0-b9be-a7eb49293647"
      },
      "name" : "para Linea1",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbChangeOriginatorNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1327,
        "layoutY" : 658
      },
      "configuration" : {
        "defaultTTL" : 0,
        "useServerTs" : false,
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        }
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "bec503a0-d0a1-11f0-b9be-a7eb49293647"
      },
      "name" : "save linea 1",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 840,
        "layoutY" : 588
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return msg.temperature > 20;",
        "tbelScript" : "return msg.evento==\"INICIO_ESTACION\";\n\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "c9146650-d1f7-11f0-b9be-a7eb49293647"
      },
      "name" : "INICIO_ESTACION ?",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1087,
        "layoutY" : 580
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var msgout={};\n  \n    msgout.ratio_produccionL=msg.ratio_produccion;\n\nreturn {msg: msgout, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "db748820-d1f7-11f0-b9be-a7eb49293647"
      },
      "name" : "ratio_produccion",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    } ],
    "ruleChainConnections" : null
  },
  "relations" : [ {
    "additionalInfo" : null,
    "from" : {
      "entityType" : "RULE_CHAIN",
      "id" : "67a610a0-8f1f-11f0-a61c-01e0c85fd5dd"
    },
    "to" : {
      "entityType" : "RULE_CHAIN",
      "id" : "9e8cb6b0-a53f-11f0-9abe-2dfd6db9cae3"
    },
    "type" : "Uses",
    "typeGroup" : "COMMON",
    "version" : 269102
  } ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}