{
  "entityType" : "RULE_CHAIN",
  "entity" : {
    "additionalInfo" : {
      "description" : ""
    },
    "configuration" : null,
    "debugMode" : false,
    "externalId" : null,
    "firstRuleNodeId" : {
      "entityType" : "RULE_NODE",
      "id" : "8f91d8c0-d159-11f0-b9be-a7eb49293647"
    },
    "id" : {
      "entityType" : "RULE_CHAIN",
      "id" : "5b40e700-d159-11f0-b9be-a7eb49293647"
    },
    "name" : "Contar Operarios Registrados",
    "root" : false,
    "type" : "CORE"
  },
  "metaData" : {
    "connections" : [ {
      "fromIndex" : 0,
      "toIndex" : 1,
      "type" : "INICIO_IDENTIFICACION"
    }, {
      "fromIndex" : 1,
      "toIndex" : 2,
      "type" : "Success"
    }, {
      "fromIndex" : 2,
      "toIndex" : 3,
      "type" : "Success"
    }, {
      "fromIndex" : 3,
      "toIndex" : 7,
      "type" : "Success"
    }, {
      "fromIndex" : 4,
      "toIndex" : 6,
      "type" : "Success"
    }, {
      "fromIndex" : 5,
      "toIndex" : 4,
      "type" : "Success"
    }, {
      "fromIndex" : 6,
      "toIndex" : 8,
      "type" : "Success"
    }, {
      "fromIndex" : 7,
      "toIndex" : 5,
      "type" : "Success"
    }, {
      "fromIndex" : 8,
      "toIndex" : 9,
      "type" : "False"
    }, {
      "fromIndex" : 9,
      "toIndex" : 10,
      "type" : "Success"
    }, {
      "fromIndex" : 10,
      "toIndex" : 12,
      "type" : "Success"
    }, {
      "fromIndex" : 11,
      "toIndex" : 13,
      "type" : "Success"
    }, {
      "fromIndex" : 12,
      "toIndex" : 11,
      "type" : "Success"
    }, {
      "fromIndex" : 13,
      "toIndex" : 14,
      "type" : "Success"
    }, {
      "fromIndex" : 14,
      "toIndex" : 15,
      "type" : "Success"
    }, {
      "fromIndex" : 15,
      "toIndex" : 16,
      "type" : "False"
    }, {
      "fromIndex" : 16,
      "toIndex" : 17,
      "type" : "Success"
    }, {
      "fromIndex" : 17,
      "toIndex" : 19,
      "type" : "Success"
    }, {
      "fromIndex" : 18,
      "toIndex" : 20,
      "type" : "Success"
    }, {
      "fromIndex" : 19,
      "toIndex" : 18,
      "type" : "Success"
    }, {
      "fromIndex" : 20,
      "toIndex" : 21,
      "type" : "Success"
    }, {
      "fromIndex" : 21,
      "toIndex" : 22,
      "type" : "Success"
    }, {
      "fromIndex" : 22,
      "toIndex" : 23,
      "type" : "False"
    }, {
      "fromIndex" : 23,
      "toIndex" : 24,
      "type" : "Success"
    } ],
    "firstNodeIndex" : 0,
    "nodes" : [ {
      "additionalInfo" : {
        "description" : "Filtro de eventos para Alertas",
        "layoutX" : 330,
        "layoutY" : 149
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "function nextRelation(metadata, msg) {\n    return ['one','nine'];\n}\nif(msgType === 'POST_TELEMETRY_REQUEST') {\n    return ['two'];\n}\nreturn nextRelation(metadata, msg);",
        "tbelScript" : "return msg.evento;"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "8f91d8c0-d159-11f0-b9be-a7eb49293647"
      },
      "name" : "evento",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsSwitchNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 757,
        "layoutY" : 152
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var newMsg = msg.nombre_operario;\nreturn {msg: newMsg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764889160721,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "655f94b0-d15a-11f0-b9be-a7eb49293647"
      },
      "name" : "Filtrar solo nombres de operarios",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1076,
        "layoutY" : 155
      },
      "configuration" : {
        "version" : 0
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764897390791,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "fc593820-d15b-11f0-b9be-a7eb49293647"
      },
      "name" : "Separar operarios",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbSplitArrayMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1414,
        "layoutY" : 155
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "var newMsg = {operarios_registrados: msg};\n\nreturn {msg: newMsg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764897455872,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "fc595f30-d15b-11f0-b9be-a7eb49293647"
      },
      "name" : "Establecer el nombre de la variable",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 697,
        "layoutY" : 305
      },
      "configuration" : {
        "latestTsKeyNames" : [ "operarios_registrados" ],
        "aggregation" : "NONE",
        "fetchMode" : "ALL",
        "orderBy" : "ASC",
        "limit" : 1000,
        "useMetadataIntervalPatterns" : true,
        "startIntervalPattern" : "${inicioDelDia}",
        "endIntervalPattern" : "${finalDelDia}",
        "startInterval" : 2,
        "startIntervalTimeUnit" : "MINUTES",
        "endInterval" : 1,
        "endIntervalTimeUnit" : "MINUTES"
      },
      "configurationVersion" : 2,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764897145491,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "fee6fd00-d15d-11f0-b9be-a7eb49293647"
      },
      "name" : "Jalar a todos los operarios registrados en el día",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 380,
        "layoutY" : 300
      },
      "configuration" : {
        "version" : 0
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764889160721,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "1bad5240-d15e-11f0-b9be-a7eb49293647"
      },
      "name" : "Iniciar Cola Secuencial",
      "queueName" : "SequentialByOriginator",
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.flow.TbCheckpointNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1008,
        "layoutY" : 302
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var operator = msg.operarios_registrados;\r\n\r\n// Parse the metadata JSON array\r\nvar metaList = [];\r\ntry {\r\n    metaList = JSON.parse(metadata.operarios_registrados);\r\n} catch (e) {\r\n    metaList = [];\r\n}\r\n\r\n// Check existence using ES5 function syntax\r\nvar exists = metaList.some(function(entry) {\r\n    return entry.value === operator;\r\n});\r\n\r\n// Store result to metadata or msg\r\nmetadata.operatorExists = exists;\r\n\r\nreturn { msg: msg, metadata: metadata, msgType: msgType };\r\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764896768918,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "3fcee4e0-d15e-11f0-b9be-a7eb49293647"
      },
      "name" : "Verificar que no se repita",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 44,
        "layoutY" : 299
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "// Current date/time as a Date object\r\nvar now = new Date();\r\n\r\n// GMT-5 offset in milliseconds (subtract 5 hours)\r\nvar offset = 5 * 60 * 60 * 1000;\r\n\r\n// Apply offset, but keep it as a Date object\r\nvar nowShifted = new Date(now.getTime() - offset);\r\n\r\n// Start of the day in shifted timezone\r\nvar startOfDay = new Date(\r\n    nowShifted.getFullYear(),\r\n    nowShifted.getMonth(),\r\n    nowShifted.getDate(),\r\n    0, 0, 0, 0\r\n).getTime() + offset;\r\n\r\n// End of the day in shifted timezone\r\nvar endOfDay = new Date(\r\n    nowShifted.getFullYear(),\r\n    nowShifted.getMonth(),\r\n    nowShifted.getDate(),\r\n    23, 59, 59, 999\r\n).getTime() + offset;\r\n\r\nmetadata.inicioDelDia = startOfDay;\r\nmetadata.finalDelDia = endOfDay;\r\n\r\nreturn { msg: msg, metadata: metadata, msgType: msgType };\r\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764897455872,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "b1649530-d160-11f0-b9be-a7eb49293647"
      },
      "name" : "Generar Timestamp del Inicio y Final del Dia",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1319,
        "layoutY" : 297
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return msg.temperature > 20;",
        "tbelScript" : "return metadata.operatorExists == \"true\";"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764896768918,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "bf2cc940-d169-11f0-b9be-a7eb49293647"
      },
      "name" : "Ya está regsitrado?",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1635,
        "layoutY" : 299
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "// Convert metadata.ts to number\r\nvar incomingTs = parseInt(metadata.ts, 10);\r\n\r\n// Parse operarios_registrados list\r\nvar metaList = [];\r\ntry {\r\n    metaList = JSON.parse(metadata.operarios_registrados);\r\n} catch (e) {\r\n    metaList = [];\r\n}\r\n\r\n// Check if incomingTs exists\r\nvar tsExists = metaList.some(function(entry) {\r\n    return entry.ts === incomingTs;\r\n});\r\n\r\n// If ts exists: replace metadata.ts with (maxTs + 100)\r\nif (tsExists) {\r\n    var maxTs = incomingTs;\r\n\r\n    // Find largest ts in the list\r\n    for (var i = 0; i < metaList.length; i++) {\r\n        if (metaList[i].ts > maxTs) {\r\n            maxTs = metaList[i].ts;\r\n        }\r\n    }\r\n\r\n    // New ts is latest + 100ms\r\n    var newTs = maxTs + 100;\r\n\r\n    metadata.ts = newTs.toString();\r\n}\r\n\r\n// Save the result flag\r\nmetadata.tsExists = tsExists;\r\n\r\nreturn { msg: msg, metadata: metadata, msgType: msgType };\r\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764896714183,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "538e7930-d16a-11f0-b9be-a7eb49293647"
      },
      "name" : "Corregir el Timestamp si ya está ocupado",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1978,
        "layoutY" : 301
      },
      "configuration" : {
        "defaultTTL" : 0,
        "useServerTs" : false,
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        }
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764896768918,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "8cc61e80-d16d-11f0-b9be-a7eb49293647"
      },
      "name" : "Guardar",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 349,
        "layoutY" : 445
      },
      "configuration" : {
        "originatorSource" : "RELATED",
        "entityType" : null,
        "entityNamePattern" : null,
        "relationsQuery" : {
          "fetchLastLevelOnly" : false,
          "direction" : "TO",
          "maxLevel" : 1,
          "filters" : [ {
            "relationType" : "Contains",
            "entityTypes" : [ "DEVICE" ]
          } ]
        }
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "8cc64590-d16d-11f0-b9be-a7eb49293647"
      },
      "name" : "Redirigir a la Linea",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbChangeOriginatorNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 39,
        "layoutY" : 440
      },
      "configuration" : {
        "deleteFrom" : "METADATA",
        "keys" : [ "operarios_registrados", "operatorExists", "tsExists" ]
      },
      "configurationVersion" : 2,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "8cc66ca0-d16d-11f0-b9be-a7eb49293647"
      },
      "name" : "Limpiar la metadata",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbDeleteKeysNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 670,
        "layoutY" : 445
      },
      "configuration" : {
        "latestTsKeyNames" : [ "operarios_registrados" ],
        "aggregation" : "NONE",
        "fetchMode" : "ALL",
        "orderBy" : "ASC",
        "limit" : 1000,
        "useMetadataIntervalPatterns" : true,
        "startIntervalPattern" : "${inicioDelDia}",
        "endIntervalPattern" : "${finalDelDia}",
        "startInterval" : 2,
        "startIntervalTimeUnit" : "MINUTES",
        "endInterval" : 1,
        "endIntervalTimeUnit" : "MINUTES"
      },
      "configurationVersion" : 2,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "dfcdeae0-d16d-11f0-b9be-a7eb49293647"
      },
      "name" : "Jalar a todos los operarios registrados en el día",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1026,
        "layoutY" : 447
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var operator = msg.operarios_registrados;\r\n\r\n// Parse the metadata JSON array\r\nvar metaList = [];\r\ntry {\r\n    metaList = JSON.parse(metadata.operarios_registrados);\r\n} catch (e) {\r\n    metaList = [];\r\n}\r\n\r\n// Check existence using ES5 function syntax\r\nvar exists = metaList.some(function(entry) {\r\n    return entry.value === operator;\r\n});\r\n\r\n// Store result to metadata or msg\r\nmetadata.operatorExists = exists;\r\n\r\nreturn { msg: msg, metadata: metadata, msgType: msgType };\r\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "dfce11f0-d16d-11f0-b9be-a7eb49293647"
      },
      "name" : "Verificar que no se repita",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1323,
        "layoutY" : 445
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return msg.temperature > 20;",
        "tbelScript" : "return metadata.operatorExists == \"true\";"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "dfce11f1-d16d-11f0-b9be-a7eb49293647"
      },
      "name" : "Ya está regsitrado?",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1639,
        "layoutY" : 447
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "// Convert metadata.ts to number\r\nvar incomingTs = parseInt(metadata.ts, 10);\r\n\r\n// Parse operarios_registrados list\r\nvar metaList = [];\r\ntry {\r\n    metaList = JSON.parse(metadata.operarios_registrados);\r\n} catch (e) {\r\n    metaList = [];\r\n}\r\n\r\n// Check if incomingTs exists\r\nvar tsExists = metaList.some(function(entry) {\r\n    return entry.ts === incomingTs;\r\n});\r\n\r\n// If ts exists: replace metadata.ts with (maxTs + 100)\r\nif (tsExists) {\r\n    var maxTs = incomingTs;\r\n\r\n    // Find largest ts in the list\r\n    for (var i = 0; i < metaList.length; i++) {\r\n        if (metaList[i].ts > maxTs) {\r\n            maxTs = metaList[i].ts;\r\n        }\r\n    }\r\n\r\n    // New ts is latest + 100ms\r\n    var newTs = maxTs + 100;\r\n\r\n    metadata.ts = newTs.toString();\r\n}\r\n\r\n// Save the result flag\r\nmetadata.tsExists = tsExists;\r\n\r\nreturn { msg: msg, metadata: metadata, msgType: msgType };\r\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "dfce11f2-d16d-11f0-b9be-a7eb49293647"
      },
      "name" : "Corregir el Timestamp si ya está ocupado",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1978,
        "layoutY" : 449
      },
      "configuration" : {
        "defaultTTL" : 0,
        "useServerTs" : false,
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        }
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "e9647240-d16d-11f0-b9be-a7eb49293647"
      },
      "name" : "Guardar",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 347,
        "layoutY" : 594
      },
      "configuration" : {
        "originatorSource" : "RELATED",
        "entityType" : null,
        "entityNamePattern" : null,
        "relationsQuery" : {
          "fetchLastLevelOnly" : false,
          "direction" : "TO",
          "maxLevel" : 1,
          "filters" : [ {
            "relationType" : "Contains",
            "entityTypes" : [ "DEVICE" ]
          } ]
        }
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "fc695f90-d16d-11f0-b9be-a7eb49293647"
      },
      "name" : "Redirigir a la Supervisor",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbChangeOriginatorNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 37,
        "layoutY" : 589
      },
      "configuration" : {
        "deleteFrom" : "METADATA",
        "keys" : [ "operarios_registrados", "operatorExists", "tsExists" ]
      },
      "configurationVersion" : 2,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "fc695f91-d16d-11f0-b9be-a7eb49293647"
      },
      "name" : "Limpiar la metadata",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbDeleteKeysNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 668,
        "layoutY" : 594
      },
      "configuration" : {
        "latestTsKeyNames" : [ "operarios_registrados" ],
        "aggregation" : "NONE",
        "fetchMode" : "ALL",
        "orderBy" : "ASC",
        "limit" : 1000,
        "useMetadataIntervalPatterns" : true,
        "startIntervalPattern" : "${inicioDelDia}",
        "endIntervalPattern" : "${finalDelDia}",
        "startInterval" : 2,
        "startIntervalTimeUnit" : "MINUTES",
        "endInterval" : 1,
        "endIntervalTimeUnit" : "MINUTES"
      },
      "configurationVersion" : 2,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "fc695f92-d16d-11f0-b9be-a7eb49293647"
      },
      "name" : "Jalar a todos los operarios registrados en el día",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetTelemetryNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1024,
        "layoutY" : 596
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var operator = msg.operarios_registrados;\r\n\r\n// Parse the metadata JSON array\r\nvar metaList = [];\r\ntry {\r\n    metaList = JSON.parse(metadata.operarios_registrados);\r\n} catch (e) {\r\n    metaList = [];\r\n}\r\n\r\n// Check existence using ES5 function syntax\r\nvar exists = metaList.some(function(entry) {\r\n    return entry.value === operator;\r\n});\r\n\r\n// Store result to metadata or msg\r\nmetadata.operatorExists = exists;\r\n\r\nreturn { msg: msg, metadata: metadata, msgType: msgType };\r\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "fc695f93-d16d-11f0-b9be-a7eb49293647"
      },
      "name" : "Verificar que no se repita",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1321,
        "layoutY" : 594
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return msg.temperature > 20;",
        "tbelScript" : "return metadata.operatorExists == \"true\";"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "fc6986a0-d16d-11f0-b9be-a7eb49293647"
      },
      "name" : "Ya está regsitrado?",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1637,
        "layoutY" : 596
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "// Convert metadata.ts to number\r\nvar incomingTs = parseInt(metadata.ts, 10);\r\n\r\n// Parse operarios_registrados list\r\nvar metaList = [];\r\ntry {\r\n    metaList = JSON.parse(metadata.operarios_registrados);\r\n} catch (e) {\r\n    metaList = [];\r\n}\r\n\r\n// Check if incomingTs exists\r\nvar tsExists = metaList.some(function(entry) {\r\n    return entry.ts === incomingTs;\r\n});\r\n\r\n// If ts exists: replace metadata.ts with (maxTs + 100)\r\nif (tsExists) {\r\n    var maxTs = incomingTs;\r\n\r\n    // Find largest ts in the list\r\n    for (var i = 0; i < metaList.length; i++) {\r\n        if (metaList[i].ts > maxTs) {\r\n            maxTs = metaList[i].ts;\r\n        }\r\n    }\r\n\r\n    // New ts is latest + 100ms\r\n    var newTs = maxTs + 100;\r\n\r\n    metadata.ts = newTs.toString();\r\n}\r\n\r\n// Save the result flag\r\nmetadata.tsExists = tsExists;\r\n\r\nreturn { msg: msg, metadata: metadata, msgType: msgType };\r\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "fc6986a1-d16d-11f0-b9be-a7eb49293647"
      },
      "name" : "Corregir el Timestamp si ya está ocupado",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1976,
        "layoutY" : 598
      },
      "configuration" : {
        "defaultTTL" : 0,
        "useServerTs" : false,
        "processingSettings" : {
          "type" : "ON_EVERY_MESSAGE"
        }
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : false
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "fc6986a2-d16d-11f0-b9be-a7eb49293647"
      },
      "name" : "Guardar",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    } ],
    "ruleChainConnections" : null
  },
  "relations" : [ {
    "additionalInfo" : null,
    "from" : {
      "entityType" : "RULE_CHAIN",
      "id" : "67a610a0-8f1f-11f0-a61c-01e0c85fd5dd"
    },
    "to" : {
      "entityType" : "RULE_CHAIN",
      "id" : "5b40e700-d159-11f0-b9be-a7eb49293647"
    },
    "type" : "Uses",
    "typeGroup" : "COMMON",
    "version" : 269084
  } ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}