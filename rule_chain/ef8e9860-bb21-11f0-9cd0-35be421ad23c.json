{
  "entityType" : "RULE_CHAIN",
  "entity" : {
    "additionalInfo" : {
      "description" : ""
    },
    "configuration" : null,
    "debugMode" : false,
    "externalId" : null,
    "firstRuleNodeId" : {
      "entityType" : "RULE_NODE",
      "id" : "34eed840-bb3e-11f0-9cd0-35be421ad23c"
    },
    "id" : {
      "entityType" : "RULE_CHAIN",
      "id" : "ef8e9860-bb21-11f0-9cd0-35be421ad23c"
    },
    "name" : "Messaging",
    "root" : false,
    "type" : "CORE"
  },
  "metaData" : {
    "connections" : [ {
      "fromIndex" : 0,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 0,
      "toIndex" : 9,
      "type" : "Success"
    }, {
      "fromIndex" : 0,
      "toIndex" : 14,
      "type" : "Success"
    }, {
      "fromIndex" : 2,
      "toIndex" : 0,
      "type" : "Success"
    }, {
      "fromIndex" : 2,
      "toIndex" : 3,
      "type" : "Success"
    }, {
      "fromIndex" : 2,
      "toIndex" : 5,
      "type" : "Success"
    }, {
      "fromIndex" : 2,
      "toIndex" : 10,
      "type" : "Success"
    }, {
      "fromIndex" : 2,
      "toIndex" : 11,
      "type" : "Success"
    }, {
      "fromIndex" : 2,
      "toIndex" : 12,
      "type" : "Success"
    }, {
      "fromIndex" : 2,
      "toIndex" : 15,
      "type" : "Success"
    }, {
      "fromIndex" : 3,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 3,
      "toIndex" : 14,
      "type" : "Success"
    }, {
      "fromIndex" : 5,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 5,
      "toIndex" : 9,
      "type" : "Success"
    }, {
      "fromIndex" : 7,
      "toIndex" : 8,
      "type" : "Success"
    }, {
      "fromIndex" : 8,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 9,
      "toIndex" : 19,
      "type" : "True"
    }, {
      "fromIndex" : 10,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 10,
      "toIndex" : 9,
      "type" : "Success"
    }, {
      "fromIndex" : 10,
      "toIndex" : 14,
      "type" : "Success"
    }, {
      "fromIndex" : 11,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 11,
      "toIndex" : 9,
      "type" : "Success"
    }, {
      "fromIndex" : 12,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 12,
      "toIndex" : 9,
      "type" : "Success"
    }, {
      "fromIndex" : 12,
      "toIndex" : 14,
      "type" : "Success"
    }, {
      "fromIndex" : 14,
      "toIndex" : 13,
      "type" : "Success"
    }, {
      "fromIndex" : 15,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 17,
      "toIndex" : 18,
      "type" : "Success"
    }, {
      "fromIndex" : 18,
      "toIndex" : 7,
      "type" : "Success"
    }, {
      "fromIndex" : 19,
      "toIndex" : 17,
      "type" : "Success"
    } ],
    "firstNodeIndex" : 2,
    "nodes" : [ {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 476,
        "layoutY" : 353
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var evento = msg.evento ? msg.evento.toString().toUpperCase() : \"\";\nvar tipo = msg.TIPO_EVENTO ? msg.TIPO_EVENTO.toString().toUpperCase() : \"\";\nvar timestamp = msg.TIMESTAMP;\nvar estacion = msg.estacion;\nvar linea = msg.linea;\nvar serie = msg.serie;\nvar modelo = msg.MODELO;\nvar cliente = msg.cliente;\nvar operario = msg.operario;\nvar nombre_estacion = msg.motivo;\nvar tiempo_estado = msg.tiempo_estado;\nvar responsables = msg.RESPONSABLES_ID;\n\n\n// Asegurar que siempre sea array\nif (!Array.isArray(responsables)) {\n    if (responsables && responsables !== \"-\") {\n        responsables = [responsables];\n    } else {\n        responsables = [];\n    }\n}\n\n// Convertir array ‚Üí texto\nvar responsablesStr = responsables\n    .filter(function(r) { return r && r !== \"-\"; })\n    .join(\" - \");\n\n// Funci√≥n para escapar Markdown\nfunction escapeMarkdown(text) {\n    if (!text) return \"\";\n    return text.toString().replace(/([_*[\\]()~>])/g, \"\\\\$1\");\n}\n\nif (evento === \"INICIO_EMERGENCIA\" && tipo === \"ACTIVADO\") {\n    metadata.evento = evento;\n    metadata.estacion = estacion;\n    metadata.linea = linea;\n    metadata.serie = serie;\n    metadata.cliente = cliente;\n    metadata.modelo = modelo;\n    metadata.nombre_estacion = nombre_estacion;\n    metadata.timestamp = timestamp;\n    metadata.operario = Array.isArray(operario) ? operario.join(\", \") : operario;\n    metadata.responsables = responsablesStr;\n    metadata.suceso = \"INICIO DE MODO EMERGENCIA\"\n\n    var newMsg = {};\n    newMsg.chat_id = -5069003041;\n    newMsg.parse_mode = \"Markdown\";\n\n    newMsg.text =\n        \"üö® *ALERTA DE EMERGENCIA REPORTADA*\\n\" +\n        \"*FECHA Y HORA:* \" + escapeMarkdown(timestamp) + \"\\n\\n\" +\n        \"*L√çNEA DE ENSAMBLAJE:* \" + escapeMarkdown(linea) + \"\\n\" +\n        \"*N¬∞ ESTACI√ìN:* \" + escapeMarkdown(estacion) + \"\\n\" +\n        \"*NOMBRE DE ESTACI√ìN:* \" + escapeMarkdown(nombre_estacion) + \"\\n\" +\n        \"*SERIE:* \" + escapeMarkdown(serie) + \"\\n\" +\n        \"*MODELO:* \" + escapeMarkdown(modelo) + \"\\n\" +\n        \"*CLIENTE:* \" + escapeMarkdown(cliente) + \"\\n\" +\n        \"*OPERARIO(S):* \" + escapeMarkdown(metadata.operario) + \"\\n\" +\n        \"*RESPONSABLE(S):* \" + escapeMarkdown(responsablesStr);\n\n    return { msg: newMsg, metadata: metadata, msgType: msgType };\n}\n\nreturn { msg: {}, metadata: metadata, msgType: msgType };\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764882376564,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "8dc79750-bb24-11f0-9cd0-35be421ad23c"
      },
      "name" : "Filter Emergency Mode Active",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1472,
        "layoutY" : 290
      },
      "configuration" : {
        "restEndpointUrlPattern" : "https://api.telegram.org/bot8246934751:AAFsNJfqIl_KK5dcxvD-KsbTvbUqbokdFbE/sendMessage",
        "requestMethod" : "POST",
        "useSimpleClientHttpFactory" : false,
        "parseToPlainText" : false,
        "ignoreRequestBody" : false,
        "enableProxy" : false,
        "useSystemProxyProperties" : false,
        "proxyScheme" : null,
        "proxyHost" : null,
        "proxyPort" : 0,
        "proxyUser" : null,
        "proxyPassword" : null,
        "readTimeoutMs" : 0,
        "maxParallelRequestsCount" : 0,
        "headers" : {
          "Content-Type" : "application/json"
        },
        "credentials" : {
          "type" : "anonymous"
        },
        "maxInMemoryBufferSizeInKb" : 256
      },
      "configurationVersion" : 3,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1763394573781,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "8dc7be60-bb24-11f0-9cd0-35be421ad23c"
      },
      "name" : "Send Message Telegram Emergency Mode",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.rest.TbRestApiCallNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 132,
        "layoutY" : 372
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764879143591,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "34eed840-bb3e-11f0-9cd0-35be421ad23c"
      },
      "name" : "Connector",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 476,
        "layoutY" : 278
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var evento = msg.evento ? msg.evento.toString().toUpperCase() : \"\";\nvar tipo = msg.TIPO_EVENTO ? msg.TIPO_EVENTO.toString().toUpperCase() : \"\";\nvar timestamp = msg.TIMESTAMP || \"-\";\nvar estacion = msg.estacion || \"-\";\nvar linea = msg.linea || \"-\";\nvar motivo = msg.motivo;\nvar operario = msg.nombre_operario || \"-\";\nvar responsables = msg.RESPONSABLES_ID;\nvar serie = msg.serie;\nvar modelo = msg.MODELO;\nvar cliente = msg.cliente;\n\n// Asegurar que siempre sea array\nif (!Array.isArray(responsables)) {\n    if (responsables && responsables !== \"-\") {\n        responsables = [responsables];\n    } else {\n        responsables = [];\n    }\n}\n\n// Convertir array ‚Üí texto\nvar responsables_llamada = responsables\n    .filter(function(r) { return r && r !== \"-\"; })\n    .join(\" - \");\n\n// Funci√≥n para escapar caracteres especiales de Markdown\nfunction escapeMarkdown(text) {\n    if (!text) return \"\";\n    text = text.toString();\n    return text.replace(/([_*[\\]()~>])/g, \"\\\\$1\");\n}\n\nmetadata.estacion = estacion;\nmetadata.linea = linea;\nmetadata.serie = serie;\nmetadata.modelo = modelo;\nmetadata.timestamp = timestamp;\n\nmetadata.motivo = motivo;\nmetadata.cliente = cliente;\n\nif (evento === \"LLAMAR_SUPERVISOR\" && tipo === \"APROBACION\") {\n    metadata.evento = evento;\n    metadata.suceso = \"SE REQUIERE APROBACI√ìN DE SUPERVISOR\";\n    var newMsg = {};\n    newMsg.chat_id = -5069003041;\n    newMsg.parse_mode = \"Markdown\";\n\n    newMsg.text =\n        \"üí¨ *SOLICITUD DE APROBACI√ìN*\\n\" +\n        \"*FECHA Y HORA:* \" + escapeMarkdown(timestamp) + \"\\n\\n\" +\n        \"*N¬∞ ESTACI√ìN:* \" + escapeMarkdown(estacion) + \"\\n\" +\n        \"*L√çNEA DE ENSAMBLAJE:* \" + escapeMarkdown(linea) + \"\\n\" +\n        \"*MOTIVO:* \" + escapeMarkdown(motivo) + \"\\n\\n\" +\n        \"*SERIE:* \" + escapeMarkdown(serie) + \"\\n\" +\n        \"*MODELO:* \" + escapeMarkdown(modelo) + \"\\n\" +\n        \"*RESPONSABLE(S):* \" + escapeMarkdown(responsables_llamada);\n\n    return {\n        msg: newMsg,\n        metadata: metadata,\n        msgType: msgType\n    };\n}\n\nif (evento === \"LLAMAR_SUPERVISOR\" && tipo === \"ASISTENCIA\") {\n    metadata.evento = evento;\n    metadata.suceso = \"SE REQUIERE ASISTENCIA DE SUPERVISOR\";\n    var newMsg = {};\n    newMsg.chat_id = -5069003041;\n    newMsg.parse_mode = \"Markdown\";\n\n    newMsg.text =\n        \"üí¨ *ASISTENCIA EN ESTACI√ìN*\\n\" +\n        \"*FECHA Y HORA:* \" + escapeMarkdown(timestamp) + \"\\n\\n\" +\n        \"*N¬∞ ESTACI√ìN:* \" + escapeMarkdown(estacion) + \"\\n\" +\n        \"*L√çNEA DE ENSAMBLAJE:* \" + escapeMarkdown(linea) + \"\\n\\n\" +\n        \"*SERIE:* \" + escapeMarkdown(serie) + \"\\n\" +\n        \"*MODELO:* \" + escapeMarkdown(modelo) + \"\\n\" \n        \"*RESPONSABLE(S):* \" + escapeMarkdown(responsables_llamada);\n\n    return {\n        msg: newMsg,\n        metadata: metadata,\n        msgType: msgType\n    };\n}\n\n// Si no coincide ning√∫n evento\nreturn {\n    msg: {},\n    metadata: metadata,\n    msgType: msgType\n};\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764782523712,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "4c474130-bb3e-11f0-9cd0-35be421ad23c"
      },
      "name" : "Filter Request Supervisor",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1293,
        "layoutY" : 16
      },
      "configuration" : {
        "fromTemplate" : "alertas@smelpro.com",
        "toTemplate" : "ahlelycontreras.18.03@gmail.com",
        "ccTemplate" : null,
        "bccTemplate" : null,
        "subjectTemplate" : "L√çNEA ${linea}/ESTACI√ìN ${estacion} - Alerta de Emergencia Reportada",
        "mailBodyType" : "true",
        "bodyTemplate" : "<b>Notificaci√≥n de Emergencia Activada</b><br><br>\n\n<b>Fecha y hora:</b> ${timestamp}<br>\n<b>L√≠nea de Ensamblaje:</b> ${linea}<br>\n<b>N¬∞ Estaci√≥n:</b> ${estacion}<br>\n<b>Nombre de Estaci√≥n:</b> ${nombre_estacion}<br>\n<b>Serie:</b> ${serie}<br>\n<b>Modelo:</b> ${modelo}<br>\n<b>Cliente:</b> ${cliente}<br>\n<b>Operario(s):</b> ${operario}<br><br>\n\nSe ha registrado una condici√≥n de emergencia en la l√≠nea de producci√≥n.  \nPor favor, active los protocolos de seguridad correspondientes y comunique la situaci√≥n a las √°reas responsables para garantizar la continuidad y seguridad de las operaciones.<br><br>\n\n<hr>\n<table style=\"width:100%; font-family: Arial, sans-serif; border-collapse: collapse;\">\n  <tr>\n    <td style=\"width: 30%; vertical-align: middle; text-align: center; padding: 8px 0px 8px 8px;\">\n      <img src=\"https://dashboard.smelpro.com/api/images/public/v1mP9x41vsyDPellTLD3yI337oOprK00\" alt=\"Logo empresarial-01-02.png\" style=\"max-width: 180px;\" />\n    </td>\n    <td style=\"width: 70%; vertical-align: middle; text-align: left; padding: 8px; 8px 8px 0px\">\n      <b>Soporte Smelpro</b><br>\n      Direcci√≥n: Calle Hefesto 499, Oficina 502, Ate, Lima, Per√∫<br>\n      Tel√©f.: +51 1 3226467<br>\n      Cel.: +51 923265572 / 927347035 / 963409900<br><br>\n      <small>Este es un mensaje autom√°tico generado por el sistema de monitoreo IoT Smelpro - No responder este correo.</small>\n    </td>\n  </tr>\n</table>\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "863b4190-bb55-11f0-9cd0-35be421ad23c"
      },
      "name" : "Alert Email",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.mail.TbMsgToEmailNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 476,
        "layoutY" : 430
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var evento = msg.evento ? msg.evento.toString().toUpperCase() : \"\";\nvar tipo = msg.TIPO_EVENTO ? msg.TIPO_EVENTO.toString().toUpperCase() : \"\";\nvar timestamp = msg.TIMESTAMP;\nvar estacion = msg.estacion;\nvar linea = msg.linea;\nvar nombre_estacion = msg.motivo;\nvar tiempo_estado = msg.tiempo_estado;\n\nif (evento == \"FIN_EMERGENCIA\" && tipo == \"DESACTIVADO\") {\n    metadata.evento = evento;\n    var newMsg = {};\n    newMsg.chat_id = -5069003041;\n    newMsg.parse_mode = \"Markdown\";\n    newMsg.text =\n        \"‚úÖ *EMERGENCIA RESUELTA*\\n\" +\n        \"*FECHA Y HORA:* \" + timestamp + \"\\n\" +\n        \"*TIEMPO EN ESTADO DE EMERGENCIA:* \" + tiempo_estado + \"\\n\\n\" +\n        \"*L√çNEA DE ENSAMBLAJE:* \" + linea + \"\\n\" +\n        \"*N¬∞ ESTACI√ìN:* \" + estacion + \"\\n\" +\n        \"*NOMBRE DE ESTACI√ìN:* \" + nombre_estacion;\n    return { msg: newMsg, metadata: metadata, msgType: msgType };\n}\n\nreturn { msg: {}, metadata: metadata, msgType: msgType };\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764783470470,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "863b4191-bb55-11f0-9cd0-35be421ad23c"
      },
      "name" : "Filter Emergency Mode Inactive",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1500,
        "layoutY" : 18
      },
      "configuration" : {
        "useSystemSmtpSettings" : true,
        "smtpHost" : "localhost",
        "smtpPort" : 25,
        "username" : null,
        "password" : null,
        "smtpProtocol" : "smtp",
        "timeout" : 10000,
        "enableTls" : false,
        "tlsVersion" : "TLSv1.2",
        "enableProxy" : false,
        "proxyHost" : null,
        "proxyPort" : null,
        "proxyUser" : null,
        "proxyPassword" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "c1730e90-bb56-11f0-9cd0-35be421ad23c"
      },
      "name" : "Send Alert Email",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.mail.TbSendEmailNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1246,
        "layoutY" : 724
      },
      "configuration" : {
        "restEndpointUrlPattern" : "http://dashboard.smelpro.com/api/alarms?pageSize=100&page=0&searchStatus=ACTIVE",
        "requestMethod" : "GET",
        "useSimpleClientHttpFactory" : false,
        "parseToPlainText" : false,
        "ignoreRequestBody" : false,
        "enableProxy" : false,
        "useSystemProxyProperties" : false,
        "proxyScheme" : null,
        "proxyHost" : null,
        "proxyPort" : 0,
        "proxyUser" : null,
        "proxyPassword" : null,
        "readTimeoutMs" : 0,
        "maxParallelRequestsCount" : 0,
        "headers" : {
          "Content-Type" : "application/json",
          "X-Authorization" : "Bearer ${token}"
        },
        "credentials" : {
          "type" : "anonymous"
        },
        "maxInMemoryBufferSizeInKb" : 256
      },
      "configurationVersion" : 3,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1763057632218,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "1515efc0-c0b8-11f0-9cd0-35be421ad23c"
      },
      "name" : "Get alarms",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.rest.TbRestApiCallNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1349,
        "layoutY" : 474
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var data = msg.data ? msg.data : [];\n\nif (typeof data === \"string\") {\n    try {\n        data = JSON.parse(data);\n    } catch (e) {\n        data = [];\n    }\n}\n\nif (data && data.data) {\n    data = data.data;\n}\n\nvar total = data.length;\nvar lineas = {}; // { linea: [estaciones] }\n\nfor (var i = 0; i < total; i++) {\n    var alarm = data[i];\n    var nombre = alarm.originatorName || \"\";\n\n    var partes = nombre.split(\" \");\n    if (partes.length >= 2) {\n        var numeros = partes[1].split(\".\");\n        var linea = \"L√≠nea \" + (numeros[0] || \"?\");\n        var estacion = \"Estaci√≥n \" + (numeros[1] || \"?\");\n\n        if (!lineas[linea]) lineas[linea] = [];\n        lineas[linea].push(estacion);\n    }\n}\n\nvar texto = \"\";\nif (total > 0) {\n    texto = \"*üö® Alertas activas: \" + total + \"*\\n\\n\";\n    for (var linea in lineas) {\n        texto += \"*\" + linea + \"* ‚Üí \" + lineas[linea].join(\", \") + \"\\n\";\n    }\n} else {\n    texto = \"‚úÖ *No hay alertas activas actualmente.*\";\n}\n\nvar newMsg = {};\nnewMsg.chat_id = -5069003041;  \nnewMsg.parse_mode = \"Markdown\";\nnewMsg.text = texto;\n\nreturn { msg: newMsg, metadata: metadata, msgType: msgType };\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1763056679786,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "28953d30-c0b8-11f0-9cd0-35be421ad23c"
      },
      "name" : "Get alarms active",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 890,
        "layoutY" : 539
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return msg.temperature > 20;",
        "tbelScript" : "return metadata.evento == \"INICIO_EMERGENCIA\" || metadata.evento == \"FIN_EMERGENCIA\" || metadata.evento == \"INICIO_PARADA\" || metadata.evento == \"FIN_PARADA\" || metadata.evento == \"LLAMAR_SUPERVISOR\";"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "e9aa59a0-c0be-11f0-9cd0-35be421ad23c"
      },
      "name" : "Filter Message - Alarmas Activas",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 477,
        "layoutY" : 129
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var evento = msg.evento ? msg.evento.toString().toUpperCase() : \"\";\nvar timestamp = msg.TIMESTAMP || \"-\";\nvar estacion = msg.estacion || \"-\";\nvar linea = msg.linea || \"-\";\nvar serie = msg.serie || \"-\";\nvar modelo = msg.MODELO || \"-\";\nvar cliente = msg.cliente || \"-\";\nvar operario = msg.nombre_operario || \"-\";\nvar responsables = msg.RESPONSABLES_ID;\n\n// Asegurar que siempre sea array\nif (!Array.isArray(responsables)) {\n    if (responsables && responsables !== \"-\") {\n        responsables = [responsables];\n    } else {\n        responsables = [];\n    }\n}\n\n// Convertir array ‚Üí texto\nvar responsablesStr = responsables\n    .filter(function(r) { return r && r !== \"-\"; })\n    .join(\" - \");\nvar causa1 = msg.CAUSA_1;\nvar causa2 = msg.CAUSA_2;\nvar causa3 = msg.CAUSA_3;\nvar causa4 = msg.CAUSA_4;\nvar causa5 = msg.CAUSA_5;\n\n\nif (evento === \"INICIO_PARADA\") {\n    metadata.evento = evento;\n    // Operario a texto simple\n    var operarioStr = Array.isArray(operario) ? operario\n        .join(\", \") : operario;\n\n\n    var newMsg = {};\n    newMsg.chat_id = -5069003041;\n    newMsg.parse_mode = \"Markdown\";\n\n    function escapeMarkdown(text) {\n        if (!text) return \"\"; // null o undefined\n        text = text.toString(); \n        return text.replace(/([_*[\\]()~>])/g, \"\\\\$1\");\n    }\n    \nvar causas = [causa1, causa2, causa3, causa4, causa5]\n    .filter(function(c) { return c && c !== \"-\"; })\n    .join(\"\\n\");\n\n        \n    metadata.estacion = estacion;\n    metadata.linea = linea;\n    metadata.serie = serie;\n    metadata.cliente = cliente;\n    metadata.modelo = modelo;\n    metadata.operario = operarioStr;\n    metadata.timestamp = timestamp;\n    metadata.responsables = responsablesStr;\n    metadata.causas = causas;\n    metadata.suceso = \"ALERTA DE PARADA\";\n\n    \n    newMsg.text =\n        \"‚ö†Ô∏è *INICIO DE PARADA REGISTRADO*\\n\" +\n        \"*FECHA Y HORA:* \" + escapeMarkdown(timestamp) + \"\\n\\n\" +\n        \"*L√çNEA:* \" + escapeMarkdown(linea) + \"\\n\" +\n        \"*ESTACI√ìN:* \" + escapeMarkdown(estacion) + \"\\n\" +\n        \"*SERIE:* \" + escapeMarkdown(serie) + \"\\n\" +\n        \"*MODELO:* \" + escapeMarkdown(modelo) + \"\\n\" +\n        \"*CLIENTE:* \" + escapeMarkdown(cliente) + \"\\n\" +\n        \"*OPERARIO(S):* \" + escapeMarkdown(operarioStr) + \"\\n\\n\" +\n        \"*‚õî DETALLE DE CAUSA:* \\n\" +\n        escapeMarkdown(causas) + \"\\n\" +\n        \"*Responsable(s) asignado(s):* \" + escapeMarkdown(responsablesStr);\n    \n\n    return {\n        msg: newMsg,\n        metadata: metadata,\n        msgType: msgType\n    };\n}",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764870934405,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7e2bc580-c18e-11f0-9cd0-35be421ad23c"
      },
      "name" : "Filter Inicio Parada",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 477,
        "layoutY" : 206
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var evento = msg.evento ? msg.evento.toString().toUpperCase() : \"\";\nvar timestamp = msg.TIMESTAMP || \"-\";\nvar estacion = msg.estacion || \"-\";\nvar linea = msg.linea || \"-\";\nvar serie = msg.serie || \"-\";\nvar modelo = msg.MODELO || \"-\";\nvar cliente = msg.cliente || \"-\";\nvar operario = msg.nombre_operario || \"-\";\nvar tiempo_estado = msg.tiempo_estado;\n\n// Obtener causas\nvar causa1 = msg.CAUSA_1;\nvar causa2 = msg.CAUSA_2;\nvar causa3 = msg.CAUSA_3;\nvar causa4 = msg.CAUSA_4;\nvar causa5 = msg.CAUSA_5;\n\nif (evento === \"FIN_PARADA\") {\n    metadata.evento = evento;\n\n    // Operario a texto simple\n    var operarioStr = Array.isArray(operario) ? operario.join(\", \") : operario;\n\n    // Convertir array de causas ‚Üí texto\n    var causasTexto = [causa1, causa2, causa3, causa4, causa5]\n        .filter(function(c) { return c && c !== \"-\"; })\n        .join(\"\\n\");\n\n    metadata.estacion = estacion;\n    metadata.linea = linea;\n    metadata.serie = serie;\n    metadata.cliente = cliente;\n    metadata.modelo = modelo;\n    metadata.operario = operarioStr;\n    metadata.timestamp = timestamp;\n    metadata.causas = causasTexto;\n\n    var newMsg = {};\n    newMsg.chat_id = -5069003041;\n    newMsg.parse_mode = \"Markdown\";\n\n    function escapeMarkdown(text) {\n        if (!text) return \"\"; // null o undefined\n        text = text.toString(); \n        return text.replace(/([_*[\\]()~>])/g, \"\\\\$1\");\n    }\n\n    newMsg.text =\n        \"‚úÖ *PARADA RESUELTA*\\n\" +\n        \"*FECHA Y HORA:* \" + escapeMarkdown(timestamp) + \"\\n\" +\n        \"*TIEMPO EN ESTADO DE PARADA:* \" + escapeMarkdown(tiempo_estado) + \"\\n\\n\" +\n        \"*L√çNEA:* \" + escapeMarkdown(linea) + \"\\n\" +\n        \"*ESTACI√ìN:* \" + escapeMarkdown(estacion) + \"\\n\\n\" +\n        \"*‚õî DETALLE DE CAUSA REAL:*\\n\" +\n        escapeMarkdown(causasTexto);\n\n    return {\n        msg: newMsg,\n        metadata: metadata,\n        msgType: msgType\n    };\n}\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764870934405,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "dec69940-c1a4-11f0-9cd0-35be421ad23c"
      },
      "name" : "Filter Fin Parada",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 475,
        "layoutY" : 498
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var evento = msg.evento ? msg.evento.toString().toUpperCase() : \"\";\nvar tipo = msg.TIPO_EVENTO ? msg.TIPO_EVENTO.toString().toUpperCase() : \"\";  \nvar timestamp = msg.TIMESTAMP;\nvar estacion = msg.estacion;\nvar linea = msg.linea;\nvar serie = msg.serie;\nvar modelo = msg.MODELO;\nvar cliente = msg.cliente;\nvar nombre_operario = msg.nombre_operario;\nvar motivo = msg.motivo;\nvar clasificacion = msg.CLASIFICACION;\nvar responsables = msg.RESPONSABLES_ID;\n\n// Asegurar que siempre sea array\nif (!Array.isArray(responsables)) {\n    if (responsables && responsables !== \"-\") {\n        responsables = [responsables];\n    } else {\n        responsables = [];\n    }\n}\n\n// Convertir array ‚Üí texto\nvar responsablesStr = responsables\n    .filter(function(r) { return r && r !== \"-\"; })\n    .join(\" - \");\n\n// Funci√≥n para escapar Markdown\nfunction escapeMarkdown(text) {\n    if (!text) return \"\";\n    return text.toString().replace(/([_*[\\]()~>])/g, \"\\\\$1\");\n}\n\nif (evento === \"ALERTA\") {\n    metadata.evento = evento;\n    metadata.estacion = estacion;\n    metadata.linea = linea;\n    metadata.serie = serie;\n    metadata.cliente = cliente;\n    metadata.modelo = modelo;\n    metadata.motivo = motivo;\n    metadata.timestamp = timestamp;\n    metadata.operario = Array.isArray(nombre_operario) ? nombre_operario.join(\", \") : nombre_operario;\n    metadata.responsables = responsablesStr;\n    metadata.clasificacion = clasificacion;\n    metadata.suceso = motivo;\n\n    var newMsg = {};\n    newMsg.chat_id = -5069003041;\n    newMsg.parse_mode = \"Markdown\";\n\n    newMsg.text =\n        \"‚ö†Ô∏è *ALERTA REPORTADA*\\n\" +\n        \"*FECHA Y HORA:* \" + escapeMarkdown(timestamp) + \"\\n\\n\" +\n        \"*L√çNEA DE ENSAMBLAJE:* \" + escapeMarkdown(linea) + \"\\n\" +\n        \"*N¬∞ ESTACI√ìN:* \" + escapeMarkdown(estacion) + \"\\n\" +\n        \"*MOTIVO:* \" + escapeMarkdown(motivo) + \"\\n\" +\n        \"*SERIE:* \" + escapeMarkdown(serie) + \"\\n\" +\n        \"*MODELO:* \" + escapeMarkdown(modelo) + \"\\n\" +\n        \"*CLIENTE:* \" + escapeMarkdown(cliente) + \"\\n\" +\n        \"*OPERARIO(S):* \" + escapeMarkdown(metadata.operario) + \"\\n\\n\" +\n        \"*RESPONSABLE(S):* \" + escapeMarkdown(responsablesStr);\n\n    return { msg: newMsg, metadata: metadata, msgType: msgType };\n}\n\nreturn { msg: {}, metadata: metadata, msgType: msgType };\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "c433f7a0-d070-11f0-b9be-a7eb49293647"
      },
      "name" : "Filter Alerta Generica",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1490,
        "layoutY" : 207
      },
      "configuration" : {
        "restEndpointUrlPattern" : "https://defaultb4b8f9fe0cb441c983df01bc8a10c9.19.environment.api.powerplatform.com/powerautomate/automations/direct/workflows/c2577d83520f446f9bcba511113f4ad0/triggers/manual/paths/invoke/alertas/ensamblaje_mp?api-version=1&sp=triggers/manual/run&sv=1.0&sig=GOt8YpjuSayVQ7PbkmJQGi0g7ib71rAuPpvgl976uIo",
        "requestMethod" : "POST",
        "useSimpleClientHttpFactory" : false,
        "parseToPlainText" : false,
        "ignoreRequestBody" : false,
        "enableProxy" : false,
        "useSystemProxyProperties" : false,
        "proxyScheme" : null,
        "proxyHost" : null,
        "proxyPort" : 0,
        "proxyUser" : null,
        "proxyPassword" : null,
        "readTimeoutMs" : 0,
        "maxParallelRequestsCount" : 0,
        "headers" : {
          "Content-Type" : "application/json",
          "User-Agent" : "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
        },
        "credentials" : {
          "type" : "anonymous"
        },
        "maxInMemoryBufferSizeInKb" : 256
      },
      "configurationVersion" : 3,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764883075371,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "99f82460-d076-11f0-b9be-a7eb49293647"
      },
      "name" : "Send Email Power Automate",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.rest.TbRestApiCallNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 926,
        "layoutY" : 67
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var evento = metadata.evento;\nvar timestamp = metadata.timestamp;\nvar estacion = metadata.estacion;\nvar linea = metadata.linea;\nvar serie = metadata.serie;\nvar modelo = metadata.modelo;\nvar cliente = metadata.cliente;\nvar suceso = metadata.suceso;\nvar nombre_estacion = metadata.nombre_estacion;\n\nif (evento == \"INICIO_EMERGENCIA\" || evento == \"INICIO_PARADA\" || evento == \"ALERTA\" || evento== \"LLAMAR_SUPERVISOR\"){\n    var newMsg = {};\n    newMsg.apikey = \"lsmJER9sNSdq0dQaZDetk2fgbXurGkRBoinyEr1a\";\n    newMsg.to = \"acontreras@smelpro.com\";\n    newMsg.subject = \"ALERTA EN L√çNEA DE ENSAMBLAJE MODAPOWER\";\n    \n    // Fecha y hora simple\n    var fechaHora = new Date().toISOString().replace('T', ' ').substring(0, 19);\n    \n    newMsg.htmlBody =\n        \"<div style='font-family: Arial, sans-serif; max-width:650px; color:#2c3e50;'>\" +\n\n            \"<div style='padding:20px 0; border-bottom:3px solid #e74c3c;'>\" +\n                \"<h2 style='color:#e74c3c; margin:0; font-size:22px; font-weight:600;'>‚ö† ALERTA EN L√çNEA DE ENSAMBLAJE</h2>\" +\n                \"<p style='color:#7f8c8d; margin:8px 0 0 0; font-size:14px;'>Sistema de Monitoreo MODAPOWER</p>\" +\n            \"</div>\" +\n\n            \"<div style='padding:25px 0;'>\" +\n                \n                \"<div style='border-left:4px solid #f39c12; padding:8px 15px; margin-bottom:20px;'>\" +\n                    \"<strong style='color:#e67e22; font-size:15px;'>üìã \" + suceso + \"</strong>\" +\n                \"</div>\" +\n\n                \"<table style='width:100%; border-collapse:collapse; font-size:14px;'>\" +\n                    \"<tr style='border-bottom:1px solid #ecf0f1;'>\" +\n                        \"<td style='padding:8px 0; color:#7f8c8d; width:35%;'><strong>Fecha y Hora:</strong></td>\" +\n                        \"<td style='padding:8px 0;'>\" + timestamp + \"</td>\" +\n                    \"</tr>\" +\n                    \"<tr style='border-bottom:1px solid #ecf0f1;'>\" +\n                        \"<td style='padding:8px 0; color:#7f8c8d;'><strong>Estaci√≥n:</strong></td>\" +\n                        \"<td style='padding:8px 0;'>\" + estacion +  \"</td>\" +\n                    \"</tr>\" +\n                    \"<tr style='border-bottom:1px solid #ecf0f1;'>\" +\n                        \"<td style='padding:8px 0; color:#7f8c8d;'><strong>L√≠nea:</strong></td>\" +\n                        \"<td style='padding:8px 0;'>\" + linea + \"</td>\" +\n                    \"</tr>\" +\n                    \"<tr style='border-bottom:1px solid #ecf0f1;'>\" +\n                        \"<td style='padding:8px 0; color:#7f8c8d;'><strong>Serie:</strong></td>\" +\n                        \"<td style='padding:8px 0;'>\" + serie + \"</td>\" +\n                    \"</tr>\" +\n                    \"<tr style='border-bottom:1px solid #ecf0f1;'>\" +\n                        \"<td style='padding:8px 0; color:#7f8c8d;'><strong>Modelo:</strong></td>\" +\n                        \"<td style='padding:8px 0;'>\" + modelo + \"</td>\" +\n                    \"</tr>\" +\n                    \"<tr style='border-bottom:1px solid #ecf0f1;'>\" +\n                        \"<td style='padding:8px 0; color:#7f8c8d;'><strong>Cliente:</strong></td>\" +\n                        \"<td style='padding:8px 0;'>\" + cliente + \"</td>\" +\n                    \"</tr>\" +\n                \"</table>\" +\n\n            \"</div>\" +\n\n            \"<hr style='border:none; border-top:1px solid #e1e8ed; margin:20px 0;'>\" +\n\n            \"<table style='width:100%; font-family: Arial, sans-serif; border-collapse: collapse;'>\" +\n                \"<tr>\" +\n                    \"<td style='width:30%; vertical-align:middle; text-align:center; padding:8px 0px 8px 8px;'>\" +\n                        \"<img src='https://dashboard.smelpro.com/api/images/public/v1mP9x41vsyDPellTLD3yI337oOprK00' \" +\n                        \"alt='Logo Smelpro' style='max-width:180px;' />\" +\n                    \"</td>\" +\n                    \"<td style='width:70%; vertical-align:middle; text-align:left; padding:8px;'>\" +\n                        \"<b>Soporte Smelpro</b><br>\" +\n                        \"Direcci√≥n: Calle Hefesto 499, Oficina 502, Ate, Lima, Per√∫<br>\" +\n                        \"Tel√©f.: +51 1 3226467<br>\" +\n                        \"Cel.: +51 923265572 / 927347035 / 963409900<br><br>\" +\n                        \"<small>Este es un mensaje autom√°tico generado por el sistema de monitoreo IoT Smelpro - No responder este correo.</small>\" +\n                    \"</td>\" +\n                \"</tr>\" +\n            \"</table>\" +\n\n        \"</div>\";\n    \n    return {\n        msg: newMsg,\n        metadata: metadata,\n        msgType: msgType\n    };\n}\n\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764883075371,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "99f82461-d076-11f0-b9be-a7eb49293647"
      },
      "name" : "For email",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 480,
        "layoutY" : 586
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var d = msg.details || {};\n\n// Variables limpias desde details\nvar linea = d.linea || \"-\";\nvar estacion = d.estacion || \"-\";\nvar serie = d.serie || \"-\";\nvar modelo = d.MODELO || \"-\";\nvar cliente = d.cliente || \"-\";\nvar tiempo_alerta = d.tiempo_alerta || \"-\";\nvar evento = d.evento || \"-\";\n\nfunction escapeMarkdown(text) {\n    if (!text) return \"\";\n    return text.toString().replace(/([_*[\\]()~>])/g, \"\\\\$1\");\n}\nvar OFFSET_HORAS = -5;   // Per√∫, Colombia, M√©xico (CDMX), etc.\n\n// Convertir epoch ms ‚Üí fecha local con offset\nfunction formatDateWithOffset(epochMs, offsetHrs) {\n    if (!epochMs || epochMs === 0) return \"-\";\n    var d = new Date(epochMs + offsetHrs * 3600 * 1000);\n\n    var yyyy = d.getFullYear();\n    var mm = (\"0\" + (d.getMonth() + 1)).slice(-2);\n    var dd = (\"0\" + d.getDate()).slice(-2);\n    var hh = (\"0\" + d.getHours()).slice(-2);\n    var min = (\"0\" + d.getMinutes()).slice(-2);\n    var ss = (\"0\" + d.getSeconds()).slice(-2);\n\n    return yyyy + \"-\" + mm + \"-\" + dd + \" \" + hh + \":\" + min + \":\" + ss;\n}\n\n// Ahora s√≠, fecha correcta para Per√∫\nvar fechaClear = formatDateWithOffset(msg.clearTs, OFFSET_HORAS);\n\n// Solo enviamos mensaje si existe tipo de alarma y detalles\nif (msg.type && evento !=\"FIN_PARADA\" && evento !=\"FIN_EMERGENCIA\") {\n\n    var newMsg = {};\n    newMsg.chat_id = -5069003041;   // Tu canal/grupo\n    newMsg.parse_mode = \"Markdown\";\n\n    newMsg.text =\n        \"‚úÖ *ALERTA RESUELTA*\\n\" +\n        \"*FECHA Y HORA: *\"+escapeMarkdown(fechaClear)+\"\\n\" +\n        \"*TIEMPO DE ALERTA:* \" + escapeMarkdown(tiempo_alerta)+\"\\n\\n\" +\n        \"*L√çNEA:* \" + escapeMarkdown(linea) + \"\\n\" +\n        \"*ESTACI√ìN:* \" + escapeMarkdown(estacion) + \"\\n\" +\n        \"*SERIE:* \" + escapeMarkdown(serie) + \"\\n\" +\n        \"*MODELO:* \" + escapeMarkdown(modelo) + \"\\n\" +\n        \"*CLIENTE:* \" + escapeMarkdown(cliente) + \"\\n\";\n\n    return { msg: newMsg, metadata: {}, msgType: msgType };\n}\n\nreturn { msg: {}, metadata: {}, msgType: msgType };\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764872830485,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "824b44f0-d099-11f0-b9be-a7eb49293647"
      },
      "name" : "Filter Alerta Generica Fin",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1488,
        "layoutY" : 141
      },
      "configuration" : {
        "restEndpointUrlPattern" : "https://ww0pvvvt1f.execute-api.us-east-2.amazonaws.com/send-email",
        "requestMethod" : "POST",
        "useSimpleClientHttpFactory" : false,
        "parseToPlainText" : false,
        "ignoreRequestBody" : false,
        "enableProxy" : false,
        "useSystemProxyProperties" : false,
        "proxyScheme" : null,
        "proxyHost" : null,
        "proxyPort" : 0,
        "proxyUser" : null,
        "proxyPassword" : null,
        "readTimeoutMs" : 0,
        "maxParallelRequestsCount" : 0,
        "headers" : {
          "Content-Type" : "application/json"
        },
        "credentials" : {
          "type" : "anonymous"
        },
        "maxInMemoryBufferSizeInKb" : 256
      },
      "configurationVersion" : 3,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1764806055183,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "473ae700-d0a1-11f0-b9be-a7eb49293647"
      },
      "name" : "email modasa",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.rest.TbRestApiCallNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 964,
        "layoutY" : 755
      },
      "configuration" : {
        "restEndpointUrlPattern" : "https://dashboard.smelpro.com/api/auth/login",
        "requestMethod" : "POST",
        "useSimpleClientHttpFactory" : false,
        "parseToPlainText" : false,
        "ignoreRequestBody" : false,
        "enableProxy" : false,
        "useSystemProxyProperties" : false,
        "proxyScheme" : null,
        "proxyHost" : null,
        "proxyPort" : 0,
        "proxyUser" : null,
        "proxyPassword" : null,
        "readTimeoutMs" : 0,
        "maxParallelRequestsCount" : 0,
        "headers" : {
          "Content-Type" : "application/json"
        },
        "credentials" : {
          "type" : "anonymous"
        },
        "maxInMemoryBufferSizeInKb" : 256
      },
      "configurationVersion" : 3,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "4aa2e270-d0a7-11f0-b9be-a7eb49293647"
      },
      "name" : "token",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.rest.TbRestApiCallNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1114,
        "layoutY" : 843
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "metadata.token=msg.token;\nreturn {msg: msg, metadata: metadata, msgType: msgType};\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "8b8ee900-d0a7-11f0-b9be-a7eb49293647"
      },
      "name" : "Token Access",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 815,
        "layoutY" : 658
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var msgout={};\nmsgout.username=\"modasa@smelpro.com\";\nmsgout.password=\"modasa2025#\";\n\nreturn {msg: msgout, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "3f286650-d14b-11f0-b9be-a7eb49293647"
      },
      "name" : "Access Credentials",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    } ],
    "ruleChainConnections" : null
  },
  "relations" : [ {
    "additionalInfo" : null,
    "from" : {
      "entityType" : "RULE_CHAIN",
      "id" : "67a610a0-8f1f-11f0-a61c-01e0c85fd5dd"
    },
    "to" : {
      "entityType" : "RULE_CHAIN",
      "id" : "ef8e9860-bb21-11f0-9cd0-35be421ad23c"
    },
    "type" : "Uses",
    "typeGroup" : "COMMON",
    "version" : 269100
  } ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}