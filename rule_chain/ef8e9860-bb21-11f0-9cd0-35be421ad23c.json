{
  "entityType" : "RULE_CHAIN",
  "entity" : {
    "additionalInfo" : {
      "description" : ""
    },
    "configuration" : null,
    "debugMode" : false,
    "externalId" : null,
    "firstRuleNodeId" : {
      "entityType" : "RULE_NODE",
      "id" : "34eed840-bb3e-11f0-9cd0-35be421ad23c"
    },
    "id" : {
      "entityType" : "RULE_CHAIN",
      "id" : "ef8e9860-bb21-11f0-9cd0-35be421ad23c"
    },
    "name" : "Messaging",
    "root" : false,
    "type" : "CORE"
  },
  "metaData" : {
    "connections" : [ {
      "fromIndex" : 0,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 0,
      "toIndex" : 9,
      "type" : "Success"
    }, {
      "fromIndex" : 2,
      "toIndex" : 0,
      "type" : "Success"
    }, {
      "fromIndex" : 2,
      "toIndex" : 3,
      "type" : "Success"
    }, {
      "fromIndex" : 2,
      "toIndex" : 5,
      "type" : "Success"
    }, {
      "fromIndex" : 2,
      "toIndex" : 10,
      "type" : "Success"
    }, {
      "fromIndex" : 2,
      "toIndex" : 11,
      "type" : "Success"
    }, {
      "fromIndex" : 2,
      "toIndex" : 12,
      "type" : "Success"
    }, {
      "fromIndex" : 2,
      "toIndex" : 14,
      "type" : "Success"
    }, {
      "fromIndex" : 3,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 5,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 5,
      "toIndex" : 9,
      "type" : "Success"
    }, {
      "fromIndex" : 7,
      "toIndex" : 8,
      "type" : "Success"
    }, {
      "fromIndex" : 8,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 9,
      "toIndex" : 7,
      "type" : "True"
    }, {
      "fromIndex" : 10,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 10,
      "toIndex" : 9,
      "type" : "Success"
    }, {
      "fromIndex" : 11,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 11,
      "toIndex" : 9,
      "type" : "Success"
    }, {
      "fromIndex" : 12,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 12,
      "toIndex" : 9,
      "type" : "Success"
    }, {
      "fromIndex" : 14,
      "toIndex" : 1,
      "type" : "Success"
    }, {
      "fromIndex" : 14,
      "toIndex" : 9,
      "type" : "Success"
    } ],
    "firstNodeIndex" : 2,
    "nodes" : [ {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 476,
        "layoutY" : 353
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var evento = msg.evento ? msg.evento.toString().toUpperCase() : \"\";\nvar tipo = msg.TIPO_EVENTO ? msg.TIPO_EVENTO.toString().toUpperCase() : \"\";\nvar timestamp = msg.TIMESTAMP;\nvar estacion = msg.estacion;\nvar linea = msg.linea;\nvar serie = msg.serie;\nvar modelo = msg.MODELO;\nvar cliente = msg.cliente;\nvar operario = msg.nombre_operario;\nvar nombre_estacion = msg.motivo;\nvar tiempo_estado = msg.tiempo_estado;\n\nif (evento === \"INICIO_EMERGENCIA\" && tipo === \"ACTIVADO\") {\n    metadata.evento = evento;\n    // para envio de correo\n    metadata.estacion = estacion;\n    metadata.linea = linea;\n    metadata.serie = serie;\n    metadata.cliente = cliente;\n    metadata.modelo = modelo;\n    metadata.nombre_estacion = nombre_estacion;\n    metadata.timestamp = timestamp;\n    if (Array.isArray(operario)) {\n        metadata.operario = operario.join(\", \");\n    } else {\n        metadata.operario = operario;\n    }\n    \n    var newMsg = {};\n    //newMsg.chat_id = -5056307782;\n    newMsg.chat_id = -5069003041;\n    newMsg.parse_mode = \"Markdown\";\n    newMsg.text =\n    \"üö® *ALERTA DE EMERGENCIA REPORTADA*\\n\" +\n    \"*FECHA Y HORA:* \" + timestamp + \"\\n\\n\" +\n    \"*L√çNEA DE ENSAMBLAJE:* \" + linea + \"\\n\" +\n    \"*N¬∞ ESTACI√ìN:* \" + estacion + \"\\n\" +\n    \"*NOMBRE DE ESTACI√ìN:* \" + nombre_estacion + \"\\n\" +\n    \"*SERIE:* \" + serie + \"\\n\" +\n    \"*MODELO:* \" + modelo + \"\\n\" +\n    \"*CLIENTE:* \" + cliente + \"\\n\" +\n    \"*OPERARIO(S):* \" + operario + \"\\n\";\n    return { msg: newMsg, metadata: metadata, msgType: msgType };\n}\n\nreturn { msg: {}, metadata: metadata, msgType: msgType };\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1763055364108,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "8dc79750-bb24-11f0-9cd0-35be421ad23c"
      },
      "name" : "Filter Emergency Mode Active",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1472,
        "layoutY" : 290
      },
      "configuration" : {
        "restEndpointUrlPattern" : "https://api.telegram.org/bot8246934751:AAFsNJfqIl_KK5dcxvD-KsbTvbUqbokdFbE/sendMessage",
        "requestMethod" : "POST",
        "useSimpleClientHttpFactory" : false,
        "parseToPlainText" : false,
        "ignoreRequestBody" : false,
        "enableProxy" : false,
        "useSystemProxyProperties" : false,
        "proxyScheme" : null,
        "proxyHost" : null,
        "proxyPort" : 0,
        "proxyUser" : null,
        "proxyPassword" : null,
        "readTimeoutMs" : 0,
        "maxParallelRequestsCount" : 0,
        "headers" : {
          "Content-Type" : "application/json"
        },
        "credentials" : {
          "type" : "anonymous"
        },
        "maxInMemoryBufferSizeInKb" : 256
      },
      "configurationVersion" : 3,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1763394573781,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "8dc7be60-bb24-11f0-9cd0-35be421ad23c"
      },
      "name" : "Send Message Telegram Emergency Mode",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.rest.TbRestApiCallNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 132,
        "layoutY" : 372
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1763156379547,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "34eed840-bb3e-11f0-9cd0-35be421ad23c"
      },
      "name" : "Connector",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 476,
        "layoutY" : 278
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var evento = msg.evento ? msg.evento.toString()\n    .toUpperCase() : \"\";\nvar tipo = msg.TIPO_EVENTO ? msg.TIPO_EVENTO.toString()\n    .toUpperCase() : \"\";\nvar timestamp = msg.TIMESTAMP || \"Sin fecha\";\nvar estacion = msg.estacion || \"Desconocida\";\nvar linea = msg.linea || \"Desconocida\";\nvar motivo = msg.motivo;\nvar operario = msg.nombre_operario || \"No registrado\";\nvar responsables_llamada = \"@JavierBautistaTovar @Franco_Alcantara @HC2902\";\n\nif (evento === \"LLAMAR_SUPERVISOR\" && tipo ===\n    \"APROBACION\") {\n    metadata.evento = evento;\n    var newMsg = {};\n    //newMsg.chat_id = -5056307782;\n    newMsg.chat_id = -5069003041;\n    newMsg.parse_mode = \"Markdown\";\n    newMsg.text =\n        newMsg.parse_mode = \"Markdown\";\n    newMsg.text =\n        \"üí¨ *SOLICITUD DE APROBACI√ìN*\\n\" +\n        \"*FECHA Y HORA:* \" + timestamp + \"\\n\\n\" +\n        \"*N¬∞ ESTACI√ìN:* \" + estacion + \"\\n\" +\n        \"*L√çNEA DE ENSAMBLAJE:* \" + linea +\"\\n\" +\n        \"*MOTIVO:*\" + motivo + \"\\n\\n\" +\n        \"*RESPONSABLE(S): *\" + responsables_llamada;\n\n\n    return {\n        msg: newMsg,\n        metadata: metadata,\n        msgType: msgType\n    };\n}\n\nif (evento === \"LLAMAR_SUPERVISOR\" && tipo ===\n    \"ASISTENCIA\") {\n    metadata.evento = evento;\n    var newMsg = {};\n    newMsg.chat_id = -5069003041;\n    newMsg.parse_mode = \"Markdown\";\n    newMsg.text =\n        \"üí¨ *ASISTENCIA EN ESTACI√ìN*\\n\" +\n        \"*FECHA Y HORA:* \" + timestamp + \"\\n\\n\" +\n        \"*N¬∞ ESTACI√ìN:* \" + estacion + \"\\n\" +\n        \"*L√çNEA DE ENSAMBLAJE:* \" + linea;\n\n    return {\n        msg: newMsg,\n        metadata: metadata,\n        msgType: msgType\n    };\n}\n\nreturn {\n    msg: {},\n    metadata: metadata,\n    msgType: msgType\n};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1763394324841,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "4c474130-bb3e-11f0-9cd0-35be421ad23c"
      },
      "name" : "Filter Request Supervisor",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1278,
        "layoutY" : 53
      },
      "configuration" : {
        "fromTemplate" : "alertas@smelpro.com",
        "toTemplate" : "ahlelycontreras.18.03@gmail.com",
        "ccTemplate" : null,
        "bccTemplate" : null,
        "subjectTemplate" : "L√çNEA ${linea}/ESTACI√ìN ${estacion} - Alerta de Emergencia Reportada",
        "mailBodyType" : "true",
        "bodyTemplate" : "<b>Notificaci√≥n de Emergencia Activada</b><br><br>\n\n<b>Fecha y hora:</b> ${timestamp}<br>\n<b>L√≠nea de Ensamblaje:</b> ${linea}<br>\n<b>N¬∞ Estaci√≥n:</b> ${estacion}<br>\n<b>Nombre de Estaci√≥n:</b> ${nombre_estacion}<br>\n<b>Serie:</b> ${serie}<br>\n<b>Modelo:</b> ${modelo}<br>\n<b>Cliente:</b> ${cliente}<br>\n<b>Operario(s):</b> ${operario}<br><br>\n\nSe ha registrado una condici√≥n de emergencia en la l√≠nea de producci√≥n.  \nPor favor, active los protocolos de seguridad correspondientes y comunique la situaci√≥n a las √°reas responsables para garantizar la continuidad y seguridad de las operaciones.<br><br>\n\n<hr>\n<table style=\"width:100%; font-family: Arial, sans-serif; border-collapse: collapse;\">\n  <tr>\n    <td style=\"width: 30%; vertical-align: middle; text-align: center; padding: 8px 0px 8px 8px;\">\n      <img src=\"https://dashboard.smelpro.com/api/images/public/v1mP9x41vsyDPellTLD3yI337oOprK00\" alt=\"Logo empresarial-01-02.png\" style=\"max-width: 180px;\" />\n    </td>\n    <td style=\"width: 70%; vertical-align: middle; text-align: left; padding: 8px; 8px 8px 0px\">\n      <b>Soporte Smelpro</b><br>\n      Direcci√≥n: Calle Hefesto 499, Oficina 502, Ate, Lima, Per√∫<br>\n      Tel√©f.: +51 1 3226467<br>\n      Cel.: +51 923265572 / 927347035 / 963409900<br><br>\n      <small>Este es un mensaje autom√°tico generado por el sistema de monitoreo IoT Smelpro - No responder este correo.</small>\n    </td>\n  </tr>\n</table>\n"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "863b4190-bb55-11f0-9cd0-35be421ad23c"
      },
      "name" : "Alert Email",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.mail.TbMsgToEmailNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 476,
        "layoutY" : 430
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var evento = msg.evento ? msg.evento.toString().toUpperCase() : \"\";\nvar tipo = msg.TIPO_EVENTO ? msg.TIPO_EVENTO.toString().toUpperCase() : \"\";\nvar timestamp = msg.TIMESTAMP;\nvar estacion = msg.estacion;\nvar linea = msg.linea;\nvar serie = msg.serie;\nvar modelo = msg.MODELO;\nvar cliente = msg.cliente;\nvar operario = msg.nombre_operario;\nvar nombre_estacion = msg.motivo;\nvar tiempo_estado = msg.tiempo_estado;\n\nif (evento == \"FIN_EMERGENCIA\" && tipo==\"DESACTIVADO\"){\n    metadata.evento = evento;\n    var newMsg = {};\n    //newMsg.chat_id = -5056307782;\n    newMsg.chat_id = -5069003041;\n    newMsg.parse_mode = \"Markdown\";\n    newMsg.text =\n    \"‚úÖ *EMERGENCIA RESUELTA*\\n\" +\n    \"*FECHA Y HORA:* \" + timestamp + \"\\n\" +\n    \"*TIEMPO EN ESTADO DE EMERGENCIA:* \" + tiempo_estado + \"\\n\\n\" +\n    \"*L√çNEA DE ENSAMBLAJE:* \" + linea + \"\\n\" +\n    \"*N¬∞ ESTACI√ìN:* \" + estacion + \"\\n\" +\n    \"*NOMBRE DE ESTACI√ìN:* \" + nombre_estacion + \"\\n\" +\n    \"*SERIE:* \" + serie + \"\\n\" +\n    \"*MODELO:* \" + modelo + \"\\n\" +\n    \"*CLIENTE:* \" + cliente + \"\\n\" +\n    \"*OPERARIO(S):* \" + operario + \"\\n\";\n    return { msg: newMsg, metadata: metadata, msgType: msgType };\n}\n\nreturn { msg: {}, metadata: metadata, msgType: msgType };\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1763055364108,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "863b4191-bb55-11f0-9cd0-35be421ad23c"
      },
      "name" : "Filter Emergency Mode Inactive",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1514,
        "layoutY" : 54
      },
      "configuration" : {
        "useSystemSmtpSettings" : true,
        "smtpHost" : "localhost",
        "smtpPort" : 25,
        "username" : null,
        "password" : null,
        "smtpProtocol" : "smtp",
        "timeout" : 10000,
        "enableTls" : false,
        "tlsVersion" : "TLSv1.2",
        "enableProxy" : false,
        "proxyHost" : null,
        "proxyPort" : null,
        "proxyUser" : null,
        "proxyPassword" : null
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "c1730e90-bb56-11f0-9cd0-35be421ad23c"
      },
      "name" : "Send Alert Email",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.mail.TbSendEmailNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1325,
        "layoutY" : 579
      },
      "configuration" : {
        "restEndpointUrlPattern" : "http://dashboard.smelpro.com/api/alarms?pageSize=100&page=0&searchStatus=ACTIVE",
        "requestMethod" : "GET",
        "useSimpleClientHttpFactory" : false,
        "parseToPlainText" : false,
        "ignoreRequestBody" : false,
        "enableProxy" : false,
        "useSystemProxyProperties" : false,
        "proxyScheme" : null,
        "proxyHost" : null,
        "proxyPort" : 0,
        "proxyUser" : null,
        "proxyPassword" : null,
        "readTimeoutMs" : 0,
        "maxParallelRequestsCount" : 0,
        "headers" : {
          "Content-Type" : "application/json",
          "X-Authorization" : "Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJtb2Rhc2FAc21lbHByby5jb20iLCJ1c2VySWQiOiI3YzRjMmFkMC04ZjFmLTExZjAtYTYxYy0wMWUwYzg1ZmQ1ZGQiLCJzY29wZXMiOlsiVEVOQU5UX0FETUlOIl0sInNlc3Npb25JZCI6ImIwNGRhMTU2LTVjYzEtNDk5YS1iOTA3LWEyZWE0NTZkNjU5YSIsImV4cCI6MTc2MzQwMTA0OCwiaXNzIjoidGhpbmdzYm9hcmQuaW8iLCJpYXQiOjE3NjMzOTIwNDgsImVuYWJsZWQiOnRydWUsImlzUHVibGljIjpmYWxzZSwidGVuYW50SWQiOiI2N2E0MTRkMC04ZjFmLTExZjAtYTYxYy0wMWUwYzg1ZmQ1ZGQiLCJjdXN0b21lcklkIjoiMTM4MTQwMDAtMWRkMi0xMWIyLTgwODAtODA4MDgwODA4MDgwIn0.QsLVAUf84jMCZmgvYYRGRsZWWJLddca32BPA-7wnx0XarYoec-14VVdooaptRRxL8xsunz1Y8eOwlPlCqg_o5w"
        },
        "credentials" : {
          "type" : "anonymous"
        },
        "maxInMemoryBufferSizeInKb" : 256
      },
      "configurationVersion" : 3,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1763057632218,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "1515efc0-c0b8-11f0-9cd0-35be421ad23c"
      },
      "name" : "Get alarms",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.rest.TbRestApiCallNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1378,
        "layoutY" : 454
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var data = msg.data ? msg.data : [];\n\nif (typeof data === \"string\") {\n    try {\n        data = JSON.parse(data);\n    } catch (e) {\n        data = [];\n    }\n}\n\nif (data && data.data) {\n    data = data.data;\n}\n\nvar total = data.length;\nvar lineas = {}; // { linea: [estaciones] }\n\nfor (var i = 0; i < total; i++) {\n    var alarm = data[i];\n    var nombre = alarm.originatorName || \"\";\n\n    var partes = nombre.split(\" \");\n    if (partes.length >= 2) {\n        var numeros = partes[1].split(\".\");\n        var linea = \"L√≠nea \" + (numeros[0] || \"?\");\n        var estacion = \"Estaci√≥n \" + (numeros[1] || \"?\");\n\n        if (!lineas[linea]) lineas[linea] = [];\n        lineas[linea].push(estacion);\n    }\n}\n\nvar texto = \"\";\nif (total > 0) {\n    texto = \"*üö® Alertas activas: \" + total + \"*\\n\\n\";\n    for (var linea in lineas) {\n        texto += \"*\" + linea + \"* ‚Üí \" + lineas[linea].join(\", \") + \"\\n\";\n    }\n} else {\n    texto = \"‚úÖ *No hay alertas activas actualmente.*\";\n}\n\nvar newMsg = {};\nnewMsg.chat_id = -5069003041;  \nnewMsg.parse_mode = \"Markdown\";\nnewMsg.text = texto;\n\nreturn { msg: newMsg, metadata: metadata, msgType: msgType };\n",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1763056679786,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "28953d30-c0b8-11f0-9cd0-35be421ad23c"
      },
      "name" : "Get alarms active",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 1015,
        "layoutY" : 581
      },
      "configuration" : {
        "scriptLang" : "TBEL",
        "jsScript" : "return msg.temperature > 20;",
        "tbelScript" : "return metadata.evento == \"INICIO_EMERGENCIA\" || metadata.evento == \"FIN_EMERGENCIA\" || metadata.evento == \"INICIO_PARADA\" || metadata.evento == \"FIN_PARADA\" || metadata.evento == \"LLAMAR_SUPERVISOR\" || metadata.evento == \"REQUIERE_INSPECCION\" || metadata.evento == \"FIN_ALERTA_INSPECCION\";"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : null,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "e9aa59a0-c0be-11f0-9cd0-35be421ad23c"
      },
      "name" : "Filter Message - Alarmas Activas",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsFilterNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 477,
        "layoutY" : 129
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var evento = msg.evento ? msg.evento.toString().toUpperCase() : \"\";\nvar timestamp = msg.TIMESTAMP || new Date().toISOString();\nvar estacion = msg.estacion || \"-\";\nvar linea = msg.linea || \"-\";\nvar serie = msg.serie || \"-\";\nvar modelo = msg.MODELO || \"-\";\nvar cliente = msg.cliente || \"-\";\nvar operario = msg.nombre_operario || \"-\";\nvar causa = msg.causa || [];\n\n// Funci√≥n para asignar responsable\n/*\nfunction obtenerResponsable(categoria) {\n    var c = (categoria || \"\").toString().toUpperCase();\n\n    if (c === \"PROBLEMA DE ENSAMBLAJE\") {\n        return \"@diego_roca\";\n    }else if (c === \"INSTRUCTIVO REQUIERE REVISI√ìN\"){\n        return \"@fiamahle\"\n    }else if (c === \"LISTA DE ESPECIFICACIONES REQUIERE REVISI√ìN\"){\n        return \"@diego_roca\"\n    }else if (c === \"PROBLEMA DE SUMINISTRO\"){\n        return \"@fiamahle\"\n    }else if (c === \"PROBLEMA DE PRUEBA\"){\n        return \"@diego_roca\"\n    }else if (c === \"ESPACIO NO DISPONIBLE PARA ABASTECIMIENTO\"){\n        return \"@fiamahle\"\n    }else if (c === \"OTRO\"){\n        return \"@diego_roca\"\n    }\n\n    // Default\n    return \"@fiamahle\";\n}\n*/\n\n\nfunction obtenerResponsable(categoria,subcategoria, detalle){\n    var c = (categoria || \"\").toString().toUpperCase();\n    var s = (subcategoria || \"\").toString().toUpperCase();\n    var d = (detalle || \"\").toString().toUpperCase();\n    \n    if (c === \"PROBLEMA DE ENSAMBLAJE\"){\n        if (s === \"PIEZAS DA√ëADAS O NO ENCAJAN\"){\n            if (d === \"DEFECTO DE FABRICACION\"){\n                return \"@JavierBautistaTovar\"\n            }else if (d === \"DEFECTO DE INGENIER√çA\"){\n                return \"@ErwinHCH @Osabber @Ocastro2025\"\n            }else if (d === \"DEFECTO DE PINTURA\"){\n                return \"@ROGERNIETO\"\n            }\n        }\n        \n        if (s === \"FALTA DE HERRAMIENTAS\"){\n            if (d === \"NO HAY POR CALIBRACI√ìN\"){\n                return \"@PENDIENTE\"\n            }else if (d === \"NO HAY POR DETERIORO\"){\n                return \"@PENDIENTE\"\n            }else if (d === \"NO HAY POR ABASTECIMIENTO\"){\n                return \"@PENDIENTE\"\n            }\n        }\n        \n        if (s === \"FALTA DE COMPONENTES (PIEZAS FABRICADAS)\"){\n            if (d === \"NO EST√Å FABRICADO\"){\n                return \"@JavierBautistaTovar @Ecarranza21\"\n            }else if (d === \"NO EST√Å ABASTECIDO\"){\n                return \"@JavierBautistaTovar @Ecarranza21\"\n            }\n        }\n        \n        if (s === \"FALTA DE MATERIAL (PIEZAS COMPRADAS)\"){\n            if (d === \"NO HAY EN STOCK\"){\n                return \"@edpgs @andreams25\"\n            }else if (d === \"NO EST√Å ABASTECIDO\"){\n                return \"@PENDIENTE\"\n            }\n        }\n        \n    }else if (c === \"INSTRUCTIVO REQUIERE REVISI√ìN\"){\n        return \"@ErwinHCH @Osabber @Ocastro2025 @VPW35 @PENDIENTE\"\n            \n            \n    }else if (c === \"LISTA DE ESPECIFICACIONES REQUIERE REVISI√ìN\"){\n        return \"@HC2902 @melanibelen10\"\n    \n        \n    }else if (c === \"PROBLEMA DE SUMINISTRO (CONSUMIBLES L√çQUIDOS)\"){\n        if (d === \"SISTEMA INOPERATIVO\"){\n            return \"@Ferdinandstone\"\n        }else if (d === \"NO HAY EN STOCK\"){\n            return \"@edpgs @lfernandez3\"\n        }\n    \n        \n    }else if (c === \"PROBLEMA DE PRUEBA\"){\n        if(d === \"BANCOS INOPERATIVOS\"){\n            return \"@Ferdinandstone\"\n        }else if (d === \"COMPONENTE DA√ëADO (GARANT√çA)\"){\n            return \"@InstructorMP05\"\n        }else if (d === \"FALTA DE HERRAMIENTAS\"){\n            return \"@PENDIENTE\"\n        }\n    \n        \n    }else if (c === \"ESPACIO NO DISPONIBLE PARA ABASTECIMIENTO\"){\n        return \"@JavierBautistaTovar\"\n    \n        \n    }else if (c === \"OTRO\"){\n        return \"@Franco_Alcantara\"\n    }\n \n    \n}\n\nif (evento === \"INICIO_PARADA\") {\n    metadata.evento = evento;\n    // Obtener causa: categoria, sucategoria y detalle\n    var causasTexto = \"\";\n    if (Array.isArray(causa) && causa.length > 0) {\n        causa.forEach(function(c, i) {\n            causasTexto += \"CAUSA \" +\n                \":\\n\";\n            causasTexto += \"‚Ä¢ Categor√≠a: \" + (c\n                .categoria || \"-\") + \"\\n\";\n            causasTexto += \"‚Ä¢ Subcategor√≠a: \" + (c\n                .subcategoria || \"-\") + \"\\n\";\n            causasTexto += \"‚Ä¢ Detalle: \" + (c\n                .detalle || \"-\") + \"\\n\\n\";\n        });\n    } else {\n        causasTexto = \"_Sin causas detalladas_\\n\\n\";\n    }\n\n    // responsable por primera causa\n    var responsable = \"\";\n    //if (causa.length > 0) responsable = obtenerResponsable(\n      //  causa[0].categoria);\n        \n    if (causa.length > 0) {\n    responsable = obtenerResponsable(\n        causa[0].categoria,\n        causa[0].subcategoria,\n        causa[0].detalle\n    );\n}\n\n\n    // Operario a texto simple\n    var operarioStr = Array.isArray(operario) ? operario\n        .join(\", \") : operario;\n\n    metadata.estacion = estacion;\n    metadata.linea = linea;\n    metadata.serie = serie;\n    metadata.cliente = cliente;\n    metadata.modelo = modelo;\n    metadata.operario = operarioStr;\n    metadata.timestamp = timestamp;\n    metadata.responsable = responsable;\n\n    var newMsg = {};\n    newMsg.chat_id = -5069003041;\n    newMsg.parse_mode = \"Markdown\";\n\n    function escapeMarkdown(text) {\n        if (!text) return \"\"; // null o undefined\n        text = text.toString(); \n        return text.replace(/([_*[\\]()~>])/g, \"\\\\$1\");\n    }\n\n    newMsg.text =\n        \"‚ö†Ô∏è *INICIO DE PARADA REGISTRADO*\\n\" +\n        \"*FECHA Y HORA:* \" + escapeMarkdown(timestamp) +\n        \"\\n\\n\" +\n        \"*L√çNEA:* \" + escapeMarkdown(linea) + \"\\n\" +\n        \"*ESTACI√ìN:* \" + escapeMarkdown(estacion) + \"\\n\" +\n        \"*SERIE:* \" + escapeMarkdown(serie) + \"\\n\" +\n        \"*MODELO:* \" + escapeMarkdown(modelo) + \"\\n\" +\n        \"*CLIENTE:* \" + escapeMarkdown(cliente) + \"\\n\" +\n        \"*OPERARIO(S):* \" + escapeMarkdown(operarioStr) +\n        \"\\n\\n\" +\n        \"*‚õî DETALLE DE CAUSA: *\\n\" +\n        escapeMarkdown(causasTexto) +\n        \"*Responsable(s) asignado(s):* \" + escapeMarkdown(\n            responsable);\n\n\n    return {\n        msg: newMsg,\n        metadata: metadata,\n        msgType: msgType\n    };\n}",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 1763156379547,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7e2bc580-c18e-11f0-9cd0-35be421ad23c"
      },
      "name" : "Filter Inicio Parada",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 477,
        "layoutY" : 206
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var evento = msg.evento ? msg.evento.toString().toUpperCase() : \"\";\nvar timestamp = msg.TIMESTAMP || new Date().toISOString();\nvar estacion = msg.estacion || \"-\";\nvar linea = msg.linea || \"-\";\nvar serie = msg.serie || \"-\";\nvar modelo = msg.MODELO || \"-\";\nvar cliente = msg.cliente || \"-\";\nvar operario = msg.nombre_operario || \"-\";\nvar causa = msg.causa || [];\nvar tiempo_estado = msg.tiempo_estado;\n\n\nif (evento === \"FIN_PARADA\") {\n    metadata.evento = evento;\n    // Obtener causa: categoria, sucategoria y detalle\n    var causasTexto = \"\";\n    if (Array.isArray(causa) && causa.length > 0) {\n        causa.forEach(function(c, i) {\n            causasTexto += \"CAUSA \" +\n                \":\\n\";\n            causasTexto += \"‚Ä¢ Categor√≠a: \" + (c\n                .categoria || \"-\") + \"\\n\";\n            causasTexto += \"‚Ä¢ Subcategor√≠a: \" + (c\n                .subcategoria || \"-\") + \"\\n\";\n            causasTexto += \"‚Ä¢ Detalle: \" + (c\n                .detalle || \"-\") + \"\\n\\n\";\n        });\n    } else {\n        causasTexto = \"_Sin causas detalladas_\\n\\n\";\n    }\n\n    // Operario a texto simple\n    var operarioStr = Array.isArray(operario) ? operario\n        .join(\", \") : operario;\n\n    metadata.estacion = estacion;\n    metadata.linea = linea;\n    metadata.serie = serie;\n    metadata.cliente = cliente;\n    metadata.modelo = modelo;\n    metadata.operario = operarioStr;\n    metadata.timestamp = timestamp;\n\n    var newMsg = {};\n    newMsg.chat_id = -5069003041;\n    newMsg.parse_mode = \"Markdown\";\n\n    function escapeMarkdown(text) {\n        if (!text) return \"\"; // null o undefined\n        text = text.toString(); \n        return text.replace(/([_*[\\]()~>])/g, \"\\\\$1\");\n    }\n\n    newMsg.text =\n        \"‚úÖ *PARADA RESUELTA*\\n\" +\n        \"*FECHA Y HORA:* \" + escapeMarkdown(timestamp) +\"\\n\" +\n        \"*TIEMPO EN ESTADO DE PARADA* \" + tiempo_estado +\n        \"\\n\\n\" +\n        \"*L√çNEA:* \" + escapeMarkdown(linea) + \"\\n\" +\n        \"*ESTACI√ìN:* \" + escapeMarkdown(estacion) +\n        \"\\n\\n\" +\n        \"*‚õî DETALLE DE CAUSA REAL: *\\n\" +\n        escapeMarkdown(causasTexto);\n\n\n    return {\n        msg: newMsg,\n        metadata: metadata,\n        msgType: msgType\n    };\n}",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "dec69940-c1a4-11f0-9cd0-35be421ad23c"
      },
      "name" : "Filter Fin Parada",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 476,
        "layoutY" : 508
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var evento = msg.evento ? msg.evento.toString().toUpperCase() : \"\";\nvar timestamp = msg.TIMESTAMP || new Date().toISOString();\nvar estacion = msg.estacion || \"-\";\nvar linea = msg.linea || \"-\";\nvar serie = msg.serie || \"-\";\nvar modelo = msg.MODELO || \"-\";\nvar cliente = msg.cliente || \"-\";\nvar operario = msg.nombre_operario || \"-\";\nvar causa = msg.causa || [];\nvar estado = msg.estado || [];\nvar responsables = \"@PENDIENTE @PENDIENTE\";\n\nif (evento === \"REQUIERE_INSPECCION\") {\n    metadata.evento = evento;\n\n    // Operario a texto simple\n    var operarioStr = Array.isArray(operario) ? operario\n        .join(\", \") : operario;\n\n    metadata.estacion = estacion;\n    metadata.linea = linea;\n    metadata.serie = serie;\n    metadata.cliente = cliente;\n    metadata.modelo = modelo;\n    metadata.operario = operarioStr;\n    metadata.timestamp = timestamp;\n\n    var newMsg = {};\n    newMsg.chat_id = -5069003041;\n    newMsg.parse_mode = \"Markdown\";\n\n    function escapeMarkdown(text) {\n        if (!text) return \"\"; // null o undefined\n        text = text.toString(); \n        return text.replace(/([_*[\\]()~>])/g, \"\\\\$1\");\n    }\n\n    newMsg.text =\n        \"üîç *SE REQUIERE INSPECCI√ìN*\\n\" +\n        \"*FECHA Y HORA:* \" + escapeMarkdown(timestamp) +\n        \"\\n\\n\" +\n        \"*L√çNEA:* \" + escapeMarkdown(linea) + \"\\n\" +\n        \"*ESTACI√ìN:* \" + escapeMarkdown(estacion) + \"\\n\" +\n        \"*ESTADO: *\" + escapeMarkdown(estado) + \"\\n\" +\n        \"*SERIE:* \" + escapeMarkdown(serie) + \"\\n\" +\n        \"*MODELO:* \" + escapeMarkdown(modelo) + \"\\n\" +\n        \"*CLIENTE:* \" + escapeMarkdown(cliente) + \"\\n\" +\n        \"*OPERARIO(S):* \" + escapeMarkdown(operarioStr) + \"\\n\\n\" +\n        \"*Responsable(s) asignado(s):* \" + escapeMarkdown(responsables);\n\n\n    return {\n        msg: newMsg,\n        metadata: metadata,\n        msgType: msgType\n    };\n}",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "2ab84d90-c3d4-11f0-9cd0-35be421ad23c"
      },
      "name" : "Filter Requiere Inspeccion",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 490,
        "layoutY" : 720
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var evento = msg.evento ? msg.evento.toString().toUpperCase() : \"\";\nvar timestamp = msg.TIMESTAMP || new Date().toISOString();\nvar estacion = msg.estacion || \"-\";\nvar linea = msg.linea || \"-\";\nvar serie = msg.serie || \"-\";\nvar modelo = msg.MODELO || \"-\";\nvar cliente = msg.cliente || \"-\";\nvar operario = msg.nombre_operario || \"-\";\nvar causa = msg.causa || [];\nvar tiempo_estado = msg.tiempo_estado;\n\n\nif (evento === \"FIN_ALERTA_INSPECCION\") {\n    metadata.evento = evento;\n    // Operario a texto simple\n    var operarioStr = Array.isArray(operario) ? operario\n        .join(\", \") : operario;\n\n    metadata.estacion = estacion;\n    metadata.linea = linea;\n    metadata.serie = serie;\n    metadata.cliente = cliente;\n    metadata.modelo = modelo;\n    metadata.operario = operarioStr;\n    metadata.timestamp = timestamp;\n\n    var newMsg = {};\n    newMsg.chat_id = -5069003041;\n    newMsg.parse_mode = \"Markdown\";\n\n    function escapeMarkdown(text) {\n        if (!text) return \"\"; // null o undefined\n        text = text.toString(); \n        return text.replace(/([_*[\\]()~>])/g, \"\\\\$1\");\n    }\n\n    newMsg.text =\n        \"‚úÖ *INSPECCI√ìN TERMINADA*\\n\" +\n        \"*FECHA Y HORA:* \" + escapeMarkdown(timestamp) +\"\\n\" +\n        \"*TIEMPO EN ESTADO DE INSPECCION* \" + tiempo_estado +\n        \"\\n\\n\" +\n        \"*L√çNEA:* \" + escapeMarkdown(linea) + \"\\n\" +\n        \"*ESTACI√ìN:* \" + escapeMarkdown(estacion);\n\n\n    return {\n        msg: newMsg,\n        metadata: metadata,\n        msgType: msgType\n    };\n}",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "2ab84d91-c3d4-11f0-9cd0-35be421ad23c"
      },
      "name" : "Filter Fin Alerta Inspeccion",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 477,
        "layoutY" : 582
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var evento = msg.evento ? msg.evento.toString().toUpperCase() : \"\";\nvar timestamp = msg.TIMESTAMP || new Date().toISOString();\nvar estacion = msg.estacion || \"-\";\nvar linea = msg.linea || \"-\";\nvar serie = msg.serie || \"-\";\nvar modelo = msg.MODELO || \"-\";\nvar cliente = msg.cliente || \"-\";\nvar operario = msg.nombre_operario || \"-\";\nvar causa = msg.causa || [];\nvar estado = msg.estado || [];\nvar responsables = \"@PENDIENTE @PENDIENTE\";\n\nif (evento === \"REQUIERE_LEVANTAMIENTO\") {\n    metadata.evento = evento;\n\n    // Operario a texto simple\n    var operarioStr = Array.isArray(operario) ? operario\n        .join(\", \") : operario;\n\n    metadata.estacion = estacion;\n    metadata.linea = linea;\n    metadata.serie = serie;\n    metadata.cliente = cliente;\n    metadata.modelo = modelo;\n    metadata.operario = operarioStr;\n    metadata.timestamp = timestamp;\n\n    var newMsg = {};\n    newMsg.chat_id = -5069003041;\n    newMsg.parse_mode = \"Markdown\";\n\n    function escapeMarkdown(text) {\n        if (!text) return \"\"; // null o undefined\n        text = text.toString(); \n        return text.replace(/([_*[\\]()~>])/g, \"\\\\$1\");\n    }\n\n    newMsg.text =\n        \"üó£ *SE REQUIERE LEVANTAMIENTO*\\n\" +\n        \"*FECHA Y HORA:* \" + escapeMarkdown(timestamp) +\n        \"\\n\\n\" +\n        \"*L√çNEA:* \" + escapeMarkdown(linea) + \"\\n\" +\n        \"*ESTACI√ìN:* \" + escapeMarkdown(estacion) + \"\\n\" +\n        \"*ESTADO: *\" + escapeMarkdown(estado) + \"\\n\" +\n        \"*SERIE:* \" + escapeMarkdown(serie) + \"\\n\" +\n        \"*MODELO:* \" + escapeMarkdown(modelo) + \"\\n\" +\n        \"*CLIENTE:* \" + escapeMarkdown(cliente) + \"\\n\" +\n        \"*OPERARIO(S):* \" + escapeMarkdown(operarioStr) + \"\\n\\n\" +\n        \"*Responsable(s) asignado(s):* \" + escapeMarkdown(responsables);\n\n\n    return {\n        msg: newMsg,\n        metadata: metadata,\n        msgType: msgType\n    };\n}",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugSettings" : {
        "allEnabled" : false,
        "allEnabledUntil" : 0,
        "failuresEnabled" : true
      },
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "d66c4380-c4a6-11f0-9cd0-35be421ad23c"
      },
      "name" : "Filter Requiere Levantamiento",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    } ],
    "ruleChainConnections" : null
  },
  "relations" : [ {
    "additionalInfo" : null,
    "from" : {
      "entityType" : "RULE_CHAIN",
      "id" : "67a610a0-8f1f-11f0-a61c-01e0c85fd5dd"
    },
    "to" : {
      "entityType" : "RULE_CHAIN",
      "id" : "ef8e9860-bb21-11f0-9cd0-35be421ad23c"
    },
    "type" : "Uses",
    "typeGroup" : "COMMON",
    "version" : 210366
  } ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}