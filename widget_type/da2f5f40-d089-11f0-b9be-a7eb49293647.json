{
  "entityType" : "WIDGET_TYPE",
  "entity" : {
    "fqn" : "percentage_bar",
    "name" : "Percentage Bar",
    "deprecated" : false,
    "image" : null,
    "description" : null,
    "descriptor" : {
      "type" : "latest",
      "sizeX" : 9.5,
      "sizeY" : 3,
      "resources" : [ ],
      "templateHtml" : "<div class=\"percent-widget-card\">\r\n\r\n    <div class=\"percent-widget-value\">-</div>\r\n\r\n    <div class=\"percent-widget-bar-bg\">\r\n        <div class=\"percent-widget-bar-fill\"></div>\r\n    </div>\r\n\r\n</div>\r\n",
      "templateCss" : ".percent-widget-card {\r\n    width: 100%;\r\n    height: 100%;\r\n    border-radius: 10px;\r\n\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: center;\r\n    align-items: center;\r\n\r\n    padding: 10px;\r\n    text-align: center;\r\n    font-family: inherit;\r\n}\r\n\r\n.percent-widget-value {\r\n    font-size: 28px;\r\n    font-weight: 600;\r\n    margin-bottom: 12px;\r\n\r\n    width: 100%;          /* same width as the bar */\r\n    text-align: left;    /* left-align the text */\r\n    margin-left: auto;   /* centers the block so its left aligns with bar */\r\n    margin-right: auto;  /* same */\r\n}\r\n\r\n\r\n\r\n.percent-widget-bar-bg {\r\n    width: 100%;\r\n    height: 12px;\r\n    background: #e0e0e0;\r\n    border-radius: 6px;\r\n    overflow: hidden;\r\n}\r\n\r\n.percent-widget-bar-fill {\r\n    height: 100%;\r\n    width: 0%;\r\n    transition: width 0.35s ease;\r\n    border-radius: 6px;\r\n}\r\n",
      "controllerScript" : "self.onInit = function () {\r\n    const ctx = self.ctx;\r\n\r\n    ctx.unit = ctx.settings.unit || '%';\r\n    ctx.color = ctx.settings.color || '#000000';\r\n\r\n    // Apply initial bar color\r\n    ctx.$container.find('.percent-widget-bar-fill')\r\n        .css('background', ctx.color);\r\n        \r\n    // Apply initial number color\r\n    ctx.$container.find('.percent-widget-value')\r\n        .css('color', ctx.color);\r\n};\r\n\r\nself.onDataUpdated = function () {\r\n    const ctx = self.ctx;\r\n    const data = ctx.data;\r\n\r\n    if (!data?.length || !data[0].data?.length) return;\r\n\r\n    let raw1 = data[0].data[0][1] || 0;\r\n    let raw2 = data[1].data[0][1] || 0;\r\n\r\n    if (raw2 === 0) {\r\n        raw1 = 0;\r\n        raw2 = 1;\r\n    }\r\n    \r\n    //console.log(\"valor 1: \", raw1, \"valor 2: \", raw2);\r\n\r\n    let value = (100 * raw1 / raw2).toFixed(1);\r\n\r\n    // Clamp between 0 and 100\r\n    const percent = Math.min(100, Math.max(0, value));\r\n\r\n    // Update numeric value\r\n    ctx.$container.find('.percent-widget-value').text(`${percent}${ctx.unit}`);\r\n\r\n    // Smoothly animate progress fill\r\n    ctx.$container.find('.percent-widget-bar-fill')\r\n        .css('width', percent + '%');\r\n};\r\n\r\nself.onResize = function () {\r\n    const ctx = self.ctx;\r\n    const card = ctx.$container.find('.percent-widget-card')[0];\r\n    if (!card) return;\r\n\r\n    const h = card.offsetHeight;\r\n    const valueSize = h * 0.25;\r\n\r\n    // Adjust font size dynamically\r\n    ctx.$container.find('.percent-widget-value')\r\n        .css('font-size', `${valueSize}px`);\r\n};\r\n",
      "settingsForm" : [ {
        "id" : "icon",
        "name" : "Icon",
        "hint" : "icon-hint",
        "group" : "Appereance",
        "type" : "icon",
        "default" : "mdi:counter",
        "required" : true
      }, {
        "id" : "color",
        "name" : "Color",
        "hint" : "color-hint",
        "group" : "Appereance",
        "type" : "color",
        "default" : "#000",
        "required" : true
      }, {
        "id" : "unit",
        "name" : "Unit",
        "hint" : "unit-hint",
        "group" : "Appereance",
        "type" : "units",
        "default" : "%",
        "supportsUnitConversion" : false
      } ],
      "settingsDirective" : "",
      "defaultConfig" : "{\"showTitle\":true,\"backgroundColor\":\"rgb(255, 255, 255)\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{\"icon\":\"mdi:counter\",\"color\":\"#000000\",\"unit\":\"%\"},\"title\":\"Percentage Bar\",\"dropShadow\":true,\"showTitleIcon\":false,\"titleTooltip\":\"\",\"enableFullscreen\":true,\"widgetStyle\":{},\"widgetCss\":\"\",\"titleStyle\":{\"fontSize\":\"24px\",\"fontWeight\":700},\"pageSize\":1024,\"noDataDisplayMessage\":\"\",\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Sin\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.5775934452579587,\"funcBody\":\"return Math.round(1000*Math.sin(time/5000));\",\"aggregationType\":null,\"units\":\"%\",\"decimals\":null,\"usePostProcessing\":null,\"postFuncBody\":null},{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Cos\",\"color\":\"#4caf50\",\"settings\":{},\"_hash\":0.1475088826190062,\"funcBody\":\"return Math.round(1000*Math.cos(time/5000));\"}],\"alarmFilterConfig\":{\"statusList\":[\"ACTIVE\"]}}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"useDashboardTimewindow\":true,\"displayTimewindow\":true}"
    },
    "externalId" : null,
    "resources" : null,
    "id" : {
      "entityType" : "WIDGET_TYPE",
      "id" : "da2f5f40-d089-11f0-b9be-a7eb49293647"
    },
    "scada" : false,
    "tags" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}