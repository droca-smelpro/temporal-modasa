{
  "entityType" : "WIDGET_TYPE",
  "entity" : {
    "fqn" : "control",
    "name" : "Control",
    "deprecated" : false,
    "image" : null,
    "description" : null,
    "descriptor" : {
      "type" : "timeseries",
      "sizeX" : 9,
      "sizeY" : 4,
      "resources" : [ ],
      "templateHtml" : "<div class=\"custom-gen-widget\"\r\n    style=\"display: flex; flex-direction: column; height: 100%;\">\r\n\r\n\r\n    <div\r\n        style=\"flex: 1; background-color: #00000020; display: flex; flex-direction: column; padding: 12px; overflow: hidden;\">\r\n\r\n        <div\r\n            style=\"flex: 1; display: flex; justify-content: space-evenly; align-items: center; flex-wrap: wrap;\">\r\n            \r\n            \r\n            <div style=\"display: flex; flex-direction: column; align-items: center; margin: 0 4px;\">\r\n                <button mat-raised-button\r\n                    [ngStyle]=\"{'background-color': buttonColors?.e0}\"\r\n                    style=\"min-width:40px; padding:0; font-weight:bold;\"\r\n                    (click)=\"e1()\">\r\n                    <mat-icon style=\"margin-left:4px;\">keyboard</mat-icon>\r\n                </button>\r\n                <label style=\"font-size: 12px; margin-top: 4px;\">E0</label>\r\n            </div>\r\n            \r\n            <div style=\"display: flex; flex-direction: column; align-items: center; margin: 0 4px;\">\r\n                <button mat-raised-button\r\n                    [ngStyle]=\"{'background-color': buttonColors?.e1}\"\r\n                    style=\"min-width:40px; padding:0; font-weight:bold;\"\r\n                    (click)=\"e1()\">\r\n                    <mat-icon style=\"margin-left:4px;\">keyboard</mat-icon>\r\n                </button>\r\n                <label style=\"font-size: 12px; margin-top: 4px;\">E1</label>\r\n            </div>\r\n            \r\n            <div style=\"display: flex; flex-direction: column; align-items: center; margin: 0 4px;\">\r\n                <button mat-raised-button\r\n                    [ngStyle]=\"{'background-color': buttonColors?.e2}\"\r\n                    style=\"min-width:40px; padding:0; font-weight:bold;\"\r\n                    (click)=\"e1()\">\r\n                    <mat-icon style=\"margin-left:4px;\">keyboard</mat-icon>\r\n                </button>\r\n                <label style=\"font-size: 12px; margin-top: 4px;\">E2</label>\r\n            </div>\r\n            \r\n            <div style=\"display: flex; flex-direction: column; align-items: center; margin: 0 4px;\">\r\n                <button mat-raised-button\r\n                    [ngStyle]=\"{'background-color': buttonColors?.e3}\"\r\n                    style=\"min-width:40px; padding:0; font-weight:bold;\"\r\n                    (click)=\"e1()\">\r\n                    <mat-icon style=\"margin-left:4px;\">keyboard</mat-icon>\r\n                </button>\r\n                <label style=\"font-size: 12px; margin-top: 4px;\">E3</label>\r\n            </div>\r\n            \r\n            <div style=\"display: flex; flex-direction: column; align-items: center; margin: 0 4px;\">\r\n                <button mat-raised-button\r\n                    [ngStyle]=\"{'background-color': buttonColors?.e4}\"\r\n                    style=\"min-width:40px; padding:0; font-weight:bold;\"\r\n                    (click)=\"e1()\">\r\n                    <mat-icon style=\"margin-left:4px;\">keyboard</mat-icon>\r\n                </button>\r\n                <label style=\"font-size: 12px; margin-top: 4px;\">E4</label>\r\n            </div>\r\n            \r\n            <div style=\"display: flex; flex-direction: column; align-items: center; margin: 0 4px;\">\r\n                <button mat-raised-button\r\n                    [ngStyle]=\"{'background-color': buttonColors?.e5}\"\r\n                    style=\"min-width:40px; padding:0; font-weight:bold;\"\r\n                    (click)=\"e1()\">\r\n                    <mat-icon style=\"margin-left:4px;\">keyboard</mat-icon>\r\n                </button>\r\n                <label style=\"font-size: 12px; margin-top: 4px;\">E5</label>\r\n            </div>\r\n            \r\n            <div style=\"display: flex; flex-direction: column; align-items: center; margin: 0 4px;\">\r\n                <button mat-raised-button\r\n                    [ngStyle]=\"{'background-color': buttonColors?.e6}\"\r\n                    style=\"min-width:40px; padding:0; font-weight:bold;\"\r\n                    (click)=\"e1()\">\r\n                    <mat-icon style=\"margin-left:4px;\">keyboard</mat-icon>\r\n                </button>\r\n                <label style=\"font-size: 12px; margin-top: 4px;\">E6</label>\r\n            </div>\r\n            \r\n            <div style=\"display: flex; flex-direction: column; align-items: center; margin: 0 4px;\">\r\n                <button mat-raised-button\r\n                    [ngStyle]=\"{'background-color': buttonColors?.e7}\"\r\n                    style=\"min-width:40px; padding:0; font-weight:bold;\"\r\n                    (click)=\"e1()\">\r\n                    <mat-icon style=\"margin-left:4px;\">keyboard</mat-icon>\r\n                </button>\r\n                <label style=\"font-size: 12px; margin-top: 4px;\">E7</label>\r\n            </div>\r\n            \r\n            <div style=\"display: flex; flex-direction: column; align-items: center; margin: 0 4px;\">\r\n                <button mat-raised-button\r\n                    [ngStyle]=\"{'background-color': buttonColors?.e8}\"\r\n                    style=\"min-width:40px; padding:0; font-weight:bold;\"\r\n                    (click)=\"e1()\">\r\n                    <mat-icon style=\"margin-left:4px;\">keyboard</mat-icon>\r\n                </button>\r\n                <label style=\"font-size: 12px; margin-top: 4px;\">E8</label>\r\n            </div>\r\n            \r\n            <div style=\"display: flex; flex-direction: column; align-items: center; margin: 0 4px;\">\r\n                <button mat-raised-button\r\n                    [ngStyle]=\"{'background-color': buttonColors?.e9}\"\r\n                    style=\"min-width:40px; padding:0; font-weight:bold;\"\r\n                    (click)=\"e1()\">\r\n                    <mat-icon style=\"margin-left:4px;\">keyboard</mat-icon>\r\n                </button>\r\n                <label style=\"font-size: 12px; margin-top: 4px;\">E9</label>\r\n            </div>\r\n            \r\n            \r\n\r\n\r\n        </div>\r\n\r\n    </div>\r\n</div>",
      "templateCss" : "#container {\r\n    overflow: auto;\r\n}\r\n\r\n.tbDatasource-container {\r\n    margin: 5px;\r\n    padding: 8px;\r\n}\r\n\r\n.tbDatasource-title {\r\n    font-size: 1.200rem;\r\n    font-weight: 500;\r\n    padding-bottom: 10px;\r\n}\r\n\r\n.tbDatasource-table {\r\n    width: 100%;\r\n    box-shadow: 0 0 10px #ccc;\r\n    border-collapse: collapse;\r\n    white-space: nowrap;\r\n    font-size: 1.000rem;\r\n    color: #757575;\r\n}\r\n\r\n.tbDatasource-table td {\r\n    position: relative;\r\n    border-top: 1px solid rgba(0, 0, 0, 0.12);\r\n    border-bottom: 1px solid rgba(0, 0, 0, 0.12);\r\n    padding: 0px 18px;\r\n    box-sizing: border-box;\r\n}",
      "controllerScript" : "self.onInit = function() {\r\n\r\n    let ctx = self.ctx.$scope;\r\n        \r\n    // --- Button actions ---\r\n    ctx.e1 = function() {\r\n        console.log(\"button 1 pressed\");\r\n    };\r\n\r\n    ctx.e2 = function() {\r\n        console.log(\"button 2 pressed\");\r\n    };\r\n    \r\n    // Store button colors\r\n        ctx.buttonColors = {\r\n        e1: \"#EEEEEE\",\r\n        e2: \"#EEEEEE\",\r\n        e3: \"#EEEEEE\",\r\n        e4: \"#EEEEEE\",\r\n        e5: \"#EEEEEE\",\r\n        e6: \"#EEEEEE\",\r\n        e7: \"#EEEEEE\",\r\n        e8: \"#EEEEEE\",\r\n        e9: \"#EEEEEE\",\r\n        e10:\"#EEEEEE\"\r\n    };\r\n    \r\n};\r\n\r\n\r\n\r\n\r\nself.onDataUpdated = function () {\r\n\r\n    let ctx = self.ctx.$scope;\r\n    let data = self.ctx.data;\r\n\r\n    // Do NOT reset buttonColors object!\r\n    // Just update its properties:\r\n    for (let i = 0; i < data.length; i++) {\r\n        \r\n        const ds = data[i].datasource;\r\n        const entityName = ds && ds.entityName ? ds.entityName : \"\";\r\n        \r\n        // Extract the station number from \"Estación 1.X\"\r\n        let match = entityName.match(/(\\d+)\\.(\\d+)/);\r\n        let stationIndex = match ? parseInt(match[2]) : i;  // fallback: use i\r\n        \r\n        // Get the latest state\r\n        const latest = data[i].data.length ? data[i].data[data[i].data.length - 1] : null;\r\n        let state = latest ? latest[1] : \"UNKNOWN\";\r\n        \r\n        // Button name: e1..e10\r\n        const button = \"e\" + (stationIndex);\r\n\r\n        ctx.buttonColors[button] = getColor(state);\r\n    }\r\n\r\n    self.ctx.detectChanges();\r\n\r\n    function getColor(state) {\r\n        switch (state) {\r\n            case \"EN OPERACIÓN\": return \"#4CE16B\";\r\n            case \"EN PARADA\": return \"#FF5144\";\r\n            case \"EN INSPECCIÓN\": return \"#FF2C73\";\r\n            case \"EN LEVANTAMIENTO\": return \"#1EE9CC\";\r\n            default: return \"#EEEEEE\";\r\n        }\r\n    }\r\n};\r\n",
      "settingsForm" : [ ],
      "dataKeySettingsForm" : [ ],
      "hasBasicMode" : false,
      "basicModeDirective" : "",
      "defaultConfig" : "{\"showTitle\":true,\"backgroundColor\":\"#fff\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{},\"title\":\"Linea 1 - Estaciones\",\"decimals\":null,\"dropShadow\":true,\"enableFullscreen\":false,\"widgetStyle\":{},\"widgetCss\":\"\",\"pageSize\":1024,\"noDataDisplayMessage\":\"\",\"showTitleIcon\":false,\"titleTooltip\":\"\",\"titleStyle\":{\"fontSize\":\"24px\",\"fontWeight\":700,\"padding\":\"0px 0px 5px 0px\"},\"datasources\":[],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}}}"
    },
    "externalId" : null,
    "resources" : null,
    "id" : {
      "entityType" : "WIDGET_TYPE",
      "id" : "0b8b28d0-cc98-11f0-b9be-a7eb49293647"
    },
    "scada" : false,
    "tags" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}