{
  "entityType" : "WIDGET_TYPE",
  "entity" : {
    "fqn" : "control",
    "name" : "Panel resumen",
    "deprecated" : false,
    "image" : null,
    "description" : null,
    "descriptor" : {
      "type" : "timeseries",
      "sizeX" : 9,
      "sizeY" : 4,
      "resources" : [ ],
      "templateHtml" : "<div class=\"custom-gen-widget\"\r\n    style=\"display: flex; flex-direction: column; height: 100%;\">\r\n\r\n\r\n    <div\r\n        style=\"flex: 1; background-color: #00000020; display: flex; flex-direction: column; padding: 12px; overflow: hidden;\">\r\n\r\n        <div\r\n            style=\"flex: 1; display: flex; justify-content: space-evenly; align-items: center; flex-wrap: wrap;\">\r\n            \r\n            \r\n            <div style=\"display: flex; flex-direction: column; align-items: center; margin: 0 4px;\">\r\n                <button mat-raised-button\r\n                    [ngStyle]=\"{'background-color': buttonColors?.e0}\"\r\n                    style=\"min-width:40px; padding:0; font-weight:bold;\"\r\n                    (click)=\"e0()\">\r\n                    <mat-icon style=\"margin-left:4px;\">keyboard</mat-icon>\r\n                </button>\r\n                <label style=\"font-size: 15px; margin-top: 4px;\">E0</label>\r\n                <!-- time since last update -->\r\n                <label style=\"font-size: 12px; margin-top: 2px;\">\r\n                    {{ lastUpdateTimes?.e0 }}\r\n                </label>\r\n            </div>\r\n\r\n            \r\n            <div style=\"display: flex; flex-direction: column; align-items: center; margin: 0 4px;\">\r\n                <button mat-raised-button\r\n                    [ngStyle]=\"{'background-color': buttonColors?.e1}\"\r\n                    style=\"min-width:40px; padding:0; font-weight:bold;\"\r\n                    (click)=\"e1()\">\r\n                    <mat-icon style=\"margin-left:4px;\">keyboard</mat-icon>\r\n                </button>\r\n                <label style=\"font-size: 15px; margin-top: 4px;\">E1</label>\r\n                <!-- time since last update -->\r\n                <label style=\"font-size: 12px; margin-top: 2px;\">\r\n                    {{ lastUpdateTimes?.e1 }}\r\n                </label>\r\n            </div>\r\n            \r\n            <div style=\"display: flex; flex-direction: column; align-items: center; margin: 0 4px;\">\r\n                <button mat-raised-button\r\n                    [ngStyle]=\"{'background-color': buttonColors?.e2}\"\r\n                    style=\"min-width:40px; padding:0; font-weight:bold;\"\r\n                    (click)=\"e2()\">\r\n                    <mat-icon style=\"margin-left:4px;\">keyboard</mat-icon>\r\n                </button>\r\n                <label style=\"font-size: 15px; margin-top: 4px;\">E2</label>\r\n                <!-- time since last update -->\r\n                <label style=\"font-size: 12px; margin-top: 2px;\">\r\n                    {{ lastUpdateTimes?.e2 }}\r\n                </label>\r\n            </div>\r\n            \r\n            <div style=\"display: flex; flex-direction: column; align-items: center; margin: 0 4px;\">\r\n                <button mat-raised-button\r\n                    [ngStyle]=\"{'background-color': buttonColors?.e3}\"\r\n                    style=\"min-width:40px; padding:0; font-weight:bold;\"\r\n                    (click)=\"e3()\">\r\n                    <mat-icon style=\"margin-left:4px;\">keyboard</mat-icon>\r\n                </button>\r\n                <label style=\"font-size: 15px; margin-top: 4px;\">E3</label>\r\n                <!-- time since last update -->\r\n                <label style=\"font-size: 12px; margin-top: 2px;\">\r\n                    {{ lastUpdateTimes?.e3 }}\r\n                </label>\r\n            </div>\r\n            \r\n            <div style=\"display: flex; flex-direction: column; align-items: center; margin: 0 4px;\">\r\n                <button mat-raised-button\r\n                    [ngStyle]=\"{'background-color': buttonColors?.e4}\"\r\n                    style=\"min-width:40px; padding:0; font-weight:bold;\"\r\n                    (click)=\"e4()\">\r\n                    <mat-icon style=\"margin-left:4px;\">keyboard</mat-icon>\r\n                </button>\r\n                <label style=\"font-size: 15px; margin-top: 4px;\">E4</label>\r\n                <!-- time since last update -->\r\n                <label style=\"font-size: 12px; margin-top: 2px;\">\r\n                    {{ lastUpdateTimes?.e4 }}\r\n                </label>\r\n            </div>\r\n            \r\n            <div style=\"display: flex; flex-direction: column; align-items: center; margin: 0 4px;\">\r\n                <button mat-raised-button\r\n                    [ngStyle]=\"{'background-color': buttonColors?.e5}\"\r\n                    style=\"min-width:40px; padding:0; font-weight:bold;\"\r\n                    (click)=\"e5()\">\r\n                    <mat-icon style=\"margin-left:4px;\">keyboard</mat-icon>\r\n                </button>\r\n                <label style=\"font-size: 15px; margin-top: 4px;\">E5</label>\r\n                <!-- time since last update -->\r\n                <label style=\"font-size: 12px; margin-top: 2px;\">\r\n                    {{ lastUpdateTimes?.e5 }}\r\n                </label>\r\n            </div>\r\n            \r\n            <div style=\"display: flex; flex-direction: column; align-items: center; margin: 0 4px;\">\r\n                <button mat-raised-button\r\n                    [ngStyle]=\"{'background-color': buttonColors?.e6}\"\r\n                    style=\"min-width:40px; padding:0; font-weight:bold;\"\r\n                    (click)=\"e6()\">\r\n                    <mat-icon style=\"margin-left:4px;\">keyboard</mat-icon>\r\n                </button>\r\n                <label style=\"font-size: 15px; margin-top: 4px;\">E6</label>\r\n                <!-- time since last update -->\r\n                <label style=\"font-size: 12px; margin-top: 2px;\">\r\n                    {{ lastUpdateTimes?.e6 }}\r\n                </label>\r\n            </div>\r\n            \r\n            <div style=\"display: flex; flex-direction: column; align-items: center; margin: 0 4px;\">\r\n                <button mat-raised-button\r\n                    [ngStyle]=\"{'background-color': buttonColors?.e7}\"\r\n                    style=\"min-width:40px; padding:0; font-weight:bold;\"\r\n                    (click)=\"e7()\">\r\n                    <mat-icon style=\"margin-left:4px;\">keyboard</mat-icon>\r\n                </button>\r\n                <label style=\"font-size: 15px; margin-top: 4px;\">E7</label>\r\n                <!-- time since last update -->\r\n                <label style=\"font-size: 12px; margin-top: 2px;\">\r\n                    {{ lastUpdateTimes?.e7 }}\r\n                </label>\r\n            </div>\r\n            \r\n            <div style=\"display: flex; flex-direction: column; align-items: center; margin: 0 4px;\">\r\n                <button mat-raised-button\r\n                    [ngStyle]=\"{'background-color': buttonColors?.e8}\"\r\n                    style=\"min-width:40px; padding:0; font-weight:bold;\"\r\n                    (click)=\"e8()\">\r\n                    <mat-icon style=\"margin-left:4px;\">keyboard</mat-icon>\r\n                </button>\r\n                <label style=\"font-size: 15px; margin-top: 4px;\">E8</label>\r\n                <!-- time since last update -->\r\n                <label style=\"font-size: 12px; margin-top: 2px;\">\r\n                    {{ lastUpdateTimes?.e8 }}\r\n                </label>\r\n            </div>\r\n            \r\n            <div style=\"display: flex; flex-direction: column; align-items: center; margin: 0 4px;\">\r\n                <button mat-raised-button\r\n                    [ngStyle]=\"{'background-color': buttonColors?.e9}\"\r\n                    style=\"min-width:40px; padding:0; font-weight:bold;\"\r\n                    (click)=\"e9()\">\r\n                    <mat-icon style=\"margin-left:4px;\">keyboard</mat-icon>\r\n                </button>\r\n                <label style=\"font-size: 15px; margin-top: 4px;\">E9</label>\r\n                <!-- time since last update -->\r\n                <label style=\"font-size: 12px; margin-top: 2px;\">\r\n                    {{ lastUpdateTimes?.e9 }}\r\n                </label>\r\n            </div>\r\n            \r\n            \r\n\r\n\r\n        </div>\r\n\r\n    </div>\r\n</div>",
      "templateCss" : "#container {\r\n    overflow: auto;\r\n}\r\n\r\n.tbDatasource-container {\r\n    margin: 5px;\r\n    padding: 8px;\r\n}\r\n\r\n.tbDatasource-title {\r\n    font-size: 1.200rem;\r\n    font-weight: 500;\r\n    padding-bottom: 10px;\r\n}\r\n\r\n.tbDatasource-table {\r\n    width: 100%;\r\n    box-shadow: 0 0 10px #ccc;\r\n    border-collapse: collapse;\r\n    white-space: nowrap;\r\n    font-size: 1.000rem;\r\n    color: #757575;\r\n}\r\n\r\n.tbDatasource-table td {\r\n    position: relative;\r\n    border-top: 1px solid rgba(0, 0, 0, 0.12);\r\n    border-bottom: 1px solid rgba(0, 0, 0, 0.12);\r\n    padding: 0px 18px;\r\n    box-sizing: border-box;\r\n}",
      "controllerScript" : "self.onInit = function() {\r\n\r\n    let ctx = self.ctx.$scope;\r\n        \r\n    // --- Button actions ---\r\n    ctx.e0 = function() {\r\n        var params = {\r\n            entityId: {\r\n                entityType: \"DEVICE\",\r\n                id: \"74626cb0-b5b9-11f0-9cd0-35be421ad23c\"\r\n            },\r\n            entityName: \"Estación 1.0\"\r\n        };\r\n        self.ctx.stateController.openState(\"estacion\", params, false);\r\n    };\r\n    ctx.e1 = function() {\r\n        var params = {\r\n            entityId: {\r\n                entityType: \"DEVICE\",\r\n                id: \"e8fab590-8f22-11f0-a61c-01e0c85fd5dd\"\r\n            },\r\n            entityName: \"Estación 1.1\"\r\n        };\r\n        self.ctx.stateController.openState(\"estacion\", params, false);\r\n    };\r\n    ctx.e2 = function() {\r\n        var params = {\r\n            entityId: {\r\n                entityType: \"DEVICE\",\r\n                id: \"5f1af5f0-a922-11f0-9abe-2dfd6db9cae3\"\r\n            },\r\n            entityName: \"Estación 1.2\"\r\n        };\r\n        self.ctx.stateController.openState(\"estacion\", params, false);\r\n    };\r\n    ctx.e3 = function() {\r\n        var params = {\r\n            entityId: {\r\n                entityType: \"DEVICE\",\r\n                id: \"d0033100-a62b-11f0-9abe-2dfd6db9cae3\"\r\n            },\r\n            entityName: \"Estación 1.3\"\r\n        };\r\n        self.ctx.stateController.openState(\"estacion\", params, false);\r\n    };\r\n    ctx.e4 = function() {\r\n        var params = {\r\n            entityId: {\r\n                entityType: \"DEVICE\",\r\n                id: \"a36ff110-a922-11f0-9abe-2dfd6db9cae3\"\r\n            },\r\n            entityName: \"Estación 1.4\"\r\n        };\r\n        self.ctx.stateController.openState(\"estacion\", params, false);\r\n    };\r\n    ctx.e5 = function() {\r\n        var params = {\r\n            entityId: {\r\n                entityType: \"DEVICE\",\r\n                id: \"e216e9a0-a922-11f0-9abe-2dfd6db9cae3\"\r\n            },\r\n            entityName: \"Estación 1.5\"\r\n        };\r\n        self.ctx.stateController.openState(\"estacion\", params, false);\r\n    };\r\n    ctx.e6 = function() {\r\n        var params = {\r\n            entityId: {\r\n                entityType: \"DEVICE\",\r\n                id: \"1993ee00-a923-11f0-9abe-2dfd6db9cae3\"\r\n            },\r\n            entityName: \"Estación 1.6\"\r\n        };\r\n        self.ctx.stateController.openState(\"estacion\", params, false);\r\n    };\r\n    ctx.e7 = function() {\r\n        var params = {\r\n            entityId: {\r\n                entityType: \"DEVICE\",\r\n                id: \"ed8fb3a0-a924-11f0-9abe-2dfd6db9cae3\"\r\n            },\r\n            entityName: \"Estación 1.7\"\r\n        };\r\n        self.ctx.stateController.openState(\"estacion\", params, false);\r\n    };\r\n    ctx.e8 = function() {\r\n        var params = {\r\n            entityId: {\r\n                entityType: \"DEVICE\",\r\n                id: \"7d9adab0-a925-11f0-9abe-2dfd6db9cae3\"\r\n            },\r\n            entityName: \"Estación 1.8\"\r\n        };\r\n        self.ctx.stateController.openState(\"estacion\", params, false);\r\n    };\r\n    ctx.e9 = function() {\r\n        var params = {\r\n            entityId: {\r\n                entityType: \"DEVICE\",\r\n                id: \"777f8010-ab85-11f0-9abe-2dfd6db9cae3\"\r\n            },\r\n            entityName: \"Estación 1.9\"\r\n        };\r\n        self.ctx.stateController.openState(\"estacion\", params, false);\r\n    };\r\n    \r\n    // Store button colors\r\n        ctx.buttonColors = {\r\n        e1: \"#EEEEEE\",\r\n        e2: \"#EEEEEE\",\r\n        e3: \"#EEEEEE\",\r\n        e4: \"#EEEEEE\",\r\n        e5: \"#EEEEEE\",\r\n        e6: \"#EEEEEE\",\r\n        e7: \"#EEEEEE\",\r\n        e8: \"#EEEEEE\",\r\n        e9: \"#EEEEEE\",\r\n        e10:\"#EEEEEE\"\r\n    };\r\n    \r\n    ctx.lastUpdateTimes = {\r\n        e0: \"...\",\r\n        e1: \"...\",\r\n        e2: \"...\",\r\n        e3: \"...\",\r\n        e4: \"...\",\r\n        e5: \"...\",\r\n        e6: \"...\",\r\n        e7: \"...\",\r\n        e8: \"...\",\r\n        e9: \"...\"\r\n    };\r\n\r\n    \r\n};\r\n\r\n\r\n\r\n\r\nself.onDataUpdated = function () {\r\n    let ctx = self.ctx.$scope;\r\n    let data = self.ctx.data;\r\n\r\n    for (let i = 0; i < data.length; i++) {\r\n        \r\n        const ds = data[i].datasource;\r\n        const entityName = ds && ds.entityName ? ds.entityName : \"\";\r\n        let match = entityName.match(/(\\d+)\\.(\\d+)/);\r\n        let stationIndex = match ? parseInt(match[2]) : i;\r\n\r\n        const button = \"e\" + stationIndex;\r\n\r\n        // Get latest value + timestamp\r\n        const latest = data[i].data.length ? data[i].data[data[i].data.length - 1] : null;\r\n\r\n        if (latest) {\r\n            let value = latest[1];\r\n            let ts = latest[0];\r\n\r\n            ctx.buttonColors[button] = getColor(value);\r\n            ctx.lastUpdateTimes[button] = formatTimeSince(ts);\r\n        }\r\n    }\r\n\r\n    self.ctx.detectChanges();\r\n\r\n    function getColor(state) {\r\n        switch (state) {\r\n            case \"EN OPERACIÓN\": return \"#4CE16B\";\r\n            case \"EN PARADA\": return \"#FF5144\";\r\n            case \"EN INSPECCIÓN\": return \"#FF2C73\";\r\n            case \"EN LEVANTAMIENTO\": return \"#1EE9CC\";\r\n            default: return \"#EEEEEE\";\r\n        }\r\n    }\r\n\r\n    function formatTimeSince(ts) {\r\n        let secs = Math.floor((Date.now() - ts) / 1000);\r\n    \r\n        const units = [\r\n            { label: \"d\", value: 86400 },\r\n            { label: \"h\", value: 3600 },\r\n            { label: \"m\", value: 60 },\r\n            { label: \"s\", value: 1 }\r\n        ];\r\n    \r\n        const parts = [];\r\n    \r\n        for (const u of units) {\r\n            if (secs >= u.value) {\r\n                const amount = Math.floor(secs / u.value);\r\n                secs -= amount * u.value;\r\n                parts.push(amount + u.label);\r\n    \r\n                if (parts.length === 2) break; // only two units\r\n            }\r\n        }\r\n    \r\n        return parts.join(\" \");\r\n    }\r\n\r\n};\r\n\r\n",
      "settingsForm" : [ ],
      "dataKeySettingsForm" : [ ],
      "hasBasicMode" : false,
      "basicModeDirective" : "",
      "defaultConfig" : "{\"showTitle\":true,\"backgroundColor\":\"#fff\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{},\"title\":\"Linea 1 - Estaciones\",\"decimals\":null,\"dropShadow\":true,\"enableFullscreen\":false,\"widgetStyle\":{},\"widgetCss\":\"\",\"pageSize\":1024,\"noDataDisplayMessage\":\"\",\"showTitleIcon\":false,\"titleTooltip\":\"\",\"titleStyle\":{\"fontSize\":\"24px\",\"fontWeight\":700,\"padding\":\"0px 0px 5px 0px\"},\"datasources\":[],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}}}"
    },
    "externalId" : null,
    "resources" : null,
    "id" : {
      "entityType" : "WIDGET_TYPE",
      "id" : "0b8b28d0-cc98-11f0-b9be-a7eb49293647"
    },
    "scada" : false,
    "tags" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}