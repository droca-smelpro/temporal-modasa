{
  "entityType" : "WIDGET_TYPE",
  "entity" : {
    "fqn" : "lastest_values_table",
    "name" : "Lastest values table",
    "deprecated" : false,
    "image" : null,
    "description" : null,
    "descriptor" : {
      "type" : "latest",
      "sizeX" : 7.5,
      "sizeY" : 5,
      "resources" : [ ],
      "templateHtml" : "",
      "templateCss" : ".tb-scroll-container {\r\n  position: relative;      /* stays within widget bounds */\r\n  overflow-y: auto;        /* vertical scroll */\r\n  overflow-x: hidden;\r\n  -webkit-overflow-scrolling: touch; /* smooth on touch devices */\r\n}\r\n\r\n.mat-table {\r\n  width: 100%;\r\n  border-collapse: collapse;\r\n}\r\n\r\n.mat-cell {\r\n  font-family: 'Roboto', sans-serif; /* Roboto font */\r\n  font-size: 13px;                   /* Smaller font */\r\n  padding: 13px 13px;                /* More vertical padding = extra space top/bottom */\r\n  border-bottom: 1px solid #e0e0e0;\r\n}\r\n\r\n/*\r\n.mat-row:first-child .mat-cell {\r\n  border-top: 1px solid #e0e0e0;\r\n}\r\n*/\r\n\r\n.key-cell {\r\n  text-align: left;\r\n  font-weight: normal;\r\n  \r\n  white-space: normal;       /* prevent wrapping */\r\n  padding-right: 12px;        /* small gap before bar */\r\n  max-width: 200px;          /* adjust as needed */\r\n  min-width: 100px;          /* won‚Äôt shrink too much */\r\n  width: 1%;                 /* force auto-shrink */\r\n  overflow: hidden;\r\n  /*text-overflow: ellipsis;    ‚Ä¶ if text too long */\r\n}\r\n\r\n.value-cell {\r\n  text-align: left;          /* align bar to left edge */\r\n  width: 100%;               /* take all remaining space */\r\n}\r\n\r\n\r\n.mat-row:hover { \r\n  background-color: #f5f5f5; \r\n}\r\n\r\n.tb-search-container {\r\n  padding: 6px 5px 25px 0px;\r\n  background: transparent;\r\n  border-bottom: 1px solid #e0e0e0;\r\n  display: flex;               /* enable flexbox */\r\n  justify-content: flex-end;   /* push search to the right */\r\n}\r\n\r\n.tb-search {\r\n  width: 30%;                  /* half the container width */\r\n  max-width: 250px;            /* optional: prevent it from growing too big */\r\n  padding: 6px 10px;\r\n  font-size: 13px;\r\n  font-family: 'Roboto', sans-serif;\r\n  border: 1px solid #ccc;\r\n  border-radius: 4px;\r\n}\r\n\r\n.bar-container {\r\n  display: flex;\r\n  align-items: center;\r\n  height: 16px;\r\n}\r\n\r\n.bar-fill {\r\n  height: 100%;\r\n  border-radius: 3px;\r\n  transition: width 0.3s ease;   /* smooth update */\r\n}\r\n\r\n.bar-label {\r\n  margin-left: 6px;\r\n  font-size: 12px;\r\n  color: #444;   /* darker for readability */\r\n  white-space: nowrap;\r\n}\r\n\r\n",
      "controllerScript" : "self.onInit = function() {\n\n    self.ctx.colorA = self.ctx.settings.color_a || \"#4CAF50\";\n    self.ctx.colorB = self.ctx.settings.color_b || \"#A5D7A7\";\n\n    self.ctx.tables = [];\n    self.ctx.maxValues = []; // ‚úÖ initialize here\n\n    for (var i = 0; i < self.ctx.datasources.length; i++) {\n        var tbDatasource = self.ctx.datasources[i];\n        var datasourceId = 'tbDatasource' + i;\n\n        self.ctx.$container.append(\n            \"<div id='\" + datasourceId + \"' class='tbDatasource-container'></div>\"\n        );\n\n        var datasourceContainer = $('#' + datasourceId, self.ctx.$container);\n\n        // üîç Add search input\n        var searchId = 'search' + i;\n        datasourceContainer.append(\n            \"<div class='tb-search-container'>\" +\n            \"<input id='\" + searchId + \"' type='text' class='tb-search' placeholder='Search...'>\" +\n            \"</div>\"\n        );\n\n        // üßæ Table container\n        var tableId = 'table' + i;\n        datasourceContainer.append(\n            \"<div class='tb-scroll-container'>\" +\n            \"<table id='\" + tableId + \"' class='mat-table full-width'><tbody></tbody></table>\" +\n            \"</div>\"\n        );\n\n        // Store table & search input\n        self.ctx.tables.push({\n            body: $('#' + tableId + ' tbody', self.ctx.$container),\n            rows: {},\n            searchInput: $('#' + searchId, self.ctx.$container)\n        });\n\n        // üîç Hook up filtering\n        (function(tableObj) {\n            tableObj.searchInput.on('input', function() {\n                var term = $(this).val().toLowerCase();\n                $('tr', tableObj.body).each(function() {\n                    var text = $(this).text().toLowerCase();\n                    $(this).toggle(text.indexOf(term) > -1);\n                });\n            });\n        })(self.ctx.tables[i]);\n    }\n\n    self.onResize();\n};\n\n\n// ‚úÖ Helper: validate if a value is meaningful\nfunction hasMeaningfulValue(v) {\n    if (v === null || v === undefined) return false;\n    if (typeof v === 'number') return isFinite(v); // keep 0\n    if (typeof v === 'boolean') return true; // keep false/true\n    if (typeof v === 'string') {\n        var s = v.trim();\n        if (!s) return false; // \"\", \" \"\n        if (s === '-' || s === '‚Äî') return false; // placeholders\n        if (s.toLowerCase() === 'null' || s.toLowerCase() === 'undefined') return false;\n        return true;\n    }\n    try {\n        var s = JSON.stringify(v);\n        return s && s !== '{}' && s !== '[]';\n    } catch (e) {\n        return false;\n    }\n}\n\n\n// ü™ü Resize handler\nself.onResize = function() {\n    var widgetHeight = self.ctx.height || self.ctx.$container.height();\n    var count = Math.max(self.ctx.datasources.length, 1);\n    var perHeight = Math.floor(widgetHeight / count);\n\n    // Apply height to every scroll container\n    $('.tb-scroll-container', self.ctx.$container).css({\n        height: perHeight + 'px',\n        maxHeight: perHeight + 'px'\n    });\n};\n\n\n// üìä Data update handler\nself.onDataUpdated = function() {\n\n    // First pass: find max per datasource\n    self.ctx.maxValues = [];\n\n    for (var i = 0; i < self.ctx.data.length; i++) {\n        var cellData = self.ctx.data[i];\n        if (!cellData || !cellData.data || !cellData.data.length) continue;\n\n        var raw = cellData.data[cellData.data.length - 1][1];\n        var dsIndex = (cellData.datasourceIndex != null) ? cellData.datasourceIndex : 0;\n\n        if (typeof raw === 'number' && isFinite(raw)) {\n            if (self.ctx.maxValues[dsIndex] == null || raw > self.ctx.maxValues[dsIndex]) {\n                self.ctx.maxValues[dsIndex] = raw;\n            }\n        }\n    }\n\n    // Second pass: render rows\n    for (var i = 0; i < self.ctx.data.length; i++) {\n        var cellData = self.ctx.data[i];\n        if (!cellData || !cellData.data || !cellData.data.length) continue;\n\n        var tvPair = cellData.data[cellData.data.length - 1];\n        var raw = tvPair[1];\n        var dsIndex = (cellData.datasourceIndex != null) ? cellData.datasourceIndex : 0;\n        var key = cellData.dataKey.label || cellData.dataKey.name;\n        var table = self.ctx.tables[dsIndex];\n        if (!table) continue;\n\n        // Skip empty or meaningless values\n        if (!hasMeaningfulValue(raw)) {\n            if (table.rows[key]) {\n                table.rows[key].closest('tr').remove();\n                delete table.rows[key];\n            }\n            continue;\n        }\n\n        // üßÆ Build bar\n        var txt;\n        if (typeof raw === 'number' && isFinite(raw)) {\n            if (raw === 0) { // remove 0 rows\n                if (table.rows[key]) {\n                    table.rows[key].closest('tr').remove();\n                    delete table.rows[key];\n                }\n                continue;\n            }\n\n            var maxVal = self.ctx.maxValues[dsIndex] || 1;\n            var percent = Math.max(0, Math.min(100, (raw / maxVal) * 100));\n\n            txt = '<div class=\"bar-container\">' +\n                  '<div class=\"bar-fill\" style=\"width:' + percent + '%; ' +\n                  'background: linear-gradient(90deg, ' + self.ctx.colorA + ', ' + self.ctx.colorB + ');\"></div>' +\n                  '<span class=\"bar-label\">' + raw + '</span>' +\n                  '</div>';\n        } else if (typeof raw === 'object') {\n            try { txt = JSON.stringify(raw); } catch (e) { txt = String(raw); }\n        } else {\n            txt = String(raw);\n        }\n\n        // üß± Insert or update row\n        if (!table.rows[key]) {\n            var safeId = 'row_' + dsIndex + '_' + key.replace(/[^\\w-]/g, '_');\n            var $row = $(\n                \"<tr class='mat-row' id='\" + safeId + \"'>\" +\n                \"<td class='mat-cell key-cell'>\" + key + \"</td>\" +\n                \"<td class='mat-cell value-cell'></td>\" +\n                \"</tr>\"\n            );\n            table.body.append($row);\n            table.rows[key] = $row.find('.value-cell');\n        }\n\n        table.rows[key].html(txt);\n    }\n\n    // üìà Sort by descending value\n    for (var t = 0; t < self.ctx.tables.length; t++) {\n        var tableObj = self.ctx.tables[t];\n        var $rows = tableObj.body.find('tr').get();\n\n        $rows.sort(function(a, b) {\n            var aVal = parseFloat($(a).find('.bar-label').text()) || 0;\n            var bVal = parseFloat($(b).find('.bar-label').text()) || 0;\n            return bVal - aVal;\n        });\n\n        $.each($rows, function(idx, row) {\n            tableObj.body.append(row);\n        });\n    }\n};\n",
      "settingsForm" : [ {
        "id" : "color_a",
        "name" : "Color A",
        "group" : "Color",
        "type" : "color",
        "default" : "#000",
        "required" : false
      }, {
        "id" : "color_b",
        "name" : "Color B",
        "group" : "Color",
        "type" : "color",
        "default" : "#000"
      } ],
      "dataKeySettingsForm" : [ ],
      "hasBasicMode" : false,
      "defaultConfig" : "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Random\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"},{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Cos\",\"color\":\"#4caf50\",\"settings\":{},\"_hash\":0.8416510464473642,\"funcBody\":\"return Math.round(1000*Math.cos(time/5000));\"},{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Sin\",\"color\":\"#f44336\",\"settings\":{},\"_hash\":0.9656098086761837,\"funcBody\":\"return Math.round(1000*Math.sin(time/5000));\"}],\"alarmFilterConfig\":{\"statusList\":[\"ACTIVE\"]}}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":true,\"backgroundColor\":\"#fff\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{\"color_a\":\"#4CAF50\",\"color_b\":\"#A5D7A7\"},\"title\":\"Attributes card\",\"decimals\":null,\"useDashboardTimewindow\":true,\"displayTimewindow\":true,\"showTitleIcon\":false,\"titleTooltip\":\"\",\"dropShadow\":true,\"enableFullscreen\":false,\"widgetStyle\":{},\"widgetCss\":\".tb-widget .tb-widget-header {\\r\\n  position: absolute !important;\\r\\n  background: transparent !important;    /* solid background so it covers content */\\r\\n}\",\"titleStyle\":{\"fontSize\":\"24px\",\"fontWeight\":700,\"padding\":\"5px 10px 10px 5px\"},\"pageSize\":1024,\"noDataDisplayMessage\":\"\"}"
    },
    "externalId" : null,
    "resources" : null,
    "id" : {
      "entityType" : "WIDGET_TYPE",
      "id" : "a2d944b0-928c-11f0-a61c-01e0c85fd5dd"
    },
    "scada" : false,
    "tags" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}